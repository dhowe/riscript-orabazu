"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var as=Object.defineProperty;var cs=(r,e,t)=>e in r?as(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ct=(r,e,t)=>(cs(r,typeof e!="symbol"?e+"":e,t),t);var _he = require('he'); var _he2 = _interopRequireDefault(_he);var _mingo = require('mingo');var _lodashes = require('lodash-es');var _utils = require('@chevrotain/utils');var _gast = require('@chevrotain/gast');var X=class{walk(e,t=[]){_lodashes.forEach.call(void 0, e.definition,(n,i)=>{let s=_lodashes.drop.call(void 0, e.definition,i+1);if(n instanceof _gast.NonTerminal)this.walkProdRef(n,s,t);else if(n instanceof _gast.Terminal)this.walkTerminal(n,s,t);else if(n instanceof _gast.Alternative)this.walkFlat(n,s,t);else if(n instanceof _gast.Option)this.walkOption(n,s,t);else if(n instanceof _gast.RepetitionMandatory)this.walkAtLeastOne(n,s,t);else if(n instanceof _gast.RepetitionMandatoryWithSeparator)this.walkAtLeastOneSep(n,s,t);else if(n instanceof _gast.RepetitionWithSeparator)this.walkManySep(n,s,t);else if(n instanceof _gast.Repetition)this.walkMany(n,s,t);else if(n instanceof _gast.Alternation)this.walkOr(n,s,t);else throw Error("non exhaustive match")})}walkTerminal(e,t,n){}walkProdRef(e,t,n){}walkFlat(e,t,n){let i=t.concat(n);this.walk(e,i)}walkOption(e,t,n){let i=t.concat(n);this.walk(e,i)}walkAtLeastOne(e,t,n){let i=[new (0, _gast.Option)({definition:e.definition})].concat(t,n);this.walk(e,i)}walkAtLeastOneSep(e,t,n){let i=sr(e,t,n);this.walk(e,i)}walkMany(e,t,n){let i=[new (0, _gast.Option)({definition:e.definition})].concat(t,n);this.walk(e,i)}walkManySep(e,t,n){let i=sr(e,t,n);this.walk(e,i)}walkOr(e,t,n){let i=t.concat(n);_lodashes.forEach.call(void 0, e.definition,s=>{let o=new (0, _gast.Alternative)({definition:[s]});this.walk(o,i)})}};function sr(r,e,t){return[new (0, _gast.Option)({definition:[new (0, _gast.Terminal)({terminalType:r.separator})].concat(r.definition)})].concat(e,t)}function de(r){if(r instanceof _gast.NonTerminal)return de(r.referencedRule);if(r instanceof _gast.Terminal)return _s(r);if(_gast.isSequenceProd.call(void 0, r))return Ss(r);if(_gast.isBranchingProd.call(void 0, r))return Os(r);throw Error("non exhaustive match")}function Ss(r){let e=[],t=r.definition,n=0,i=t.length>n,s,o=!0;for(;i&&o;)s=t[n],o=_gast.isOptionalProd.call(void 0, s),e=e.concat(de(s)),n=n+1,i=t.length>n;return _lodashes.uniq.call(void 0, e)}function Os(r){let e=_lodashes.map.call(void 0, r.definition,t=>de(t));return _lodashes.uniq.call(void 0, _lodashes.flatten.call(void 0, e))}function _s(r){return[r.terminalType]}var ht="_~IN~_";var on=class extends X{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,t,n){}walkProdRef(e,t,n){let i=ys(e.referencedRule,e.idx)+this.topProd.name,s=t.concat(n),o=new (0, _gast.Alternative)({definition:s}),a=de(o);this.follows[i]=a}};function cr(r){let e={};return _lodashes.forEach.call(void 0, r,t=>{let n=new on(t).startWalking();_lodashes.assign.call(void 0, e,n)}),e}function ys(r,e){return r.name+e+ht}var _regexptoast = require('@chevrotain/regexp-to-ast');var ut={},Ps=new _regexptoast.RegExpParser;function _e(r){let e=r.toString();if(ut.hasOwnProperty(e))return ut[e];{let t=Ps.pattern(e);return ut[e]=t,t}}function lr(){ut={}}var ur="Complement Sets are not supported for first char optimization",$e=`Unable to use "first char" lexer optimizations:
`;function dr(r,e=!1){try{let t=_e(r);return cn(t.value,{},t.flags.ignoreCase)}catch(t){if(t.message===ur)e&&_utils.PRINT_WARNING.call(void 0, `${$e}	Unable to optimize: < ${r.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),_utils.PRINT_ERROR.call(void 0, `${$e}
	Failed parsing: < ${r.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function cn(r,e,t){switch(r.type){case"Disjunction":for(let i=0;i<r.value.length;i++)cn(r.value[i],e,t);break;case"Alternative":let n=r.value;for(let i=0;i<n.length;i++){let s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}let o=s;switch(o.type){case"Character":dt(o.value,e,t);break;case"Set":if(o.complement===!0)throw Error(ur);_lodashes.forEach.call(void 0, o.value,c=>{if(typeof c=="number")dt(c,e,t);else{let l=c;if(t===!0)for(let h=l.from;h<=l.to;h++)dt(h,e,t);else{for(let h=l.from;h<=l.to&&h<xe;h++)dt(h,e,t);if(l.to>=xe){let h=l.from>=xe?l.from:xe,u=l.to,f=W(h),m=W(u);for(let T=f;T<=m;T++)e[T]=T}}}});break;case"Group":cn(o.value,e,t);break;default:throw Error("Non Exhaustive Match")}let a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ln(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return _lodashes.values.call(void 0, e)}function dt(r,e,t){let n=W(r);e[n]=n,t===!0&&Gs(r,e)}function Gs(r,e){let t=String.fromCharCode(r),n=t.toUpperCase();if(n!==t){let i=W(n.charCodeAt(0));e[i]=i}else{let i=t.toLowerCase();if(i!==t){let s=W(i.charCodeAt(0));e[s]=s}}}function hr(r,e){return _lodashes.find.call(void 0, r.value,t=>{if(typeof t=="number")return _lodashes.includes.call(void 0, e,t);{let n=t;return _lodashes.find.call(void 0, e,i=>n.from<=i&&i<=n.to)!==void 0}})}function ln(r){let e=r.quantifier;return e&&e.atLeast===0?!0:r.value?_lodashes.isArray.call(void 0, r.value)?_lodashes.every.call(void 0, r.value,ln):ln(r.value):!1}var hn=class extends _regexptoast.BaseRegExpVisitor{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){_lodashes.includes.call(void 0, this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?hr(e,this.targetCharCodes)===void 0&&(this.found=!0):hr(e,this.targetCharCodes)!==void 0&&(this.found=!0)}};function ft(r,e){if(e instanceof RegExp){let t=_e(e),n=new hn(r);return n.visit(t),n.found}else return _lodashes.find.call(void 0, e,t=>_lodashes.includes.call(void 0, r,t.charCodeAt(0)))!==void 0}var fe="PATTERN",Ce="defaultMode",pt="modes",pn=typeof new RegExp("(?:)").sticky=="boolean";function Nr(r,e){e=_lodashes.defaults.call(void 0, e,{useSticky:pn,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(p,d)=>d()});let t=e.tracer;t("initCharCodeToOptimizedIndexMap",()=>{lo()});let n;t("Reject Lexer.NA",()=>{n=_lodashes.reject.call(void 0, r,p=>p[fe]===C.NA)});let i=!1,s;t("Transform Patterns",()=>{i=!1,s=_lodashes.map.call(void 0, n,p=>{let d=p[fe];if(_lodashes.isRegExp.call(void 0, d)){let R=d.source;return R.length===1&&R!=="^"&&R!=="$"&&R!=="."&&!d.ignoreCase?R:R.length===2&&R[0]==="\\"&&!_lodashes.includes.call(void 0, ["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],R[1])?R[1]:e.useSticky?Er(d):mr(d)}else{if(_lodashes.isFunction.call(void 0, d))return i=!0,{exec:d};if(typeof d=="object")return i=!0,d;if(typeof d=="string"){if(d.length===1)return d;{let R=d.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),I=new RegExp(R);return e.useSticky?Er(I):mr(I)}}else throw Error("non exhaustive match")}})});let o,a,c,l,h;t("misc mapping",()=>{o=_lodashes.map.call(void 0, n,p=>p.tokenTypeIdx),a=_lodashes.map.call(void 0, n,p=>{let d=p.GROUP;if(d!==C.SKIPPED){if(_lodashes.isString.call(void 0, d))return d;if(_lodashes.isUndefined.call(void 0, d))return!1;throw Error("non exhaustive match")}}),c=_lodashes.map.call(void 0, n,p=>{let d=p.LONGER_ALT;if(d)return _lodashes.isArray.call(void 0, d)?_lodashes.map.call(void 0, d,I=>_lodashes.indexOf.call(void 0, n,I)):[_lodashes.indexOf.call(void 0, n,d)]}),l=_lodashes.map.call(void 0, n,p=>p.PUSH_MODE),h=_lodashes.map.call(void 0, n,p=>_lodashes.has.call(void 0, p,"POP_MODE"))});let u;t("Line Terminator Handling",()=>{let p=kr(e.lineTerminatorCharacters);u=_lodashes.map.call(void 0, n,d=>!1),e.positionTracking!=="onlyOffset"&&(u=_lodashes.map.call(void 0, n,d=>_lodashes.has.call(void 0, d,"LINE_BREAKS")?!!d.LINE_BREAKS:yr(d,p)===!1&&ft(p,d.PATTERN)))});let f,m,T,g;t("Misc Mapping #2",()=>{f=_lodashes.map.call(void 0, n,Cr),m=_lodashes.map.call(void 0, s,ao),T=_lodashes.reduce.call(void 0, n,(p,d)=>{let R=d.GROUP;return _lodashes.isString.call(void 0, R)&&R!==C.SKIPPED&&(p[R]=[]),p},{}),g=_lodashes.map.call(void 0, s,(p,d)=>({pattern:s[d],longerAlt:c[d],canLineTerminator:u[d],isCustom:f[d],short:m[d],group:a[d],push:l[d],pop:h[d],tokenTypeIdx:o[d],tokenType:n[d]}))});let A=!0,E=[];return e.safeMode||t("First Char Optimization",()=>{E=_lodashes.reduce.call(void 0, n,(p,d,R)=>{if(typeof d.PATTERN=="string"){let I=d.PATTERN.charCodeAt(0),b=W(I);dn(p,b,g[R])}else if(_lodashes.isArray.call(void 0, d.START_CHARS_HINT)){let I;_lodashes.forEach.call(void 0, d.START_CHARS_HINT,b=>{let st=typeof b=="string"?b.charCodeAt(0):b,D=W(st);I!==D&&(I=D,dn(p,D,g[R]))})}else if(_lodashes.isRegExp.call(void 0, d.PATTERN))if(d.PATTERN.unicode)A=!1,e.ensureOptimizations&&_utils.PRINT_ERROR.call(void 0, `${$e}	Unable to analyze < ${d.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{let I=dr(d.PATTERN,e.ensureOptimizations);_lodashes.isEmpty.call(void 0, I)&&(A=!1),_lodashes.forEach.call(void 0, I,b=>{dn(p,b,g[R])})}else e.ensureOptimizations&&_utils.PRINT_ERROR.call(void 0, `${$e}	TokenType: <${d.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return p},[])}),{emptyGroups:T,patternIdxToConfig:g,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:A}}function Sr(r,e){let t=[],n=Ys(r);t=t.concat(n.errors);let i=js(n.valid),s=i.valid;return t=t.concat(i.errors),t=t.concat(zs(s)),t=t.concat(no(s)),t=t.concat(ro(s,e)),t=t.concat(io(s)),t}function zs(r){let e=[],t=_lodashes.filter.call(void 0, r,n=>_lodashes.isRegExp.call(void 0, n[fe]));return e=e.concat(qs(t)),e=e.concat(Zs(t)),e=e.concat(eo(t)),e=e.concat(to(t)),e=e.concat(Js(t)),e}function Ys(r){let e=_lodashes.filter.call(void 0, r,i=>!_lodashes.has.call(void 0, i,fe)),t=_lodashes.map.call(void 0, e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:O.MISSING_PATTERN,tokenTypes:[i]})),n=_lodashes.difference.call(void 0, r,e);return{errors:t,valid:n}}function js(r){let e=_lodashes.filter.call(void 0, r,i=>{let s=i[fe];return!_lodashes.isRegExp.call(void 0, s)&&!_lodashes.isFunction.call(void 0, s)&&!_lodashes.has.call(void 0, s,"exec")&&!_lodashes.isString.call(void 0, s)}),t=_lodashes.map.call(void 0, e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:O.INVALID_PATTERN,tokenTypes:[i]})),n=_lodashes.difference.call(void 0, r,e);return{errors:t,valid:n}}var Xs=/[^\\][$]/;function qs(r){class e extends _regexptoast.BaseRegExpVisitor{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}let t=_lodashes.filter.call(void 0, r,i=>{let s=i.PATTERN;try{let o=_e(s),a=new e;return a.visit(o),a.found}catch (e2){return Xs.test(s.source)}});return _lodashes.map.call(void 0, t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:O.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Js(r){let e=_lodashes.filter.call(void 0, r,n=>n.PATTERN.test(""));return _lodashes.map.call(void 0, e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:O.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}var Qs=/[^\\[][\^]|^\^/;function Zs(r){class e extends _regexptoast.BaseRegExpVisitor{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}let t=_lodashes.filter.call(void 0, r,i=>{let s=i.PATTERN;try{let o=_e(s),a=new e;return a.visit(o),a.found}catch (e3){return Qs.test(s.source)}});return _lodashes.map.call(void 0, t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:O.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function eo(r){let e=_lodashes.filter.call(void 0, r,n=>{let i=n[fe];return i instanceof RegExp&&(i.multiline||i.global)});return _lodashes.map.call(void 0, e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:O.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function to(r){let e=[],t=_lodashes.map.call(void 0, r,s=>_lodashes.reduce.call(void 0, r,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!_lodashes.includes.call(void 0, e,a)&&a.PATTERN!==C.NA&&(e.push(a),o.push(a)),o),[]));t=_lodashes.compact.call(void 0, t);let n=_lodashes.filter.call(void 0, t,s=>s.length>1);return _lodashes.map.call(void 0, n,s=>{let o=_lodashes.map.call(void 0, s,c=>c.name);return{message:`The same RegExp pattern ->${_lodashes.first.call(void 0, s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:O.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function no(r){let e=_lodashes.filter.call(void 0, r,n=>{if(!_lodashes.has.call(void 0, n,"GROUP"))return!1;let i=n.GROUP;return i!==C.SKIPPED&&i!==C.NA&&!_lodashes.isString.call(void 0, i)});return _lodashes.map.call(void 0, e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:O.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function ro(r,e){let t=_lodashes.filter.call(void 0, r,i=>i.PUSH_MODE!==void 0&&!_lodashes.includes.call(void 0, e,i.PUSH_MODE));return _lodashes.map.call(void 0, t,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:O.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function io(r){let e=[],t=_lodashes.reduce.call(void 0, r,(n,i,s)=>{let o=i.PATTERN;return o===C.NA||(_lodashes.isString.call(void 0, o)?n.push({str:o,idx:s,tokenType:i}):_lodashes.isRegExp.call(void 0, o)&&oo(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return _lodashes.forEach.call(void 0, r,(n,i)=>{_lodashes.forEach.call(void 0, t,({str:s,idx:o,tokenType:a})=>{if(i<o&&so(s,n.PATTERN)){let c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:O.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function so(r,e){if(_lodashes.isRegExp.call(void 0, e)){let t=e.exec(r);return t!==null&&t.index===0}else{if(_lodashes.isFunction.call(void 0, e))return e(r,0,[],{});if(_lodashes.has.call(void 0, e,"exec"))return e.exec(r,0,[],{});if(typeof e=="string")return e===r;throw Error("non exhaustive match")}}function oo(r){return _lodashes.find.call(void 0, [".","\\","[","]","|","^","$","(",")","?","*","+","{"],t=>r.source.indexOf(t)!==-1)===void 0}function mr(r){let e=r.ignoreCase?"i":"";return new RegExp(`^(?:${r.source})`,e)}function Er(r){let e=r.ignoreCase?"iy":"y";return new RegExp(`${r.source}`,e)}function Or(r,e,t){let n=[];return _lodashes.has.call(void 0, r,Ce)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ce+`> property in its definition
`,type:O.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),_lodashes.has.call(void 0, r,pt)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+pt+`> property in its definition
`,type:O.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),_lodashes.has.call(void 0, r,pt)&&_lodashes.has.call(void 0, r,Ce)&&!_lodashes.has.call(void 0, r.modes,r.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Ce}: <${r.defaultMode}>which does not exist
`,type:O.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),_lodashes.has.call(void 0, r,pt)&&_lodashes.forEach.call(void 0, r.modes,(i,s)=>{_lodashes.forEach.call(void 0, i,(o,a)=>{if(_lodashes.isUndefined.call(void 0, o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:O.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(_lodashes.has.call(void 0, o,"LONGER_ALT")){let c=_lodashes.isArray.call(void 0, o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];_lodashes.forEach.call(void 0, c,l=>{!_lodashes.isUndefined.call(void 0, l)&&!_lodashes.includes.call(void 0, i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:O.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function _r(r,e,t){let n=[],i=!1,s=_lodashes.compact.call(void 0, _lodashes.flatten.call(void 0, _lodashes.values.call(void 0, r.modes))),o=_lodashes.reject.call(void 0, s,c=>c[fe]===C.NA),a=kr(t);return e&&_lodashes.forEach.call(void 0, o,c=>{let l=yr(c,a);if(l!==!1){let u={message:co(c,l),type:l.issue,tokenType:c};n.push(u)}else _lodashes.has.call(void 0, c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):ft(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:O.NO_LINE_BREAKS_FLAGS}),n}function xr(r){let e={},t=_lodashes.keys.call(void 0, r);return _lodashes.forEach.call(void 0, t,n=>{let i=r[n];if(_lodashes.isArray.call(void 0, i))e[n]=[];else throw Error("non exhaustive match")}),e}function Cr(r){let e=r.PATTERN;if(_lodashes.isRegExp.call(void 0, e))return!1;if(_lodashes.isFunction.call(void 0, e))return!0;if(_lodashes.has.call(void 0, e,"exec"))return!0;if(_lodashes.isString.call(void 0, e))return!1;throw Error("non exhaustive match")}function ao(r){return _lodashes.isString.call(void 0, r)&&r.length===1?r.charCodeAt(0):!1}var Lr={test:function(r){let e=r.length;for(let t=this.lastIndex;t<e;t++){let n=r.charCodeAt(t);if(n===10)return this.lastIndex=t+1,!0;if(n===13)return r.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function yr(r,e){if(_lodashes.has.call(void 0, r,"LINE_BREAKS"))return!1;if(_lodashes.isRegExp.call(void 0, r.PATTERN)){try{ft(e,r.PATTERN)}catch(t){return{issue:O.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(_lodashes.isString.call(void 0, r.PATTERN))return!1;if(Cr(r))return{issue:O.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function co(r,e){if(e.issue===O.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${r.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===O.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${r.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function kr(r){return _lodashes.map.call(void 0, r,t=>_lodashes.isString.call(void 0, t)?t.charCodeAt(0):t)}function dn(r,e,t){r[e]===void 0?r[e]=[t]:r[e].push(t)}var xe=256,mt=[];function W(r){return r<xe?r:mt[r]}function lo(){if(_lodashes.isEmpty.call(void 0, mt)){mt=new Array(65536);for(let r=0;r<65536;r++)mt[r]=r>255?255+~~(r/255):r}}function Q(r,e){let t=r.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function Le(r,e){return r.tokenTypeIdx===e.tokenTypeIdx}var Pr=1,vr={};function Z(r){let e=Ro(r);Io(e),No(e),Ao(e),_lodashes.forEach.call(void 0, e,t=>{t.isParent=t.categoryMatches.length>0})}function Ro(r){let e=_lodashes.clone.call(void 0, r),t=r,n=!0;for(;n;){t=_lodashes.compact.call(void 0, _lodashes.flatten.call(void 0, _lodashes.map.call(void 0, t,s=>s.CATEGORIES)));let i=_lodashes.difference.call(void 0, t,e);e=e.concat(i),_lodashes.isEmpty.call(void 0, i)?n=!1:t=i}return e}function Io(r){_lodashes.forEach.call(void 0, r,e=>{mn(e)||(vr[Pr]=e,e.tokenTypeIdx=Pr++),Mr(e)&&!_lodashes.isArray.call(void 0, e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Mr(e)||(e.CATEGORIES=[]),So(e)||(e.categoryMatches=[]),Oo(e)||(e.categoryMatchesMap={})})}function Ao(r){_lodashes.forEach.call(void 0, r,e=>{e.categoryMatches=[],_lodashes.forEach.call(void 0, e.categoryMatchesMap,(t,n)=>{e.categoryMatches.push(vr[n].tokenTypeIdx)})})}function No(r){_lodashes.forEach.call(void 0, r,e=>{wr([],e)})}function wr(r,e){_lodashes.forEach.call(void 0, r,t=>{e.categoryMatchesMap[t.tokenTypeIdx]=!0}),_lodashes.forEach.call(void 0, e.CATEGORIES,t=>{let n=r.concat(e);_lodashes.includes.call(void 0, n,t)||wr(n,t)})}function mn(r){return _lodashes.has.call(void 0, r,"tokenTypeIdx")}function Mr(r){return _lodashes.has.call(void 0, r,"CATEGORIES")}function So(r){return _lodashes.has.call(void 0, r,"categoryMatches")}function Oo(r){return _lodashes.has.call(void 0, r,"categoryMatchesMap")}function br(r){return _lodashes.has.call(void 0, r,"tokenTypeIdx")}var En={buildUnableToPopLexerModeMessage(r){return`Unable to pop Lexer Mode after encountering Token ->${r.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(r,e,t,n,i){return`unexpected character: ->${r.charAt(e)}<- at offset: ${e}, skipped ${t} characters.`}};var O;(function(r){r[r.MISSING_PATTERN=0]="MISSING_PATTERN",r[r.INVALID_PATTERN=1]="INVALID_PATTERN",r[r.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",r[r.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",r[r.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",r[r.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",r[r.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",r[r.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",r[r.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",r[r.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",r[r.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",r[r.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",r[r.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",r[r.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",r[r.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",r[r.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",r[r.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",r[r.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(O||(O={}));var We={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:En,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(We);var C=class{constructor(e,t=We){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;let o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);let{time:a,value:c}=_utils.timer.call(void 0, s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=_lodashes.assign.call(void 0, {},We,t);let n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===We.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Lr;else if(this.config.lineTerminatorCharacters===We.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),_lodashes.isArray.call(void 0, e)?i={modes:{defaultMode:_lodashes.clone.call(void 0, e)},defaultMode:Ce}:(s=!1,i=_lodashes.clone.call(void 0, e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Or(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(_r(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},_lodashes.forEach.call(void 0, i.modes,(a,c)=>{i.modes[c]=_lodashes.reject.call(void 0, a,l=>_lodashes.isUndefined.call(void 0, l))});let o=_lodashes.keys.call(void 0, i.modes);if(_lodashes.forEach.call(void 0, i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Sr(a,o))}),_lodashes.isEmpty.call(void 0, this.lexerDefinitionErrors)){Z(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Nr(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=_lodashes.assign.call(void 0, {},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!_lodashes.isEmpty.call(void 0, this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){let c=_lodashes.map.call(void 0, this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}_lodashes.forEach.call(void 0, this.lexerDefinitionWarning,a=>{_utils.PRINT_WARNING.call(void 0, a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(pn?(this.chopInput=_lodashes.identity,this.match=this.matchWithTest):(this.updateLastIndex=_lodashes.noop,this.match=this.matchWithExec),s&&(this.handleModes=_lodashes.noop),this.trackStartLines===!1&&(this.computeNewColumn=_lodashes.identity),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=_lodashes.noop),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{let a=_lodashes.reduce.call(void 0, this.canModeBeOptimized,(c,l,h)=>(l===!1&&c.push(h),c),[]);if(t.ensureOptimizations&&!_lodashes.isEmpty.call(void 0, a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{lr()}),this.TRACE_INIT("toFastProperties",()=>{_utils.toFastProperties.call(void 0, this)})})}tokenize(e,t=this.defaultMode){if(!_lodashes.isEmpty.call(void 0, this.lexerDefinitionErrors)){let i=_lodashes.map.call(void 0, this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,t)}tokenizeInternal(e,t){let n,i,s,o,a,c,l,h,u,f,m,T,g,A,E,p,d=e,R=d.length,I=0,b=0,st=this.hasCustom?0:Math.floor(e.length/10),D=new Array(st),Fe=[],he=this.trackStartLines?1:void 0,ne=this.trackStartLines?1:void 0,Ue=xr(this.emptyGroups),ss=this.trackStartLines,rn=this.config.lineTerminatorsPattern,ot=0,re=[],De=[],at=[],Jn=[];Object.freeze(Jn);let Ge;function Qn(){return re}function Zn(y){let U=W(y),Oe=De[U];return Oe===void 0?Jn:Oe}let os=y=>{if(at.length===1&&y.tokenType.PUSH_MODE===void 0){let U=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(y);Fe.push({offset:y.startOffset,line:y.startLine,column:y.startColumn,length:y.image.length,message:U})}else{at.pop();let U=_lodashes.last.call(void 0, at);re=this.patternIdxToConfig[U],De=this.charCodeToPatternIdxToConfig[U],ot=re.length;let Oe=this.canModeBeOptimized[U]&&this.config.safeMode===!1;De&&Oe?Ge=Zn:Ge=Qn}};function er(y){at.push(y),De=this.charCodeToPatternIdxToConfig[y],re=this.patternIdxToConfig[y],ot=re.length,ot=re.length;let U=this.canModeBeOptimized[y]&&this.config.safeMode===!1;De&&U?Ge=Zn:Ge=Qn}er.call(this,t);let G,tr=this.config.recoveryEnabled;for(;I<R;){c=null;let y=d.charCodeAt(I),U=Ge(y),Oe=U.length;for(n=0;n<Oe;n++){G=U[n];let F=G.pattern;l=null;let Y=G.short;if(Y!==!1?y===Y&&(c=F):G.isCustom===!0?(p=F.exec(d,I,D,Ue),p!==null?(c=p[0],p.payload!==void 0&&(l=p.payload)):c=null):(this.updateLastIndex(F,I),c=this.match(F,e,I)),c!==null){if(a=G.longerAlt,a!==void 0){let ie=a.length;for(s=0;s<ie;s++){let j=re[a[s]],ue=j.pattern;if(h=null,j.isCustom===!0?(p=ue.exec(d,I,D,Ue),p!==null?(o=p[0],p.payload!==void 0&&(h=p.payload)):o=null):(this.updateLastIndex(ue,I),o=this.match(ue,e,I)),o&&o.length>c.length){c=o,l=h,G=j;break}}}break}}if(c!==null){if(u=c.length,f=G.group,f!==void 0&&(m=G.tokenTypeIdx,T=this.createTokenInstance(c,I,m,G.tokenType,he,ne,u),this.handlePayload(T,l),f===!1?b=this.addToken(D,b,T):Ue[f].push(T)),e=this.chopInput(e,u),I=I+u,ne=this.computeNewColumn(ne,u),ss===!0&&G.canLineTerminator===!0){let F=0,Y,ie;rn.lastIndex=0;do Y=rn.test(c),Y===!0&&(ie=rn.lastIndex-1,F++);while(Y===!0);F!==0&&(he=he+F,ne=u-ie,this.updateTokenEndLineColumnLocation(T,f,ie,F,he,ne,u))}this.handleModes(G,os,er,T)}else{let F=I,Y=he,ie=ne,j=tr===!1;for(;j===!1&&I<R;)for(e=this.chopInput(e,1),I++,i=0;i<ot;i++){let ue=re[i],sn=ue.pattern,nr=ue.short;if(nr!==!1?d.charCodeAt(I)===nr&&(j=!0):ue.isCustom===!0?j=sn.exec(d,I,D,Ue)!==null:(this.updateLastIndex(sn,I),j=sn.exec(e)!==null),j===!0)break}if(g=I-F,ne=this.computeNewColumn(ne,g),E=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(d,F,g,Y,ie),Fe.push({offset:F,line:Y,column:ie,length:g,message:E}),tr===!1)break}}return this.hasCustom||(D.length=b),{tokens:D,groups:Ue,errors:Fe}}handleModes(e,t,n,i){if(e.pop===!0){let s=e.push;t(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,t){return e.substring(t)}updateLastIndex(e,t){e.lastIndex=t}updateTokenEndLineColumnLocation(e,t,n,i,s,o,a){let c,l;t!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,t){return e+t}createOffsetOnlyToken(e,t,n,i){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,t,n,i,s,o){return{image:e,startOffset:t,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,t,n,i,s,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,t,n){return e.push(n),t}addTokenUsingMemberAccess(e,t,n){return e[t]=n,t++,t}handlePayloadNoCustom(e,t){}handlePayloadWithCustom(e,t){t!==null&&(e.payload=t)}matchWithTest(e,t,n){return e.test(t)===!0?t.substring(n,e.lastIndex):null}matchWithExec(e,t){let n=e.exec(t);return n!==null?n[0]:null}};C.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";C.NA=/NOT_APPLICABLE/;function me(r){return Rn(r)?r.LABEL:r.name}function Rn(r){return _lodashes.isString.call(void 0, r.LABEL)&&r.LABEL!==""}var Fo="parent",$r="categories",Br="label",Wr="group",Kr="push_mode",Hr="pop_mode",Vr="longer_alt",zr="line_breaks",Yr="start_chars_hint";function x(r){return Uo(r)}function Uo(r){let e=r.pattern,t={};if(t.name=r.name,_lodashes.isUndefined.call(void 0, e)||(t.PATTERN=e),_lodashes.has.call(void 0, r,Fo))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return _lodashes.has.call(void 0, r,$r)&&(t.CATEGORIES=r[$r]),Z([t]),_lodashes.has.call(void 0, r,Br)&&(t.LABEL=r[Br]),_lodashes.has.call(void 0, r,Wr)&&(t.GROUP=r[Wr]),_lodashes.has.call(void 0, r,Hr)&&(t.POP_MODE=r[Hr]),_lodashes.has.call(void 0, r,Kr)&&(t.PUSH_MODE=r[Kr]),_lodashes.has.call(void 0, r,Vr)&&(t.LONGER_ALT=r[Vr]),_lodashes.has.call(void 0, r,zr)&&(t.LINE_BREAKS=r[zr]),_lodashes.has.call(void 0, r,Yr)&&(t.START_CHARS_HINT=r[Yr]),t}var $=x({name:"EOF",pattern:C.NA});Z([$]);function Ee(r,e,t,n,i,s,o,a){return{image:e,startOffset:t,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:r.tokenTypeIdx,tokenType:r}}function In(r,e){return Q(r,e)}var At={buildMismatchTokenMessage({expected:r,actual:e,previous:t,ruleName:n}){return`Expecting ${Rn(r)?`--> ${me(r)} <--`:`token of type --> ${r.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:r,ruleName:e}){return"Redundant input, expecting EOF but found: "+r.image},buildNoViableAltMessage({expectedPathsPerAlt:r,actual:e,previous:t,customUserDescription:n,ruleName:i}){let s="Expecting: ",a=`
but found: '`+_lodashes.first.call(void 0, e).image+"'";if(n)return s+n+a;{let c=_lodashes.reduce.call(void 0, r,(f,m)=>f.concat(m),[]),l=_lodashes.map.call(void 0, c,f=>`[${_lodashes.map.call(void 0, f,m=>me(m)).join(", ")}]`),u=`one of these possible Token sequences:
${_lodashes.map.call(void 0, l,(f,m)=>`  ${m+1}. ${f}`).join(`
`)}`;return s+u+a}},buildEarlyExitMessage({expectedIterationPaths:r,actual:e,customUserDescription:t,ruleName:n}){let i="Expecting: ",o=`
but found: '`+_lodashes.first.call(void 0, e).image+"'";if(t)return i+t+o;{let c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${_lodashes.map.call(void 0, r,l=>`[${_lodashes.map.call(void 0, l,h=>me(h)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(At);var Xr={buildRuleNotFoundError(r,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+r.name+"<-"}},B={buildDuplicateFoundError(r,e){function t(h){return h instanceof _gast.Terminal?h.terminalType.name:h instanceof _gast.NonTerminal?h.nonTerminalName:""}let n=r.name,i=_lodashes.first.call(void 0, e),s=i.idx,o=_gast.getProductionDslName.call(void 0, i),a=t(i),c=s>0,l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(r){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${r.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(r){let e=_lodashes.map.call(void 0, r.prefixPath,i=>me(i)).join(", "),t=r.alternation.idx===0?"":r.alternation.idx;return`Ambiguous alternatives: <${r.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${t}> inside <${r.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(r){let e=_lodashes.map.call(void 0, r.prefixPath,i=>me(i)).join(", "),t=r.alternation.idx===0?"":r.alternation.idx,n=`Ambiguous Alternatives Detected: <${r.ambiguityIndices.join(" ,")}> in <OR${t}> inside <${r.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(r){let e=_gast.getProductionDslName.call(void 0, r.repetition);return r.repetition.idx!==0&&(e+=r.repetition.idx),`The repetition <${e}> within Rule <${r.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(r){return"deprecated"},buildEmptyAlternationError(r){return`Ambiguous empty alternative: <${r.emptyChoiceIdx+1}> in <OR${r.alternation.idx}> inside <${r.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(r){return`An Alternation cannot have more than 256 alternatives:
<OR${r.alternation.idx}> inside <${r.topLevelRule.name}> Rule.
 has ${r.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(r){let e=r.topLevelRule.name,t=_lodashes.map.call(void 0, r.leftRecursionPath,s=>s.name),n=`${e} --> ${t.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(r){return"deprecated"},buildDuplicateRuleNameError(r){let e;return r.topLevelRule instanceof _gast.Rule?e=r.topLevelRule.name:e=r.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${r.grammarName}<-`}};function qr(r,e){let t=new Nn(r,e);return t.resolveRefs(),t.errors}var Nn=class extends _gast.GAstVisitor{constructor(e,t){super(),this.nameToTopRule=e,this.errMsgProvider=t,this.errors=[]}resolveRefs(){_lodashes.forEach.call(void 0, _lodashes.values.call(void 0, this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){let t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{let n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:L.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}};var Sn=class extends X{constructor(e,t){super(),this.topProd=e,this.path=t,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_lodashes.clone.call(void 0, this.path.ruleStack).reverse(),this.occurrenceStack=_lodashes.clone.call(void 0, this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,t=[]){this.found||super.walk(e,t)}walkProdRef(e,t,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){let i=t.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){_lodashes.isEmpty.call(void 0, this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}},Ot=class extends Sn{constructor(e,t){super(e,t),this.path=t,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,t,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){let i=t.concat(n),s=new (0, _gast.Alternative)({definition:i});this.possibleTokTypes=de(s),this.found=!0}}},ye=class extends X{constructor(e,t){super(),this.topRule=e,this.occurrence=t,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}},_t=class extends ye{walkMany(e,t,n){if(e.idx===this.occurrence){let i=_lodashes.first.call(void 0, t.concat(n));this.result.isEndOfRule=i===void 0,i instanceof _gast.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,t,n)}},Ke=class extends ye{walkManySep(e,t,n){if(e.idx===this.occurrence){let i=_lodashes.first.call(void 0, t.concat(n));this.result.isEndOfRule=i===void 0,i instanceof _gast.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,t,n)}},xt=class extends ye{walkAtLeastOne(e,t,n){if(e.idx===this.occurrence){let i=_lodashes.first.call(void 0, t.concat(n));this.result.isEndOfRule=i===void 0,i instanceof _gast.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,t,n)}},He=class extends ye{walkAtLeastOneSep(e,t,n){if(e.idx===this.occurrence){let i=_lodashes.first.call(void 0, t.concat(n));this.result.isEndOfRule=i===void 0,i instanceof _gast.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,t,n)}};function Lt(r,e,t=[]){t=_lodashes.clone.call(void 0, t);let n=[],i=0;function s(a){return a.concat(_lodashes.drop.call(void 0, r,i+1))}function o(a){let c=Lt(s(a),e,t);return n.concat(c)}for(;t.length<e&&i<r.length;){let a=r[i];if(a instanceof _gast.Alternative)return o(a.definition);if(a instanceof _gast.NonTerminal)return o(a.definition);if(a instanceof _gast.Option)n=o(a.definition);else if(a instanceof _gast.RepetitionMandatory){let c=a.definition.concat([new (0, _gast.Repetition)({definition:a.definition})]);return o(c)}else if(a instanceof _gast.RepetitionMandatoryWithSeparator){let c=[new (0, _gast.Alternative)({definition:a.definition}),new (0, _gast.Repetition)({definition:[new (0, _gast.Terminal)({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof _gast.RepetitionWithSeparator){let c=a.definition.concat([new (0, _gast.Repetition)({definition:[new (0, _gast.Terminal)({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof _gast.Repetition){let c=a.definition.concat([new (0, _gast.Repetition)({definition:a.definition})]);n=o(c)}else{if(a instanceof _gast.Alternation)return _lodashes.forEach.call(void 0, a.definition,c=>{_lodashes.isEmpty.call(void 0, c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof _gast.Terminal)t.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:t,suffixDef:_lodashes.drop.call(void 0, r,i)}),n}function yt(r,e,t,n){let i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE",a=!1,c=e.length,l=c-n-1,h=[],u=[];for(u.push({idx:-1,def:r,ruleStack:[],occurrenceStack:[]});!_lodashes.isEmpty.call(void 0, u);){let f=u.pop();if(f===o){a&&_lodashes.last.call(void 0, u).idx<=l&&u.pop();continue}let m=f.def,T=f.idx,g=f.ruleStack,A=f.occurrenceStack;if(_lodashes.isEmpty.call(void 0, m))continue;let E=m[0];if(E===i){let p={idx:T,def:_lodashes.drop.call(void 0, m),ruleStack:_lodashes.dropRight.call(void 0, g),occurrenceStack:_lodashes.dropRight.call(void 0, A)};u.push(p)}else if(E instanceof _gast.Terminal)if(T<c-1){let p=T+1,d=e[p];if(t(d,E.terminalType)){let R={idx:p,def:_lodashes.drop.call(void 0, m),ruleStack:g,occurrenceStack:A};u.push(R)}}else if(T===c-1)h.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:g,occurrenceStack:A}),a=!0;else throw Error("non exhaustive match");else if(E instanceof _gast.NonTerminal){let p=_lodashes.clone.call(void 0, g);p.push(E.nonTerminalName);let d=_lodashes.clone.call(void 0, A);d.push(E.idx);let R={idx:T,def:E.definition.concat(s,_lodashes.drop.call(void 0, m)),ruleStack:p,occurrenceStack:d};u.push(R)}else if(E instanceof _gast.Option){let p={idx:T,def:_lodashes.drop.call(void 0, m),ruleStack:g,occurrenceStack:A};u.push(p),u.push(o);let d={idx:T,def:E.definition.concat(_lodashes.drop.call(void 0, m)),ruleStack:g,occurrenceStack:A};u.push(d)}else if(E instanceof _gast.RepetitionMandatory){let p=new (0, _gast.Repetition)({definition:E.definition,idx:E.idx}),d=E.definition.concat([p],_lodashes.drop.call(void 0, m)),R={idx:T,def:d,ruleStack:g,occurrenceStack:A};u.push(R)}else if(E instanceof _gast.RepetitionMandatoryWithSeparator){let p=new (0, _gast.Terminal)({terminalType:E.separator}),d=new (0, _gast.Repetition)({definition:[p].concat(E.definition),idx:E.idx}),R=E.definition.concat([d],_lodashes.drop.call(void 0, m)),I={idx:T,def:R,ruleStack:g,occurrenceStack:A};u.push(I)}else if(E instanceof _gast.RepetitionWithSeparator){let p={idx:T,def:_lodashes.drop.call(void 0, m),ruleStack:g,occurrenceStack:A};u.push(p),u.push(o);let d=new (0, _gast.Terminal)({terminalType:E.separator}),R=new (0, _gast.Repetition)({definition:[d].concat(E.definition),idx:E.idx}),I=E.definition.concat([R],_lodashes.drop.call(void 0, m)),b={idx:T,def:I,ruleStack:g,occurrenceStack:A};u.push(b)}else if(E instanceof _gast.Repetition){let p={idx:T,def:_lodashes.drop.call(void 0, m),ruleStack:g,occurrenceStack:A};u.push(p),u.push(o);let d=new (0, _gast.Repetition)({definition:E.definition,idx:E.idx}),R=E.definition.concat([d],_lodashes.drop.call(void 0, m)),I={idx:T,def:R,ruleStack:g,occurrenceStack:A};u.push(I)}else if(E instanceof _gast.Alternation)for(let p=E.definition.length-1;p>=0;p--){let d=E.definition[p],R={idx:T,def:d.definition.concat(_lodashes.drop.call(void 0, m)),ruleStack:g,occurrenceStack:A};u.push(R),u.push(o)}else if(E instanceof _gast.Alternative)u.push({idx:T,def:E.definition.concat(_lodashes.drop.call(void 0, m)),ruleStack:g,occurrenceStack:A});else if(E instanceof _gast.Rule)u.push(jo(E,T,g,A));else throw Error("non exhaustive match")}return h}function jo(r,e,t,n){let i=_lodashes.clone.call(void 0, t);i.push(r.name);let s=_lodashes.clone.call(void 0, n);return s.push(1),{idx:e,def:r.definition,ruleStack:i,occurrenceStack:s}}var _;(function(r){r[r.OPTION=0]="OPTION",r[r.REPETITION=1]="REPETITION",r[r.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",r[r.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",r[r.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",r[r.ALTERNATION=5]="ALTERNATION"})(_||(_={}));function Mt(r){if(r instanceof _gast.Option||r==="Option")return _.OPTION;if(r instanceof _gast.Repetition||r==="Repetition")return _.REPETITION;if(r instanceof _gast.RepetitionMandatory||r==="RepetitionMandatory")return _.REPETITION_MANDATORY;if(r instanceof _gast.RepetitionMandatoryWithSeparator||r==="RepetitionMandatoryWithSeparator")return _.REPETITION_MANDATORY_WITH_SEPARATOR;if(r instanceof _gast.RepetitionWithSeparator||r==="RepetitionWithSeparator")return _.REPETITION_WITH_SEPARATOR;if(r instanceof _gast.Alternation||r==="Alternation")return _.ALTERNATION;throw Error("non exhaustive match")}function li(r,e,t,n,i,s){let o=Ve(r,e,t),a=mi(o)?Le:Q;return s(o,n,a,i)}function hi(r,e,t,n,i,s){let o=ze(r,e,i,t),a=mi(o)?Le:Q;return s(o[0],a,n)}function ui(r,e,t,n){let i=r.length,s=_lodashes.every.call(void 0, r,o=>_lodashes.every.call(void 0, o,a=>a.length===1));if(e)return function(o){let a=_lodashes.map.call(void 0, o,c=>c.GATE);for(let c=0;c<i;c++){let l=r[c],h=l.length,u=a[c];if(!(u!==void 0&&u.call(this)===!1))e:for(let f=0;f<h;f++){let m=l[f],T=m.length;for(let g=0;g<T;g++){let A=this.LA(g+1);if(t(A,m[g])===!1)continue e}return c}}};if(s&&!n){let o=_lodashes.map.call(void 0, r,c=>_lodashes.flatten.call(void 0, c)),a=_lodashes.reduce.call(void 0, o,(c,l,h)=>(_lodashes.forEach.call(void 0, l,u=>{_lodashes.has.call(void 0, c,u.tokenTypeIdx)||(c[u.tokenTypeIdx]=h),_lodashes.forEach.call(void 0, u.categoryMatches,f=>{_lodashes.has.call(void 0, c,f)||(c[f]=h)})}),c),{});return function(){let c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){let a=r[o],c=a.length;e:for(let l=0;l<c;l++){let h=a[l],u=h.length;for(let f=0;f<u;f++){let m=this.LA(f+1);if(t(m,h[f])===!1)continue e}return o}}}}function di(r,e,t){let n=_lodashes.every.call(void 0, r,s=>s.length===1),i=r.length;if(n&&!t){let s=_lodashes.flatten.call(void 0, r);if(s.length===1&&_lodashes.isEmpty.call(void 0, s[0].categoryMatches)){let a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{let o=_lodashes.reduce.call(void 0, s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,_lodashes.forEach.call(void 0, c.categoryMatches,h=>{a[h]=!0}),a),[]);return function(){let a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){let o=r[s],a=o.length;for(let c=0;c<a;c++){let l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}var _n=class extends X{constructor(e,t,n){super(),this.topProd=e,this.targetOccurrence=t,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,t,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===t?(this.restDef=n.concat(i),!0):!1}walkOption(e,t,n){this.checkIsTarget(e,_.OPTION,t,n)||super.walkOption(e,t,n)}walkAtLeastOne(e,t,n){this.checkIsTarget(e,_.REPETITION_MANDATORY,t,n)||super.walkOption(e,t,n)}walkAtLeastOneSep(e,t,n){this.checkIsTarget(e,_.REPETITION_MANDATORY_WITH_SEPARATOR,t,n)||super.walkOption(e,t,n)}walkMany(e,t,n){this.checkIsTarget(e,_.REPETITION,t,n)||super.walkOption(e,t,n)}walkManySep(e,t,n){this.checkIsTarget(e,_.REPETITION_WITH_SEPARATOR,t,n)||super.walkOption(e,t,n)}},Pt=class extends _gast.GAstVisitor{constructor(e,t,n){super(),this.targetOccurrence=e,this.targetProdType=t,this.targetRef=n,this.result=[]}checkIsTarget(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,_.OPTION)}visitRepetition(e){this.checkIsTarget(e,_.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,_.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,_.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,_.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,_.ALTERNATION)}};function oi(r){let e=new Array(r);for(let t=0;t<r;t++)e[t]=[];return e}function On(r){let e=[""];for(let t=0;t<r.length;t++){let n=r[t],i=[];for(let s=0;s<e.length;s++){let o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){let c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function na(r,e,t){for(let n=0;n<r.length;n++){if(n===t)continue;let i=r[n];for(let s=0;s<e.length;s++){let o=e[s];if(i[o]===!0)return!1}}return!0}function fi(r,e){let t=_lodashes.map.call(void 0, r,o=>Lt([o],1)),n=oi(t.length),i=_lodashes.map.call(void 0, t,o=>{let a={};return _lodashes.forEach.call(void 0, o,c=>{let l=On(c.partialPath);_lodashes.forEach.call(void 0, l,h=>{a[h]=!0})}),a}),s=t;for(let o=1;o<=e;o++){let a=s;s=oi(a.length);for(let c=0;c<a.length;c++){let l=a[c];for(let h=0;h<l.length;h++){let u=l[h].partialPath,f=l[h].suffixDef,m=On(u);if(na(i,m,c)||_lodashes.isEmpty.call(void 0, f)||u.length===e){let g=n[c];if(vt(g,u)===!1){g.push(u);for(let A=0;A<m.length;A++){let E=m[A];i[c][E]=!0}}}else{let g=Lt(f,o+1,u);s[c]=s[c].concat(g),_lodashes.forEach.call(void 0, g,A=>{let E=On(A.partialPath);_lodashes.forEach.call(void 0, E,p=>{i[c][p]=!0})})}}}}return n}function Ve(r,e,t,n){let i=new Pt(r,_.ALTERNATION,n);return e.accept(i),fi(i.result,t)}function ze(r,e,t,n){let i=new Pt(r,t);e.accept(i);let s=i.result,a=new _n(e,r,t).startWalking(),c=new (0, _gast.Alternative)({definition:s}),l=new (0, _gast.Alternative)({definition:a});return fi([c,l],n)}function vt(r,e){e:for(let t=0;t<r.length;t++){let n=r[t];if(n.length===e.length){for(let i=0;i<n.length;i++){let s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function pi(r,e){return r.length<e.length&&_lodashes.every.call(void 0, r,(t,n)=>{let i=e[n];return t===i||i.categoryMatchesMap[t.tokenTypeIdx]})}function mi(r){return _lodashes.every.call(void 0, r,e=>_lodashes.every.call(void 0, e,t=>_lodashes.every.call(void 0, t,n=>_lodashes.isEmpty.call(void 0, n.categoryMatches))))}function Ai(r){let e=r.lookaheadStrategy.validate({rules:r.rules,tokenTypes:r.tokenTypes,grammarName:r.grammarName});return _lodashes.map.call(void 0, e,t=>Object.assign({type:L.CUSTOM_LOOKAHEAD_VALIDATION},t))}function Ni(r,e,t,n){let i=_lodashes.flatMap.call(void 0, r,c=>Aa(c,t)),s=Ca(r,e,t),o=_lodashes.flatMap.call(void 0, r,c=>Oa(c,t)),a=_lodashes.flatMap.call(void 0, r,c=>Sa(c,r,n,t));return i.concat(s,o,a)}function Aa(r,e){let t=new Cn;r.accept(t);let n=t.allProductions,i=_lodashes.groupBy.call(void 0, n,Na),s=_lodashes.pickBy.call(void 0, i,a=>a.length>1);return _lodashes.map.call(void 0, _lodashes.values.call(void 0, s),a=>{let c=_lodashes.first.call(void 0, a),l=e.buildDuplicateFoundError(r,a),h=_gast.getProductionDslName.call(void 0, c),u={message:l,type:L.DUPLICATE_PRODUCTIONS,ruleName:r.name,dslName:h,occurrence:c.idx},f=Si(c);return f&&(u.parameter=f),u})}function Na(r){return`${_gast.getProductionDslName.call(void 0, r)}_#_${r.idx}_#_${Si(r)}`}function Si(r){return r instanceof _gast.Terminal?r.terminalType.name:r instanceof _gast.NonTerminal?r.nonTerminalName:""}var Cn=class extends _gast.GAstVisitor{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}};function Sa(r,e,t,n){let i=[];if(_lodashes.reduce.call(void 0, e,(o,a)=>a.name===r.name?o+1:o,0)>1){let o=n.buildDuplicateRuleNameError({topLevelRule:r,grammarName:t});i.push({message:o,type:L.DUPLICATE_RULE_NAME,ruleName:r.name})}return i}function Oi(r,e,t){let n=[],i;return _lodashes.includes.call(void 0, e,r)||(i=`Invalid rule override, rule: ->${r}<- cannot be overridden in the grammar: ->${t}<-as it is not defined in any of the super grammars `,n.push({message:i,type:L.INVALID_RULE_OVERRIDE,ruleName:r})),n}function Mn(r,e,t,n=[]){let i=[],s=wt(e.definition);if(_lodashes.isEmpty.call(void 0, s))return[];{let o=r.name;_lodashes.includes.call(void 0, s,r)&&i.push({message:t.buildLeftRecursionError({topLevelRule:r,leftRecursionPath:n}),type:L.LEFT_RECURSION,ruleName:o});let c=_lodashes.difference.call(void 0, s,n.concat([r])),l=_lodashes.flatMap.call(void 0, c,h=>{let u=_lodashes.clone.call(void 0, n);return u.push(h),Mn(r,h,t,u)});return i.concat(l)}}function wt(r){let e=[];if(_lodashes.isEmpty.call(void 0, r))return e;let t=_lodashes.first.call(void 0, r);if(t instanceof _gast.NonTerminal)e.push(t.referencedRule);else if(t instanceof _gast.Alternative||t instanceof _gast.Option||t instanceof _gast.RepetitionMandatory||t instanceof _gast.RepetitionMandatoryWithSeparator||t instanceof _gast.RepetitionWithSeparator||t instanceof _gast.Repetition)e=e.concat(wt(t.definition));else if(t instanceof _gast.Alternation)e=_lodashes.flatten.call(void 0, _lodashes.map.call(void 0, t.definition,s=>wt(s.definition)));else if(!(t instanceof _gast.Terminal))throw Error("non exhaustive match");let n=_gast.isOptionalProd.call(void 0, t),i=r.length>1;if(n&&i){let s=_lodashes.drop.call(void 0, r);return e.concat(wt(s))}else return e}var je=class extends _gast.GAstVisitor{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}};function _i(r,e){let t=new je;r.accept(t);let n=t.alternations;return _lodashes.flatMap.call(void 0, n,s=>{let o=_lodashes.dropRight.call(void 0, s.definition);return _lodashes.flatMap.call(void 0, o,(a,c)=>{let l=yt([a],[],Q,1);return _lodashes.isEmpty.call(void 0, l)?[{message:e.buildEmptyAlternationError({topLevelRule:r,alternation:s,emptyChoiceIdx:c}),type:L.NONE_LAST_EMPTY_ALT,ruleName:r.name,occurrence:s.idx,alternative:c+1}]:[]})})}function xi(r,e,t){let n=new je;r.accept(n);let i=n.alternations;return i=_lodashes.reject.call(void 0, i,o=>o.ignoreAmbiguities===!0),_lodashes.flatMap.call(void 0, i,o=>{let a=o.idx,c=o.maxLookahead||e,l=Ve(a,r,c,o),h=_a(l,o,r,t),u=xa(l,o,r,t);return h.concat(u)})}var Ln=class extends _gast.GAstVisitor{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}};function Oa(r,e){let t=new je;r.accept(t);let n=t.alternations;return _lodashes.flatMap.call(void 0, n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:r,alternation:s}),type:L.TOO_MANY_ALTS,ruleName:r.name,occurrence:s.idx}]:[])}function Ci(r,e,t){let n=[];return _lodashes.forEach.call(void 0, r,i=>{let s=new Ln;i.accept(s);let o=s.allProductions;_lodashes.forEach.call(void 0, o,a=>{let c=Mt(a),l=a.maxLookahead||e,h=a.idx,f=ze(h,i,c,l)[0];if(_lodashes.isEmpty.call(void 0, _lodashes.flatten.call(void 0, f))){let m=t.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:m,type:L.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function _a(r,e,t,n){let i=[],s=_lodashes.reduce.call(void 0, r,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||_lodashes.forEach.call(void 0, c,h=>{let u=[l];_lodashes.forEach.call(void 0, r,(f,m)=>{l!==m&&vt(f,h)&&e.definition[m].ignoreAmbiguities!==!0&&u.push(m)}),u.length>1&&!vt(i,h)&&(i.push(h),a.push({alts:u,path:h}))}),a),[]);return _lodashes.map.call(void 0, s,a=>{let c=_lodashes.map.call(void 0, a.alts,h=>h+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:L.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:a.alts}})}function xa(r,e,t,n){let i=_lodashes.reduce.call(void 0, r,(o,a,c)=>{let l=_lodashes.map.call(void 0, a,h=>({idx:c,path:h}));return o.concat(l)},[]);return _lodashes.compact.call(void 0, _lodashes.flatMap.call(void 0, i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];let c=o.idx,l=o.path,h=_lodashes.filter.call(void 0, i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&pi(f.path,l));return _lodashes.map.call(void 0, h,f=>{let m=[f.idx+1,c+1],T=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:m,prefixPath:f.path}),type:L.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:T,alternatives:m}})}))}function Ca(r,e,t){let n=[],i=_lodashes.map.call(void 0, e,s=>s.name);return _lodashes.forEach.call(void 0, r,s=>{let o=s.name;if(_lodashes.includes.call(void 0, i,o)){let a=t.buildNamespaceConflictError(s);n.push({message:a,type:L.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function yi(r){let e=_lodashes.defaults.call(void 0, r,{errMsgProvider:Xr}),t={};return _lodashes.forEach.call(void 0, r.rules,n=>{t[n.name]=n}),qr(t,e.errMsgProvider)}function ki(r){return r=_lodashes.defaults.call(void 0, r,{errMsgProvider:B}),Ni(r.rules,r.tokenTypes,r.errMsgProvider,r.grammarName)}var Pi="MismatchedTokenException",Mi="NoViableAltException",vi="EarlyExitException",wi="NotAllInputParsedException",bi=[Pi,Mi,vi,wi];Object.freeze(bi);function ce(r){return _lodashes.includes.call(void 0, bi,r.name)}var ke=class extends Error{constructor(e,t){super(e),this.token=t,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},Ie=class extends ke{constructor(e,t,n){super(e,t),this.previousToken=n,this.name=Pi}},Xe=class extends ke{constructor(e,t,n){super(e,t),this.previousToken=n,this.name=Mi}},qe=class extends ke{constructor(e,t){super(e,t),this.name=wi}},Je=class extends ke{constructor(e,t,n){super(e,t),this.previousToken=n,this.name=vi}};var wn={},Fn="InRuleRecoveryException",bn=class extends Error{constructor(e){super(e),this.name=Fn}},Ft=class{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=_lodashes.has.call(void 0, e,"recoveryEnabled")?e.recoveryEnabled:v.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=ba)}getTokenToInsert(e){let t=Ee(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,n,i){let s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[],c=!1,l=this.LA(1),h=this.LA(1),u=()=>{let f=this.LA(0),m=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),T=new Ie(m,l,this.LA(0));T.resyncedTokens=_lodashes.dropRight.call(void 0, a),this.SAVE_ERROR(T)};for(;!c;)if(this.tokenMatcher(h,i)){u();return}else if(n.call(this)){u(),e.apply(this,t);return}else this.tokenMatcher(h,s)?c=!0:(h=this.SKIP_TOKEN(),this.addToResyncTokens(h,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,t,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))}getFollowsForInRuleRecovery(e,t){let n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){let n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new bn("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||_lodashes.isEmpty.call(void 0, t))return!1;let n=this.LA(1);return _lodashes.find.call(void 0, t,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){let t=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(t);return _lodashes.includes.call(void 0, n,e)}findReSyncTokenType(){let e=this.flattenFollowSet(),t=this.LA(1),n=2;for(;;){let i=_lodashes.find.call(void 0, e,s=>In(t,s));if(i!==void 0)return i;t=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return wn;let e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){let e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return _lodashes.map.call(void 0, e,(n,i)=>i===0?wn:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:t[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){let e=_lodashes.map.call(void 0, this.buildFullFollowKeyStack(),t=>this.getFollowSetFromFollowKey(t));return _lodashes.flatten.call(void 0, e)}getFollowSetFromFollowKey(e){if(e===wn)return[$];let t=e.ruleName+e.idxInCallingRule+ht+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,$)||t.push(e),t}reSyncTo(e){let t=[],n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return _lodashes.dropRight.call(void 0, t)}attemptInRepetitionRecovery(e,t,n,i,s,o,a){}getCurrentGrammarPath(e,t){let n=this.getHumanReadableRuleStack(),i=_lodashes.clone.call(void 0, this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return _lodashes.map.call(void 0, this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}};function ba(r,e,t,n,i,s,o){let a=this.getKeyForAutomaticLookahead(n,i),c=this.firstAfterRepMap[a];if(c===void 0){let f=this.getCurrRuleFullName(),m=this.getGAstProductions()[f];c=new s(m,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,h=c.occurrence,u=c.isEndOfRule;this.RULE_STACK.length===1&&u&&l===void 0&&(l=$,h=1),!(l===void 0||h===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,h,o)&&this.tryInRepetitionRecovery(r,e,t,l)}function Ut(r,e,t){return t|e|r}var fh=32-8;var Qe=class{constructor(e){var t;this.maxLookahead=(t=_optionalChain([e, 'optionalAccess', _2 => _2.maxLookahead]))!==null&&t!==void 0?t:v.maxLookahead}validate(e){let t=this.validateNoLeftRecursion(e.rules);if(_lodashes.isEmpty.call(void 0, t)){let n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...t,...n,...i,...s]}return t}validateNoLeftRecursion(e){return _lodashes.flatMap.call(void 0, e,t=>Mn(t,t,B))}validateEmptyOrAlternatives(e){return _lodashes.flatMap.call(void 0, e,t=>_i(t,B))}validateAmbiguousAlternationAlternatives(e,t){return _lodashes.flatMap.call(void 0, e,n=>xi(n,t,B))}validateSomeNonEmptyLookaheadPath(e,t){return Ci(e,t,B)}buildLookaheadForAlternation(e){return li(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,ui)}buildLookaheadForOptional(e){return hi(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Mt(e.prodType),di)}};var Gt=class{initLooksAhead(e){this.dynamicTokensEnabled=_lodashes.has.call(void 0, e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:v.dynamicTokensEnabled,this.maxLookahead=_lodashes.has.call(void 0, e,"maxLookahead")?e.maxLookahead:v.maxLookahead,this.lookaheadStrategy=_lodashes.has.call(void 0, e,"lookaheadStrategy")?e.lookaheadStrategy:new Qe({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){_lodashes.forEach.call(void 0, e,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{let{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Da(t);_lodashes.forEach.call(void 0, n,l=>{let h=l.idx===0?"":l.idx;this.TRACE_INIT(`${_gast.getProductionDslName.call(void 0, l)}${h}`,()=>{let u=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:t,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Ut(this.fullRuleNameToShort[t.name],256,l.idx);this.setLaFuncCache(f,u)})}),_lodashes.forEach.call(void 0, i,l=>{this.computeLookaheadFunc(t,l.idx,768,"Repetition",l.maxLookahead,_gast.getProductionDslName.call(void 0, l))}),_lodashes.forEach.call(void 0, s,l=>{this.computeLookaheadFunc(t,l.idx,512,"Option",l.maxLookahead,_gast.getProductionDslName.call(void 0, l))}),_lodashes.forEach.call(void 0, o,l=>{this.computeLookaheadFunc(t,l.idx,1024,"RepetitionMandatory",l.maxLookahead,_gast.getProductionDslName.call(void 0, l))}),_lodashes.forEach.call(void 0, a,l=>{this.computeLookaheadFunc(t,l.idx,1536,"RepetitionMandatoryWithSeparator",l.maxLookahead,_gast.getProductionDslName.call(void 0, l))}),_lodashes.forEach.call(void 0, c,l=>{this.computeLookaheadFunc(t,l.idx,1280,"RepetitionWithSeparator",l.maxLookahead,_gast.getProductionDslName.call(void 0, l))})})})}computeLookaheadFunc(e,t,n,i,s,o){this.TRACE_INIT(`${o}${t===0?"":t}`,()=>{let a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Ut(this.fullRuleNameToShort[e.name],n,t);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,t){let n=this.getLastExplicitRuleShortName();return Ut(n,e,t)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}},Gn=class extends _gast.GAstVisitor{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}},Dt=new Gn;function Da(r){Dt.reset(),r.accept(Dt);let e=Dt.dslMethods;return Dt.reset(),e}function Wn(r,e){isNaN(r.startOffset)===!0?(r.startOffset=e.startOffset,r.endOffset=e.endOffset):r.endOffset<e.endOffset&&(r.endOffset=e.endOffset)}function Kn(r,e){isNaN(r.startOffset)===!0?(r.startOffset=e.startOffset,r.startColumn=e.startColumn,r.startLine=e.startLine,r.endOffset=e.endOffset,r.endColumn=e.endColumn,r.endLine=e.endLine):r.endOffset<e.endOffset&&(r.endOffset=e.endOffset,r.endColumn=e.endColumn,r.endLine=e.endLine)}function Di(r,e,t){r.children[t]===void 0?r.children[t]=[e]:r.children[t].push(e)}function Gi(r,e,t){r.children[e]===void 0?r.children[e]=[t]:r.children[e].push(t)}var Ga="name";function Hn(r,e){Object.defineProperty(r,Ga,{enumerable:!1,configurable:!0,writable:!1,value:e})}function ja(r,e){let t=_lodashes.keys.call(void 0, r),n=t.length;for(let i=0;i<n;i++){let s=t[i],o=r[s],a=o.length;for(let c=0;c<a;c++){let l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function Bi(r,e){let t=function(){};Hn(t,r+"BaseSemantics");let n={visit:function(i,s){if(_lodashes.isArray.call(void 0, i)&&(i=i[0]),!_lodashes.isUndefined.call(void 0, i))return this[i.name](i.children,s)},validateVisitor:function(){let i=Xa(this,e);if(!_lodashes.isEmpty.call(void 0, i)){let s=_lodashes.map.call(void 0, i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return t.prototype=n,t.prototype.constructor=t,t._RULE_NAMES=e,t}function Wi(r,e,t){let n=function(){};Hn(n,r+"BaseSemanticsWithDefaults");let i=Object.create(t.prototype);return _lodashes.forEach.call(void 0, e,s=>{i[s]=ja}),n.prototype=i,n.prototype.constructor=n,n}var Vn;(function(r){r[r.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",r[r.MISSING_METHOD=1]="MISSING_METHOD"})(Vn||(Vn={}));function Xa(r,e){return qa(r,e)}function qa(r,e){let t=_lodashes.filter.call(void 0, e,i=>_lodashes.isFunction.call(void 0, r[i])===!1),n=_lodashes.map.call(void 0, t,i=>({msg:`Missing visitor method: <${i}> on ${r.constructor.name} CST Visitor.`,type:Vn.MISSING_METHOD,methodName:i}));return _lodashes.compact.call(void 0, n)}var Kt=class{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=_lodashes.has.call(void 0, e,"nodeLocationTracking")?e.nodeLocationTracking:v.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=_lodashes.noop,this.cstFinallyStateUpdate=_lodashes.noop,this.cstPostTerminal=_lodashes.noop,this.cstPostNonTerminal=_lodashes.noop,this.cstPostRule=_lodashes.noop;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Kn,this.setNodeLocationFromNode=Kn,this.cstPostRule=_lodashes.noop,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=_lodashes.noop,this.setNodeLocationFromNode=_lodashes.noop,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Wn,this.setNodeLocationFromNode=Wn,this.cstPostRule=_lodashes.noop,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=_lodashes.noop,this.setNodeLocationFromNode=_lodashes.noop,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=_lodashes.noop,this.setNodeLocationFromNode=_lodashes.noop,this.cstPostRule=_lodashes.noop,this.setInitialNodeLocation=_lodashes.noop;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){let t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){let t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){let t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?(n.endOffset=t.endOffset,n.endLine=t.endLine,n.endColumn=t.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){let t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?n.endOffset=t.endOffset:n.startOffset=NaN}cstPostTerminal(e,t){let n=this.CST_STACK[this.CST_STACK.length-1];Di(n,t,e),this.setNodeLocationFromToken(n.location,t)}cstPostNonTerminal(e,t){let n=this.CST_STACK[this.CST_STACK.length-1];Gi(n,t,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(_lodashes.isUndefined.call(void 0, this.baseCstVisitorConstructor)){let e=Bi(this.className,_lodashes.keys.call(void 0, this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(_lodashes.isUndefined.call(void 0, this.baseCstVisitorWithDefaultsConstructor)){let e=Wi(this.className,_lodashes.keys.call(void 0, this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){let e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){let e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}};var Ht=class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Me}LA(e){let t=this.currIdx+e;return t<0||this.tokVectorLength<=t?Me:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}};var Vt=class{ACTION(e){return e.call(this)}consume(e,t,n){return this.consumeInternal(t,e,n)}subrule(e,t,n){return this.subruleInternal(t,e,n)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t,n=ve){if(_lodashes.includes.call(void 0, this.definedRulesNames,e)){let o={message:B.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:L.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);let i=this.defineRule(e,t,n);return this[e]=i,i}OVERRIDE_RULE(e,t,n=ve){let i=Oi(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);let s=this.defineRule(e,t,n);return this[e]=s,s}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);let n=this.saveRecogState();try{return e.apply(this,t),!0}catch(i){if(ce(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return _gast.serializeGrammar.call(void 0, _lodashes.values.call(void 0, this.gastProductionsCache))}};var zt=class{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Le,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},_lodashes.has.call(void 0, t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(_lodashes.isArray.call(void 0, e)){if(_lodashes.isEmpty.call(void 0, e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(_lodashes.isArray.call(void 0, e))this.tokensMap=_lodashes.reduce.call(void 0, e,(s,o)=>(s[o.name]=o,s),{});else if(_lodashes.has.call(void 0, e,"modes")&&_lodashes.every.call(void 0, _lodashes.flatten.call(void 0, _lodashes.values.call(void 0, e.modes)),br)){let s=_lodashes.flatten.call(void 0, _lodashes.values.call(void 0, e.modes)),o=_lodashes.uniq.call(void 0, s);this.tokensMap=_lodashes.reduce.call(void 0, o,(a,c)=>(a[c.name]=c,a),{})}else if(_lodashes.isObject.call(void 0, e))this.tokensMap=_lodashes.clone.call(void 0, e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=$;let n=_lodashes.has.call(void 0, e,"modes")?_lodashes.flatten.call(void 0, _lodashes.values.call(void 0, e.modes)):_lodashes.values.call(void 0, e),i=_lodashes.every.call(void 0, n,s=>_lodashes.isEmpty.call(void 0, s.categoryMatches));this.tokenMatcher=i?Le:Q,Z(_lodashes.values.call(void 0, this.tokensMap))}defineRule(e,t,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);let i=_lodashes.has.call(void 0, n,"resyncEnabled")?n.resyncEnabled:ve.resyncEnabled,s=_lodashes.has.call(void 0, n,"recoveryValueFunc")?n.recoveryValueFunc:ve.recoveryValueFunc,o=this.ruleShortNameIdx<<4+8;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...h){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,h);let u=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(u),u}catch(u){return this.invokeRuleCatch(u,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...h){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,h)}catch(u){return this.invokeRuleCatch(u,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,n){let i=this.RULE_STACK.length===1,s=t&&!this.isBackTracking()&&this.recoveryEnabled;if(ce(e)){let o=e;if(s){let a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){let c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,t){let n=this.getKeyForAutomaticLookahead(512,t);return this.optionInternalLogic(e,t,n)}optionInternalLogic(e,t,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;let o=e.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,t){let n=this.getKeyForAutomaticLookahead(1024,e);return this.atLeastOneInternalLogic(e,t,n)}atLeastOneInternalLogic(e,t,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;let o=t.GATE;if(o!==void 0){let a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,_.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,1024,e,xt)}atLeastOneSepFirstInternal(e,t){let n=this.getKeyForAutomaticLookahead(1536,e);this.atLeastOneSepFirstInternalLogic(e,t,n)}atLeastOneSepFirstInternalLogic(e,t,n){let i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,He],a,1536,e,He)}else throw this.raiseEarlyExitException(e,_.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)}manyInternal(e,t){let n=this.getKeyForAutomaticLookahead(768,e);return this.manyInternalLogic(e,t,n)}manyInternalLogic(e,t,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;let a=t.GATE;if(a!==void 0){let c=i;i=()=>a.call(this)&&c.call(this)}}else s=t;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,768,e,_t,o)}manySepFirstInternal(e,t){let n=this.getKeyForAutomaticLookahead(1280,e);this.manySepFirstInternalLogic(e,t,n)}manySepFirstInternalLogic(e,t,n){let i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);let a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Ke],a,1280,e,Ke)}}repetitionSepSecondInternal(e,t,n,i,s){for(;n();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,i,s],n,1536,e,s)}doSingleRepetition(e){let t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){let n=this.getKeyForAutomaticLookahead(256,t),i=_lodashes.isArray.call(void 0, e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){let e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new qe(t,e))}}subruleInternal(e,t,n){let i;try{let s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=t,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,t,n){throw ce(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,t,n){let i;try{let s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,t,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,t,n){let i,s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Ie(i,t,s))}consumeInternalRecovery(e,t,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){let i=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Fn?n:s}}else throw n}saveRecogState(){let e=this.errors,t=_lodashes.clone.call(void 0, this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){let e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),$)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}};var Yt=class{initErrorHandler(e){this._errors=[],this.errorMessageProvider=_lodashes.has.call(void 0, e,"errorMessageProvider")?e.errorMessageProvider:v.errorMessageProvider}SAVE_ERROR(e){if(ce(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_lodashes.clone.call(void 0, this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _lodashes.clone.call(void 0, this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,n){let i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=ze(e,s,t,this.maxLookahead)[0],c=[];for(let h=1;h<=this.maxLookahead;h++)c.push(this.LA(h));let l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new Je(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){let n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=Ve(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));let a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Xe(c,this.LA(1),a))}};var jt=class{initContentAssist(){}computeContentAssist(e,t){let n=this.gastProductionsCache[e];if(_lodashes.isUndefined.call(void 0, n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return yt([n],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){let t=_lodashes.first.call(void 0, e.ruleStack),i=this.getGAstProductions()[t];return new Ot(i,e).startWalking()}};var Qt={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Qt);var qi=!0,Ji=Math.pow(2,8)-1,es=x({name:"RECORDING_PHASE_TOKEN",pattern:C.NA});Z([es]);var ts=Ee(es,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(ts);var Ic={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},qt=class{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){let t=e>0?e:"";this[`CONSUME${t}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${t}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${t}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${t}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${t}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${t}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${t}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${t}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},this.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{let e=this;for(let t=0;t<10;t++){let n=t>0?t:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return Me}topLevelRuleRecord(e,t){try{let n=new (0, _gast.Rule)({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),t.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch (e4){throw n}throw n}}optionInternalRecord(e,t){return nt.call(this,_gast.Option,e,t)}atLeastOneInternalRecord(e,t){nt.call(this,_gast.RepetitionMandatory,t,e)}atLeastOneSepFirstInternalRecord(e,t){nt.call(this,_gast.RepetitionMandatoryWithSeparator,t,e,qi)}manyInternalRecord(e,t){nt.call(this,_gast.Repetition,t,e)}manySepFirstInternalRecord(e,t){nt.call(this,_gast.RepetitionWithSeparator,t,e,qi)}orInternalRecord(e,t){return Ac.call(this,e,t)}subruleInternalRecord(e,t,n){if(Jt(t),!e||_lodashes.has.call(void 0, e,"ruleName")===!1){let a=new Error(`<SUBRULE${Qi(t)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}let i=_lodashes.last.call(void 0, this.recordingProdStack),s=e.ruleName,o=new (0, _gast.NonTerminal)({idx:t,nonTerminalName:s,label:_optionalChain([n, 'optionalAccess', _3 => _3.LABEL]),referencedRule:void 0});return i.definition.push(o),this.outputCst?Ic:Qt}consumeInternalRecord(e,t,n){if(Jt(t),!mn(e)){let o=new Error(`<CONSUME${Qi(t)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}let i=_lodashes.last.call(void 0, this.recordingProdStack),s=new (0, _gast.Terminal)({idx:t,terminalType:e,label:_optionalChain([n, 'optionalAccess', _4 => _4.LABEL])});return i.definition.push(s),ts}};function nt(r,e,t,n=!1){Jt(t);let i=_lodashes.last.call(void 0, this.recordingProdStack),s=_lodashes.isFunction.call(void 0, e)?e:e.DEF,o=new r({definition:[],idx:t});return n&&(o.separator=e.SEP),_lodashes.has.call(void 0, e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Qt}function Ac(r,e){Jt(e);let t=_lodashes.last.call(void 0, this.recordingProdStack),n=_lodashes.isArray.call(void 0, r)===!1,i=n===!1?r:r.DEF,s=new (0, _gast.Alternation)({definition:[],idx:e,ignoreAmbiguities:n&&r.IGNORE_AMBIGUITIES===!0});_lodashes.has.call(void 0, r,"MAX_LOOKAHEAD")&&(s.maxLookahead=r.MAX_LOOKAHEAD);let o=_lodashes.some.call(void 0, i,a=>_lodashes.isFunction.call(void 0, a.GATE));return s.hasPredicates=o,t.definition.push(s),_lodashes.forEach.call(void 0, i,a=>{let c=new (0, _gast.Alternative)({definition:[]});s.definition.push(c),_lodashes.has.call(void 0, a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:_lodashes.has.call(void 0, a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Qt}function Qi(r){return r===0?"":`${r}`}function Jt(r){if(r<0||r>Ji){let e=new Error(`Invalid DSL Method idx value: <${r}>
	Idx value must be a none negative value smaller than ${Ji+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}var Zt=class{initPerformanceTracer(e){if(_lodashes.has.call(void 0, e,"traceInitPerf")){let t=e.traceInitPerf,n=typeof t=="number";this.traceInitMaxIdent=n?t:1/0,this.traceInitPerf=n?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=v.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;let n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);let{time:i,value:s}=_utils.timer.call(void 0, t),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return t()}};function ns(r,e){e.forEach(t=>{let n=t.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;let s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(r.prototype,i,s):r.prototype[i]=t.prototype[i]})})}var Me=Ee($,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Me);var v=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:At,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),ve=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0}),L;(function(r){r[r.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",r[r.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",r[r.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",r[r.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",r[r.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",r[r.LEFT_RECURSION=5]="LEFT_RECURSION",r[r.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",r[r.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",r[r.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",r[r.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",r[r.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",r[r.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",r[r.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",r[r.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(L||(L={}));var Ne=class{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;let t=this.className;this.TRACE_INIT("toFastProps",()=>{_utils.toFastProperties.call(void 0, this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),_lodashes.forEach.call(void 0, this.definedRulesNames,i=>{let o=this[i].originalGrammarAction,a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=yi({rules:_lodashes.values.call(void 0, this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(_lodashes.isEmpty.call(void 0, n)&&this.skipValidations===!1){let i=ki({rules:_lodashes.values.call(void 0, this.gastProductionsCache),tokenTypes:_lodashes.values.call(void 0, this.tokensMap),errMsgProvider:B,grammarName:t}),s=Ai({lookaheadStrategy:this.lookaheadStrategy,rules:_lodashes.values.call(void 0, this.gastProductionsCache),tokenTypes:_lodashes.values.call(void 0, this.tokensMap),grammarName:t});this.definitionErrors=this.definitionErrors.concat(i,s)}}),_lodashes.isEmpty.call(void 0, this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{let i=cr(_lodashes.values.call(void 0, this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:_lodashes.values.call(void 0, this.gastProductionsCache)}),this.preComputeLookaheadFunctions(_lodashes.values.call(void 0, this.gastProductionsCache))})),!Ne.DEFER_DEFINITION_ERRORS_HANDLING&&!_lodashes.isEmpty.call(void 0, this.definitionErrors))throw e=_lodashes.map.call(void 0, this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;let n=this;if(n.initErrorHandler(t),n.initLexerAdapter(),n.initLooksAhead(t),n.initRecognizerEngine(e,t),n.initRecoverable(t),n.initTreeBuilder(t),n.initContentAssist(),n.initGastRecorder(t),n.initPerformanceTracer(t),_lodashes.has.call(void 0, t,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=_lodashes.has.call(void 0, t,"skipValidations")?t.skipValidations:v.skipValidations}};Ne.DEFER_DEFINITION_ERRORS_HANDLING=!1;ns(Ne,[Ft,Gt,Kt,Ht,zt,Vt,Yt,jt,qt,Zt]);var it=class extends Ne{constructor(e,t=v){let n=_lodashes.clone.call(void 0, t);n.outputCst=!0,super(e,n)}};var _cstdtsgen = require('@chevrotain/cst-dts-gen');function is(r){let e={OR:"|",ELSE:"||",DYNAMIC:"$",STATIC:"#",ENTITY:"&",OPEN_GATE:"@",CLOSE_GATE:"@",PENDING_GATE:"@@",OPEN_SILENT:"{",CLOSE_SILENT:"}"};Object.assign(e,r?{OPEN_CHOICE:"(",CLOSE_CHOICE:")",OPEN_WEIGHT:"[",CLOSE_WEIGHT:"]",CONTINUATION:"\\"}:{OPEN_CHOICE:"[",CLOSE_CHOICE:"]",OPEN_WEIGHT:"^",CLOSE_WEIGHT:"^",CONTINUATION:"~"});let i={};Object.entries(e).forEach(([Fe,he])=>{i[Fe]=yc(he)});let s=new RegExp(`${i.PENDING_GATE}([0-9]{9,11})`);i.SPECIAL=Object.values(i).join("").replace(/[<>]/g,""),e.PENDING_GATE_RE=new RegExp(s.source,"g");let o=x({name:"ExitGate",pattern:new RegExp(`\\s*${i.CLOSE_GATE}`),pop_mode:!0}),a=x({name:"Gate",pattern:new RegExp(`[^${i.CLOSE_GATE}]+`)}),c=x({name:"PendingGate",pattern:s}),l=x({name:"EnterGate",pattern:new RegExp(`${i.OPEN_GATE}\\s*`),push_mode:"gate_mode"}),h=x({name:"OC",pattern:new RegExp(i.OPEN_CHOICE+"\\s*")}),u=x({name:"CC",pattern:new RegExp(`\\s*${i.CLOSE_CHOICE}`)}),f=x({name:"OR",pattern:/\s*\|\s*/}),m=x({name:"ELSE",pattern:/\s*\|\|\s*/}),T=x({name:"EQ",pattern:/\s*=\s*/}),g=x({name:"TF",pattern:/\.[A-Za-z_0-9][A-Za-z_0-9]*(\(\))?/}),A=x({name:"OS",pattern:new RegExp(`${i.OPEN_SILENT}\\s*`)}),E=x({name:"CS",pattern:new RegExp(`\\s*${i.CLOSE_SILENT}`)}),p=x({name:"SYM",pattern:new RegExp(`[${i.DYNAMIC}${i.STATIC}][A-Za-z_0-9]*`)}),d=x({name:"Entity",pattern:/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/i}),R=x({name:"Weight",pattern:new RegExp(`\\s*${i.OPEN_WEIGHT}.+${i.CLOSE_WEIGHT}\\s*`)}),I=x({name:"Raw",pattern:new RegExp(`[^${i.SPECIAL}]+`)});return{tokens:{modes:{normal:[d,R,m,h,u,f,T,p,g,A,E,c,I,l],gate_mode:[a,o]},defaultMode:"normal"},Constants:{Symbols:e,Escaped:i}}}function yc(r){return r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var en=class extends it{constructor(e){super(e,{nodeLocationTracking:"full"}),this.atomTypes=["silent","assign","symbol","choice","pgate","text","entity"],this.buildRules()}parse(e){this.input=e.tokens;let t=this.script();if(this.errors.length>0)throw Error(`[PARSING]
`+this.errors[0].message);return t}buildRules(){let e=this,t=this.tokensMap;e.RULE("script",()=>{e.MANY(()=>e.SUBRULE(e.expr))}),e.RULE("pgate",()=>{e.CONSUME(t.PendingGate),e.MANY(()=>e.CONSUME(t.TF))}),e.RULE("entity",()=>{e.CONSUME(t.Entity)}),e.RULE("gate",()=>{e.CONSUME(t.EnterGate),e.MANY(()=>e.CONSUME(t.Gate)),e.CONSUME(t.ExitGate)}),e.RULE("silent",()=>{e.CONSUME(t.OS),e.OPTION1(()=>e.SUBRULE(e.gate)),e.CONSUME(t.SYM),e.OPTION2(()=>{e.CONSUME(t.EQ),e.SUBRULE(e.expr)}),e.CONSUME(t.CS)}),e.RULE("assign",()=>{e.CONSUME(t.SYM),e.CONSUME(t.EQ),e.SUBRULE(e.expr)}),e.RULE("symbol",()=>{e.CONSUME(t.SYM),e.MANY(()=>e.CONSUME(t.TF))}),e.RULE("accept",()=>{e.SUBRULE(e.or_expr)}),e.RULE("reject",()=>{e.SUBRULE(e.or_expr)}),e.RULE("or_expr",()=>{e.MANY_SEP({SEP:t.OR,DEF:()=>e.SUBRULE(e.wexpr)})}),e.RULE("choice",()=>{e.CONSUME(t.OC),e.OPTION1(()=>e.SUBRULE(e.gate)),e.SUBRULE(e.accept),e.OPTION2(()=>{e.CONSUME(t.ELSE),e.SUBRULE(e.reject)}),e.CONSUME(t.CC),e.MANY(()=>e.CONSUME(t.TF))}),e.RULE("wexpr",()=>{e.MANY(()=>{e.OR([{ALT:()=>e.SUBRULE(e.expr)},{ALT:()=>e.CONSUME(t.Weight)}])})}),e.RULE("expr",()=>{e.AT_LEAST_ONE(()=>e.SUBRULE(e.atom))}),e.RULE("atom",()=>{e.OR(this.atomTypes.map(n=>({ALT:()=>e.SUBRULE(e[n])})))}),e.RULE("text",()=>{e.CONSUME(t.Raw)}),this.performSelfAnalysis()}};var qn=class{constructor(e){this.input=0,this.path="",this.tracePath=!0,this.scripting=e,this.warnOnInvalidGates=!1,this.RiScript=this.scripting.constructor}isCstNode(e){return typeof e=="object"&&("accept"in e||"name"in e&&"location"in e&&"children"in e)}visit(e,t){if(Array.isArray(e)&&(e=e[0]),typeof e>"u")return;if(!this.isCstNode(e))throw Error("Non-cstNode passed to visit: "+JSON.stringify(e));let{name:n,location:i}=e;if(this.nodeText=this.input.substring(i.startOffset,i.endOffset+1),typeof this[n]!="function")throw Error(`BaseVisitor.visit: expecting function for this[${n}], found ${typeof this[n]}: ${JSON.stringify(this[n])}`);return this.tracePath&&!/(expr|atom|silent)/.test(n)&&(this.path+=n+"."),this[n](e.children,t)}validateVisitor(){}},we=class extends qn{constructor(e,t={}){super(e),this.context=t,this.trace=0,this.choices={},this.isNoRepeat=!1,this.symbols=this.scripting.Symbols,this.escaped=this.scripting.Escaped,this.statics={},this.dynamics={},this.pendingGates={},this.pendingSymbols=new Set,this.validateVisitor()}start(e={}){if(this.input=e.input,this.trace=e.trace,this.traceTx=e.traceTx,!e.cst)throw Error("no cst");return super.visit(e.cst)}script(e){this.order=0;let t=e.expr?e.expr.length:0;if(this.print("script","'"+this.RiScript._escapeText(this.input)+"' :: "+t+" expression(s)"),!t)return"";if(Object.keys(e).length!==1)throw Error("script: invalid expr");return this.visit(e.expr)}expr(e){let t=Object.keys(e);if(t.length!==1)throw Error("invalid expr: "+t.length);let n=e.atom.map(i=>this.visit(i));for(let i=1;i<n.length-1;i++)n[i].length===0&&n[i-1].endsWith(" ")&&n[i+1].startsWith(" ")&&(n[i+1]=n[i+1].substring(1));return n.join("")}wexpr(e){this.print("wexpr")}gate(e){if(e.Gate.length!==1)throw Error("Invalid gate: "+e.Gate);let t,n=e.Gate[0].image;try{t=this.scripting._query(n)}catch(c){if(!this.warnOnInvalidGates)throw Error(`Invalid gate[2]: "@${n}@"

RootCause -> ${c}`);return!this.scripting.RiTa.SILENT&&!this.scripting.silent&&console.warn(`[WARN] Ignoring invalid gate: @${n}@
`,c),{decision:"accept"}}let i={},s=[],o=t.operands();if(o.forEach(c=>{let{result:l,resolved:h,isStatic:u,isUser:f}=this.checkContext(c);typeof l=="function"&&(l=l.call(),h=!this.scripting.isParseable(l)),typeof l>"u"||!h?s.push(c):(u?this.statics[c]=l:f?this.context[c]=l:this.dynamics[c]=l,i[c]=l)}),Object.keys(i).length+s.length!==o.length)throw Error("invalid operands");if(s.length)return{decision:"defer",operands:s};let a=t.test(i);return!a&&this.castValues(i)&&(a=t.test(i)),{decision:a?"accept":"reject"}}assign(e,t){let n=e.SYM[0].image,i,s,o=n.replace(this.scripting.AnySymbolRE,"");if(n.startsWith(this.symbols.STATIC))i=this.visit(e.expr),this.scripting.isParseable(i)?(this.statics[o]=i,i=this.inlineAssignment(o,e.TF,i)):(this.statics[o]=i,this.pendingSymbols.delete(o),this.trace&&console.log("  [pending.delete]",n,this.pendingSymbols.length?JSON.stringify(this.pendingSymbols):"")),s=`${n} = ${this.RiScript._escapeText(i)} [#static] ${_optionalChain([t, 'optionalAccess', _5 => _5.silent])?"{silent}":""}`;else{let c=this;i=()=>c.visit(e.expr),s=`${n} = <f*:pending>`+(_optionalChain([t, 'optionalAccess', _6 => _6.silent])?"{silent}":""),this.dynamics[o]=i}return this.print("assign",s),i}silent(e){return e.EQ?this.assign(e,{silent:!0}):this.symbol(e,{silent:!0}),""}atom(e){let t,n=Object.keys(e);if(n.length!==1)throw Error("invalid atom: "+n);return this.scripting.parser.atomTypes.forEach(i=>{let s=e[i];if(s){if(s.length!==1)throw Error(i+": bad length -> "+e[i].length);t=this.visit(s[0])}}),typeof t=="function"&&(t=t.call()),t}text(e){if(e.Raw.length!==1)throw Error("[1] invalid text");if(Object.keys(e).length!==1)throw Error("[2] invalid text");let t=e.Raw[0].image;return this.print("text",this.RiScript._escapeText("'"+t+"'")),t}entity(e){return this.nodeText}symbol(e,t){if(e.SYM.length!==1)throw Error("[1] invalid symbol");let n=this.nodeText,i=e.SYM[0].image,s=i.replace(this.scripting.AnySymbolRE,"");if(this.isNoRepeat=this.hasNoRepeat(e.TF),this.pendingSymbols.has(s))return this.print("symbol",`${i} [is-pending]`),n;let{result:o,isStatic:a,isUser:c,resolved:l}=this.checkContext(s);if(!a&&i.startsWith(this.symbols.STATIC)&&!this.scripting.EntityRE.test(i))throw Error(`Attempt to refer to dynamic symbol '${s}' as ${this.symbols.STATIC}${s}, did you mean $${s}?`);if(typeof o=="function"&&(o=o.call(),l=!this.scripting.isParseable(o)),this.isNoRepeat&&(a||c)){this.isNoRepeat=!1;let u="Attempt to call norepeat() on "+(a?"static symbol '"+i+"'. Did you mean to use '"+this.symbols.DYNAMIC+s+"' ?":"non-dynamic symbol '"+s+"'. Did you mean to define '"+this.symbols.DYNAMIC+s+"' in riscript?");throw Error(u)}if(typeof o>"u")return this.print("symbol",i+" -> '"+n+"' ctx="+this.lookupsToString(),"[deferred]",_optionalChain([t, 'optionalAccess', _7 => _7.silent])?"{silent}":""),n;let h=n+" -> '"+o+"'"+(_optionalChain([t, 'optionalAccess', _8 => _8.silent])?" {silent}":"");return typeof o=="string"&&!l?(a?(this.pendingSymbols.add(s),o=this.inlineAssignment(s,e.TF,o),this.print("symbol*",`${n} -> ${o} :: pending.add(${s})`)):(e.TF&&(o=this.restoreTransforms(o,e.TF)),this.print("symbol",h)),o):(a&&(this.statics[s]=o),e.TF&&(o=this.applyTransforms(o,e.TF),h+=" -> '"+o+"'",this.isNoRepeat&&(h+=" (norepeat)")),this.print("symbol",h),this.pendingSymbols.has(s)&&(this.trace&&console.log("  [$pending.delete]",(a?"#":"$")+s,this.pendingSymbols.length?JSON.stringify(this.pendingSymbols):""),this.pendingSymbols.delete(s)),this.isNoRepeat=!1,o)}pgate(e){this.print("pgate",this.nodeText);let t=this.nodeText,n=t.replace(this.symbols.PENDING_GATE,""),i=this.pendingGates[n];if(!i)throw Error('no pending gate="'+t+'" pgates='+JSON.stringify(Object.keys(this.pendingGates)));return i.operands.some(a=>{let{result:c,resolved:l}=this.checkContext(a);return typeof c=="function"&&(c=c.call(),l=!this.scripting.isParseable(c)),typeof c>"u"||!l})?t:this.choice(i.deferredContext)}else(e){return this.visit(e.expr).trim()}choice(e,t){let n=this.symbols,i,s,o=this.nodeText,a=o,c=this.RiScript._stringHash(o+" #"+this.choiceId(e));if(!this.isNoRepeat&&this.hasNoRepeat(e.TF))throw Error("noRepeat() not allowed on choice (use a $variable instead): "+o);let l="accept";if(_optionalChain([t, 'optionalAccess', _9 => _9.forceReject]))l="reject";else if(e.gate&&(i=e.gate[0].children.Gate[0].image,s=this.visit(e.gate),l=s.decision,a+=`
  [gate] ${i} -> ${l!=="defer"?l.toUpperCase():`DEFER ${n.PENDING_GATE}${c}`}  ${this.lookupsToString()}`),s&&s.decision==="defer")return this.pendingGates[c]={deferredContext:e,operands:s.operands},`${n.PENDING_GATE}${c}`;if(l==="reject"&&!("reject"in e))return"";let h=_optionalChain([e, 'access', _10 => _10[l], 'optionalAccess', _11 => _11[0], 'optionalAccess', _12 => _12.children, 'optionalAccess', _13 => _13.or_expr, 'optionalAccess', _14 => _14[0]]),u=this.parseOptions(h);if(!u)throw Error("No options in choice: "+o);let f=null,m=[],T=!1;for(;f===null;){if(f=this.choose(u,m).value,this.scripting.isParseable(f)){e.TF&&(f=this.restoreTransforms(f,e.TF)),T=!0;break}if(e.TF&&(f=this.applyTransforms(f,e.TF)),this.isNoRepeat&&f===this.choices[c]){this.print("choice.reject",f+" [norepeat]"),m.push(f),f=null;continue}}return T||(this.choices[c]=f),f}hasNoRepeat(e){let t=this.RiScript._transformNames(e);return t.length?t.includes("nr")||t.includes("norepeat"):!1}checkContext(e){let t=!1,n=!1,i;if(e.length===0)return{result:"",resolved:!0,isStatic:t,isUser:n};i=this.dynamics[e],typeof i>"u"&&(i=this.statics[e],typeof i<"u"&&(t=!0)),typeof i>"u"&&(i=this.context[e],typeof i<"u"?n=!0:i=this.context[this.symbols.DYNAMIC+e]);let s=!this.scripting.isParseable(i);return{result:i,isStatic:t,isUser:n,resolved:s}}inlineAssignment(e,t,n){let i=this.symbols,s=i.STATIC+e,o=this.restoreTransforms(n,t);return n=i.OPEN_CHOICE+(s+"="+o)+i.CLOSE_CHOICE,n}choiceId(e){if(!e.OC||!e.OC.length)throw Error("invalid choice");return e.OC[0].startOffset+"."+e.OC[0].endOffset}parseOptions(e){let t=[];if(e&&_optionalChain([e, 'optionalAccess', _15 => _15.children, 'optionalAccess', _16 => _16.wexpr])){let n=e.children.wexpr;for(let i=0;i<n.length;i++){let s=n[i],o=s.children.expr;if(o&&o.length!=1)throw Error("invalid choice-expr: "+o.length);let a=s.children.Weight;if(a){if(a.length!=1)throw Error("invalid weight: "+a.length);let c=1;try{c=parseInt(this.symbols.CLOSE_WEIGHT.length?a[0].image.trim().slice(1,-1):a[0].image.trim().slice(1))}catch (e5){console.log("EX: "+c)}Array.from({length:c},()=>t.push(o))}else t.push(o||"")}}return t}chooseUnique(e,t){for(;e.length;){let{index:i,value:s}=this.choose(e);if(s!==this.choices[t])return s;e.splice(i,1)}throw Error("No remaining options")}choose(e,t=[]){if(!e||!e.length)throw Error("Invalid choice: no options");let n=e.filter(a=>!t.includes(a));if(!n.length)throw Error("Invalid choice: no valid options");let i=this.scripting.RiTa.randi(n.length),s="",o=n[i];return typeof o=="string"?this.print("choice.text","''"):(this.path="choice."+this.path,s=this.visit(o)),typeof s=="string"&&(s=s.trim()),{index:i,value:s}}applyTransforms(e,t){this.traceTx&&console.log("applyTransforms",this.formatTxs(...arguments));for(let n=0;n<t.length;n++)e=this.applyTransform(e,t[n]);return e}restoreTransforms(e,t){return typeof e=="string"&&(new RegExp("^"+this.escaped.OPEN_CHOICE+".*"+this.escaped.CLOSE_CHOICE+"$").test(e)||(e=this.symbols.OPEN_CHOICE+e+this.symbols.CLOSE_CHOICE),t&&t.forEach(i=>e+=i.image),this.traceTx&&console.log("restoreTransforms:",e)),e}castValues(e){let t=!1;return Object.entries(e).forEach(([n,i])=>{let s=parseFloat(i);isNaN(s)||(t=!0,e[n]=s)}),t}contextIsResolved(e){let t=!0;return Object.entries(e).forEach(([n,i])=>{this.scripting.isParseable(i)||(t=!1)}),t}applyTransform(e,t){let n=t.image,i,s=e+n,o=n.substring(1).replace(/\(\)$/,"");return typeof this.dynamics[o]=="function"?i=this.dynamics[o](e):typeof this.statics[o]=="function"?i=this.statics[o](e):typeof this.context[o]=="function"?i=this.context[o](e):typeof this.RiScript.transforms[o]=="function"?i=this.RiScript.transforms[o](e):typeof e[o]=="function"?i=e[o]():e.hasOwnProperty(o)?i=e[o]:(!this.scripting.RiTa.SILENT&&!this.scripting.silent&&console.warn("[WARN] Unresolved transform: "+s),i=s.replace(/\(\)$/,"&lpar;&rpar;")),this.trace&&console.log(`${this.tindent()}[transform] ${s} -> '${i}'`),i}lookupsToString(){let e={},t={};return Object.entries(this.dynamics||{}).forEach(([n,i])=>e[`$${n} `]=i),Object.entries(this.statics||{}).forEach(([n,i])=>t[`#${n} `]=i),JSON.stringify({...this.context,...t,...e},(n,i)=>typeof i=="function"?"<f*:pending>":i).replace(/"/g,"")}formatTxs(e,t){return e+t.map(n=>n.image.replace(/()/,"")+"()").join("")}print(e,...t){this.trace&&(this.path&&e!=="script"&&(e=this.path.replace(/\.$/,"")),console.log(++this.order,`[${e}]`,...t),this.path="")}tindent(){return" ".repeat((this.order+"").length+1)}};var{decode:Mc}=_he2.default,vc=/[aeiou]/,be="_RE_",wc=/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/gi,nn=class extends _mingo.Query{constructor(e,t,n){if(typeof t=="string"){let i=t;t=e.parseJSOL(t)}super(t,n)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}operands(){let e=[this.condition],t=new Set;for(;_optionalChain([e, 'optionalAccess', _17 => _17.length])>0;){let n=e.pop();Object.keys(n).forEach(i=>{let s=n[i];i.startsWith("$")||t.add(i),typeof s=="object"&&s!==null&&(Array.isArray(s)?s:[s]).forEach(a=>e.push(a))})}return Array.from(t)}},P=class{static evaluate(e,t,n={}){return new P().evaluate(e,t,n)}constructor(e={}){this.visitor=0,this.v2Compatible=e.compatibility===2;let{Constants:t,tokens:n}=is(this.v2Compatible);this.Escaped=t.Escaped,this.Symbols=t.Symbols;let i=t.Escaped.STATIC+t.Escaped.DYNAMIC,s=t.Escaped.OPEN_CHOICE,o=t.Escaped.CLOSE_CHOICE;this.JSOLIdentRE=new RegExp(`([${i}]?[A-Za-z_0-9][A-Za-z_0-9]*)\\s*:`,"g"),this.RawAssignRE=new RegExp(`^[${i}][A-Za-z_0-9][A-Za-z_0-9]*\\s*=`),this.ChoiceWrapRE=new RegExp("^"+s+"[^"+s+o+"]*"+o+"$"),this.SpecialRE=new RegExp(`[${this.Escaped.SPECIAL.replace("&","")}]`),this.ContinueRE=new RegExp(this.Escaped.CONTINUATION+"\\r?\\n","g"),this.WhitespaceRE=/[\u00a0\u2000-\u200b\u2028-\u2029\u3000]+/g,this.AnySymbolRE=new RegExp(`[${i}]`),this.silent=!1,this.lexer=new C(n),this.parser=new en(n),this.RiTa=e.RiTa||{VERSION:0,randi:a=>Math.floor(Math.random()*a)}}lex(e){if(!e.input)throw Error("no input");let t=this.lexer.tokenize(e.input);if(t.errors.length)throw console.error("Input: "+e.input+`
`,t.errors[0].message),Error("[LEXING] "+t.errors[0].message);e.trace&&this.printTokens(t.tokens),e.tokens=t.tokens}parse(e){e.cst=this.parser.parse(e)}visit(e){return this.visitor.start(e)}lexParseVisit(e={}){return this.lex(e),this.parse(e),this.visit(e)}evaluate(e,t,n={}){if(typeof e!="string")throw Error("RiScript.evaluate() expects a string, got "+typeof e);return n.input=e,n.visitor=new we(this,t),this._evaluate(n)}_evaluate(e){let{input:t}=e,n,i=/\r?\n$/.test(t),s=this.preParse(t,e);if(!s)return"";if(e.trace&&console.log(`
Input:  '${P._escapeText(t)}'`),e.trace&&t!==s&&console.log(`Parsed: '${P._escapeText(s)}'`),!e.visitor)throw Error("no visitor");this.visitor=e.visitor,delete e.visitor;for(let o=1;s!==n&&o<=10&&(n=s,e.trace&&console.log("-".repeat(20)+" Pass#"+o+" "+"-".repeat(20)),e.input=s,s=this.lexParseVisit(e),e.trace&&console.log(`Result(${o}) -> "${P._escapeText(s)}" ctx=${this.visitor.lookupsToString()}`),!(e.onepass||!this.isParseable(s)));o++);return!this.silent&&!this.RiTa.SILENT&&this.AnySymbolRE.test(s.replace(wc,""))&&console.warn('[WARN] Unresolved symbol(s) in "'+s.replace(/\n/g,"\\n")+'" '),this.postParse(s,e)+(i?`
`:"")}_query(e,t){return new nn(this,e,t)}printTokens(e){let t=e.reduce((n,i)=>{let{name:s}=i.tokenType,o=s;return o==="TEXT"&&(o=P._escapeText(i.image,1)),o==="SYM"&&(o="sym("+i.image+")"),o==="TX"&&(o="tx("+i.image+")"),n+o+", "},"").slice(0,-2);console.log(`
Tokens: [ `+t+" ]  Context:",this.visitor.lookupsToString())}postParse(e,t){if(typeof e!="string")return"";let i=Mc(e).replace(this.WhitespaceRE," ").replace(/\r?\n$/,"");return[...i.matchAll(this.Symbols.PENDING_GATE_RE)].forEach(o=>{if(!o||!o[0]||!o[1])throw Error("bad gate: "+o);let a=this.visitor.pendingGates[o[1]],{deferredContext:c,operands:l}=a;if(!l.length)throw Error("no operands");let h=this.visitor.choice(c,{forceReject:!0});i=i.replace(o[0],h),t.trace&&console.log("  "+o[0]+"-> "+h)}),t.trace&&console.log(`
Final: '${i}'`),t.preserveLookups||(this.visitor.statics=void 0,this.visitor.dynamics=void 0),i}preParse(e,t){if(typeof e!="string")return"";let n=this.Symbols,i=e;this.v2Compatible||(i=i.replace(/\((\s*\d+\s*)\)/g,"^$1^")),i=i.replace(/\/\*[^]*?(\r?\n)?\//g,""),i=i.replace(/\/\/[^\n]+(\r?\n|$)/g,""),i=i.replace(this.ContinueRE,""),i=bc(i);let s="",o=i.split(/\r?\n/);for(let a=0;a<o.length;a++)if(this.RawAssignRE.test(o[a])){let c=o[a].indexOf("=");if(c<0)throw Error("invalid state: no assigment: "+o[a]);let l=o[a].substring(0,c),h=o[a].substring(c+1),u=tn(h,n.OPEN_CHOICE),f=tn(h,n.CLOSE_CHOICE);for(;u>f;){let m=o[++a];h+=`
`+m,u+=tn(m,n.OPEN_CHOICE),f+=tn(m,n.CLOSE_CHOICE)}s+=n.OPEN_SILENT+(l+"="+h)+n.CLOSE_SILENT}else s+=o[a],a<o.length-1&&(s+=`
`);return s}parseJSOL(e){let t=o=>{let a=o;if(typeof o=="string"&&o.startsWith(be)&&o.endsWith(be)){let c=o.split(be);if(c.length!==4)throw Error("invalid regex in unescape");a=new RegExp(c[1],c[2])}return a},n=P._escapeJSONRegex(e).replace(this.JSOLIdentRE,'"$1":').replace(/'/g,'"'),i=JSON.parse(n),s=t;return Object.keys(i).forEach(o=>i[o]=s(i[o])),i}isParseable(e){let t=!0;return/(string|number)/.test(typeof e)&&(t=this.SpecialRE.test(e.toString())),t}static articlize(e){if(!e||!e.length)return"";let t=e.split(/\s+/)[0];if(!_optionalChain([P, 'access', _18 => _18.RiTa, 'optionalAccess', _19 => _19.phones]))return P.RiTaWarnings.phones||(console.warn("[WARN] Install RiTa for proper phonemes"),P.RiTaWarnings.phones=!0),(/^[aeiou].*/i.test(t)?"an ":"a ")+e;let n=P.RiTa.phones(t,{silent:!0});return(n&&n.length&&vc.test(n[0])?"an ":"a ")+e}static capitalize(e){return e?e[0].toUpperCase()+e.substring(1):""}static uppercase(e){return e?e.toUpperCase():""}static quotify(e){return"&#8220;"+(e||"")+"&#8221;"}static pluralize(e){return _optionalChain([P, 'access', _20 => _20.RiTa, 'optionalAccess', _21 => _21.pluralize])?P.RiTa.pluralize(e):(P.RiTaWarnings.plurals||(P.RiTaWarnings.plurals=!0,console.warn("[WARN] Install RiTa for proper pluralization")),e.endsWith("s")?e:e+"s")}static identity(e){return e}static _transformNames(e){return e&&e.length?e.map(t=>t.image.replace(/(^\.|\(\)$)/g,""),[]):[]}static _escapeText(e,t){if(typeof e!="string")return e;let n=e.replace(/\r?\n/g,"\\n");return t||!n.length?"'"+n+"'":n}static _escapeJSONRegex(e){return e.replace(/\/([^/]+?)\/([igmsuy]*)/g,`"${be}$1${be}$2${be}"`)}static _stringHash(e){let t,n=0;for(let s=0;s<e.length;s++)t=e.charCodeAt(s),n=(n<<5)-n+t,n|=0;let i=n.toString();return n<0?i.replace("-","0"):i}},N=P;ct(N,"Query",nn),ct(N,"VERSION","[VI]{version}[/VI]"),ct(N,"RiTaWarnings",{plurals:!1,phones:!1});N.transforms={quotify:N.quotify,pluralize:N.pluralize,capitalize:N.capitalize,articlize:N.articlize,uppercase:N.uppercase,norepeat:N.identity,art:N.articlize,nr:N.identity,cap:N.capitalize,ucf:N.capitalize,uc:N.uppercase,qq:N.quotify,s:N.pluralize};function bc(r){return r=z(r,"\\(","&lpar;"),r=z(r,"\\)","&rpar;"),r=z(r,"\\[","&lsqb;"),r=z(r,"\\]","&rsqb;"),r=z(r,"\\{","&lcqb;"),r=z(r,"\\}","&rcqb;"),r=z(r,"\\@","&commat;"),r=z(r,"\\#","&num;"),r=z(r,"\\|"," &vert"),r=z(r,"\\="," &equals"),r}function Fc(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function z(r,e,t){return r.replace(new RegExp(Fc(e),"g"),()=>t)}function tn(r,e){let t=0;for(let n=0;n<r.length;n++)r[n]===e&&t++;return t}var Se=class{constructor(e={},t={}){if(typeof e!="object")throw Error("RiGrammar: expecting object, found "+typeof e);this.scripting=new N,this.context=t,this.setRules(e)}static expand(e,t,n){return new Se(e,t).expand(n)}addTransform(){return N.addTransform(...arguments)}removeTransform(){return N.removeTransform(...arguments)}getTransforms(){return N.transforms}equals(e){return e.toJSON()===this.toJSON()}expand(e={}){if("context"in e)throw Error("pass context to RiScript.grammar() or new RiGrammar() instead");return e.visitor=e.visitor||new N.Visitor(this.scripting),e.visitor.context=this.context||{},e.input=this._toScript(e),this.scripting._evaluate(e)}addRule(e,t){this._validateRule(e,t),this.rules[e]=t}setRules(e){if(typeof e>"u")throw Error("undefined rules");this.rules={};let t=typeof e=="string"?Uc(e):e,n=this;Object.entries(t).forEach(i=>n.addRule(...i))}removeRule(e){e in this.rules&&delete this.rules[e]}toJSON(){return JSON.stringify(this.rules,...arguments)}toString(e={}){let t=e.replacer||0,n=e.space||2,i=_optionalChain([e, 'optionalAccess', _22 => _22.linebreak]),s=this.toJSON(t,n);return i&&(s=s.replace(/\n/g,i)),s}static fromJSON(e,t){return new Se(JSON.parse(e),t)}_toScript(e){let t="",n=e.start||"start",{Symbols:i}=this.scripting;if(n.startsWith(i.DYNAMIC)&&(n=n.substring(i.DYNAMIC.length)),n.startsWith(i.STATIC)&&(n=n.substring(i.STATIC.length)),!(n in this.rules||i.STATIC+n in this.rules))throw Error('Rule: "'+n+'" not found in grammar');return Object.entries(this.rules).forEach(([s,o],a)=>{for(;s.startsWith(i.DYNAMIC);)s=s.substring(1);s.startsWith(i.STATIC)||(s=i.DYNAMIC+s),this.scripting.ChoiceWrapRE.test(o)||(o=i.OPEN_CHOICE+o+i.CLOSE_CHOICE),t+=`${s}=${o}
`}),e.trace&&console.log(`Grammar:
`+t.replace(/^\$/gm,"  $")),t+=`${i.DYNAMIC}${n}`,t}_validateRule(e,t){if(typeof e!="string"||e.length===0)throw Error("expected [string] name");if(typeof t>"u")throw Error("undefined rule def: "+e);let{Symbols:n}=this.scripting;if(e.startsWith(n.DYNAMIC))throw e=e.substring(n.DYNAMIC.length),Error("Grammar rules are dynamic by default; if you need a static rule, use '"+n.STATIC+e+"', otherwise just use '"+e+"'.")}};function Uc(r){if(typeof r=="string")try{return JSON.parse(r)}catch (e6){throw Error(`RiGrammar appears to be invalid JSON, please check it at http://jsonlint.com/
`+r)}}N.Grammar=Se;N.Visitor=we;var Bd=N;exports.default = Bd;
//# sourceMappingURL=riscript.cjs.map