"use strict";function t(t){let e,n=t[0],r=1;for(;r<t.length;){const i=t[r],s=t[r+1];if(r+=2,("optionalAccess"===i||"optionalCall"===i)&&null==n)return;"access"===i||"optionalAccess"===i?(e=n,n=s(n)):"call"!==i&&"optionalCall"!==i||(n=s(((...t)=>n.call(e,...t))),e=void 0)}return n}Object.defineProperty(exports,"__esModule",{value:!0});var e,n=Object.defineProperty,r=(t,e,r)=>(((t,e,r)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r),i=require("he"),s=(e=i)&&e.__esModule?e:{default:e},o=require("mingo"),a="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,u=a||c||Function("return this")(),l=u.Symbol,h=Object.prototype,p=h.hasOwnProperty,d=h.toString,f=l?l.toStringTag:void 0;var E=function(t){var e=p.call(t,f),n=t[f];try{t[f]=void 0;var r=!0}catch(t){}var i=d.call(t);return r&&(e?t[f]=n:delete t[f]),i},m=Object.prototype.toString;var g=function(t){return m.call(t)},T=l?l.toStringTag:void 0;var v=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":T&&T in Object(t)?E(t):g(t)};var y=function(t){return null!=t&&"object"==typeof t};var R=function(t){return"symbol"==typeof t||y(t)&&"[object Symbol]"==v(t)};var A=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},O=Array.isArray,I=l?l.prototype:void 0,N=I?I.toString:void 0;var S=function t(e){if("string"==typeof e)return e;if(O(e))return A(e,t)+"";if(R(e))return N?N.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n},_=/\s/;var L=function(t){for(var e=t.length;e--&&_.test(t.charAt(e)););return e},C=/^\s+/;var x=function(t){return t?t.slice(0,L(t)+1).replace(C,""):t};var k=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},b=/^[-+]0x[0-9a-f]+$/i,P=/^0b[01]+$/i,w=/^0o[0-7]+$/i,M=parseInt;var U=function(t){if("number"==typeof t)return t;if(R(t))return NaN;if(k(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=k(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=x(t);var n=P.test(t);return n||w.test(t)?M(t.slice(2),n?2:8):b.test(t)?NaN:+t},D=1/0;var F=function(t){return t?(t=U(t))===D||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var j=function(t){var e=F(t),n=e%1;return e==e?n?e-n:e:0};var $=function(t){return t};var G,B=function(t){if(!k(t))return!1;var e=v(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},W=u["__core-js_shared__"],K=(G=/[^.]+$/.exec(W&&W.keys&&W.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var H=function(t){return!!K&&K in t},z=Function.prototype.toString;var V=function(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Y=/^\[object .+?Constructor\]$/,X=Function.prototype,q=Object.prototype,J=X.toString,Z=q.hasOwnProperty,Q=RegExp("^"+J.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var tt=function(t){return!(!k(t)||H(t))&&(B(t)?Q:Y).test(V(t))};var et=function(t,e){return null==t?void 0:t[e]};var nt=function(t,e){var n=et(t,e);return tt(n)?n:void 0},rt=nt(u,"WeakMap"),it=Object.create,st=function(){function t(){}return function(e){if(!k(e))return{};if(it)return it(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var ot=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)};var at=function(){};var ct=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},ut=Date.now;var lt=function(t){var e=0,n=0;return function(){var r=ut(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}};var ht=function(t){return function(){return t}},pt=function(){try{var t=nt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),dt=lt(pt?function(t,e){return pt(t,"toString",{configurable:!0,enumerable:!1,value:ht(e),writable:!0})}:$);var ft=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t};var Et=function(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1};var mt=function(t){return t!=t};var gt=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1};var Tt=function(t,e,n){return e==e?gt(t,e,n):Et(t,mt,n)};var vt=function(t,e){return!!(null==t?0:t.length)&&Tt(t,e,0)>-1},yt=/^(?:0|[1-9]\d*)$/;var Rt=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&yt.test(t))&&t>-1&&t%1==0&&t<e};var At=function(t,e,n){"__proto__"==e&&pt?pt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var Ot=function(t,e){return t===e||t!=t&&e!=e},It=Object.prototype.hasOwnProperty;var Nt=function(t,e,n){var r=t[e];It.call(t,e)&&Ot(r,n)&&(void 0!==n||e in t)||At(t,e,n)};var St=function(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),i?At(n,a,c):Nt(n,a,c)}return n},_t=Math.max;var Lt=function(t,e,n){return e=_t(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=_t(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),ot(t,this,a)}};var Ct=function(t,e){return dt(Lt(t,e,$),t+"")};var xt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var kt=function(t){return null!=t&&xt(t.length)&&!B(t)};var bt=function(t,e,n){if(!k(n))return!1;var r=typeof e;return!!("number"==r?kt(n)&&Rt(e,n.length):"string"==r&&e in n)&&Ot(n[e],t)};var Pt=function(t){return Ct((function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(i--,s):void 0,o&&bt(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e}))},wt=Object.prototype;var Mt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||wt)};var Ut=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var Dt=function(t){return y(t)&&"[object Arguments]"==v(t)},Ft=Object.prototype,jt=Ft.hasOwnProperty,$t=Ft.propertyIsEnumerable,Gt=Dt(function(){return arguments}())?Dt:function(t){return y(t)&&jt.call(t,"callee")&&!$t.call(t,"callee")};var Bt=function(){return!1},Wt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Kt=Wt&&"object"==typeof module&&module&&!module.nodeType&&module,Ht=Kt&&Kt.exports===Wt?u.Buffer:void 0,zt=(Ht?Ht.isBuffer:void 0)||Bt,Vt={};Vt["[object Float32Array]"]=Vt["[object Float64Array]"]=Vt["[object Int8Array]"]=Vt["[object Int16Array]"]=Vt["[object Int32Array]"]=Vt["[object Uint8Array]"]=Vt["[object Uint8ClampedArray]"]=Vt["[object Uint16Array]"]=Vt["[object Uint32Array]"]=!0,Vt["[object Arguments]"]=Vt["[object Array]"]=Vt["[object ArrayBuffer]"]=Vt["[object Boolean]"]=Vt["[object DataView]"]=Vt["[object Date]"]=Vt["[object Error]"]=Vt["[object Function]"]=Vt["[object Map]"]=Vt["[object Number]"]=Vt["[object Object]"]=Vt["[object RegExp]"]=Vt["[object Set]"]=Vt["[object String]"]=Vt["[object WeakMap]"]=!1;var Yt=function(t){return y(t)&&xt(t.length)&&!!Vt[v(t)]};var Xt=function(t){return function(e){return t(e)}},qt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Jt=qt&&"object"==typeof module&&module&&!module.nodeType&&module,Zt=Jt&&Jt.exports===qt&&a.process,Qt=function(){try{var t=Jt&&Jt.require&&Jt.require("util").types;return t||Zt&&Zt.binding&&Zt.binding("util")}catch(t){}}(),te=Qt&&Qt.isTypedArray,ee=te?Xt(te):Yt,ne=Object.prototype.hasOwnProperty;var re=function(t,e){var n=O(t),r=!n&&Gt(t),i=!n&&!r&&zt(t),s=!n&&!r&&!i&&ee(t),o=n||r||i||s,a=o?Ut(t.length,String):[],c=a.length;for(var u in t)!e&&!ne.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Rt(u,c))||a.push(u);return a};var ie=function(t,e){return function(n){return t(e(n))}},se=ie(Object.keys,Object),oe=Object.prototype.hasOwnProperty;var ae=function(t){if(!Mt(t))return se(t);var e=[];for(var n in Object(t))oe.call(t,n)&&"constructor"!=n&&e.push(n);return e};var ce=function(t){return kt(t)?re(t):ae(t)},ue=Object.prototype.hasOwnProperty,le=Pt((function(t,e){if(Mt(e)||kt(e))St(e,ce(e),t);else for(var n in e)ue.call(e,n)&&Nt(t,n,e[n])}));var he=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},pe=Object.prototype.hasOwnProperty;var de=function(t){if(!k(t))return he(t);var e=Mt(t),n=[];for(var r in t)("constructor"!=r||!e&&pe.call(t,r))&&n.push(r);return n};var fe=function(t){return kt(t)?re(t,!0):de(t)},Ee=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,me=/^\w*$/;var ge=function(t,e){if(O(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!R(t))||(me.test(t)||!Ee.test(t)||null!=e&&t in Object(e))},Te=nt(Object,"create");var ve=function(){this.__data__=Te?Te(null):{},this.size=0};var ye=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Re=Object.prototype.hasOwnProperty;var Ae=function(t){var e=this.__data__;if(Te){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Re.call(e,t)?e[t]:void 0},Oe=Object.prototype.hasOwnProperty;var Ie=function(t){var e=this.__data__;return Te?void 0!==e[t]:Oe.call(e,t)};var Ne=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Te&&void 0===e?"__lodash_hash_undefined__":e,this};function Se(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Se.prototype.clear=ve,Se.prototype.delete=ye,Se.prototype.get=Ae,Se.prototype.has=Ie,Se.prototype.set=Ne;var _e=Se;var Le=function(){this.__data__=[],this.size=0};var Ce=function(t,e){for(var n=t.length;n--;)if(Ot(t[n][0],e))return n;return-1},xe=Array.prototype.splice;var ke=function(t){var e=this.__data__,n=Ce(e,t);return!(n<0)&&(n==e.length-1?e.pop():xe.call(e,n,1),--this.size,!0)};var be=function(t){var e=this.__data__,n=Ce(e,t);return n<0?void 0:e[n][1]};var Pe=function(t){return Ce(this.__data__,t)>-1};var we=function(t,e){var n=this.__data__,r=Ce(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function Me(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Me.prototype.clear=Le,Me.prototype.delete=ke,Me.prototype.get=be,Me.prototype.has=Pe,Me.prototype.set=we;var Ue=Me,De=nt(u,"Map");var Fe=function(){this.size=0,this.__data__={hash:new _e,map:new(De||Ue),string:new _e}};var je=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var $e=function(t,e){var n=t.__data__;return je(e)?n["string"==typeof e?"string":"hash"]:n.map};var Ge=function(t){var e=$e(this,t).delete(t);return this.size-=e?1:0,e};var Be=function(t){return $e(this,t).get(t)};var We=function(t){return $e(this,t).has(t)};var Ke=function(t,e){var n=$e(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function He(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}He.prototype.clear=Fe,He.prototype.delete=Ge,He.prototype.get=Be,He.prototype.has=We,He.prototype.set=Ke;var ze=He;function Ve(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Ve.Cache||ze),n}Ve.Cache=ze;var Ye=Ve;var Xe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qe=/\\(\\)?/g,Je=function(t){var e=Ye(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Xe,(function(t,n,r,i){e.push(r?i.replace(qe,"$1"):n||t)})),e}));var Ze=function(t){return null==t?"":S(t)};var Qe=function(t,e){return O(t)?t:ge(t,e)?[t]:Je(Ze(t))};var tn=function(t){if("string"==typeof t||R(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var en=function(t,e){for(var n=0,r=(e=Qe(e,t)).length;null!=t&&n<r;)t=t[tn(e[n++])];return n&&n==r?t:void 0};var nn=function(t,e,n){var r=null==t?void 0:en(t,e);return void 0===r?n:r};var rn=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},sn=l?l.isConcatSpreadable:void 0;var on=function(t){return O(t)||Gt(t)||!!(sn&&t&&t[sn])};var an=function t(e,n,r,i,s){var o=-1,a=e.length;for(r||(r=on),s||(s=[]);++o<a;){var c=e[o];n>0&&r(c)?n>1?t(c,n-1,r,i,s):rn(s,c):i||(s[s.length]=c)}return s};var cn=function(t){return(null==t?0:t.length)?an(t,1):[]},un=ie(Object.getPrototypeOf,Object);var ln=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s};var hn=function(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n};var pn=function(){this.__data__=new Ue,this.size=0};var dn=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var fn=function(t){return this.__data__.get(t)};var En=function(t){return this.__data__.has(t)};var mn=function(t,e){var n=this.__data__;if(n instanceof Ue){var r=n.__data__;if(!De||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new ze(r)}return n.set(t,e),this.size=n.size,this};function gn(t){var e=this.__data__=new Ue(t);this.size=e.size}gn.prototype.clear=pn,gn.prototype.delete=dn,gn.prototype.get=fn,gn.prototype.has=En,gn.prototype.set=mn;var Tn=gn;var vn=function(t,e){return t&&St(e,ce(e),t)};var yn=function(t,e){return t&&St(e,fe(e),t)},Rn="object"==typeof exports&&exports&&!exports.nodeType&&exports,An=Rn&&"object"==typeof module&&module&&!module.nodeType&&module,On=An&&An.exports===Rn?u.Buffer:void 0,In=On?On.allocUnsafe:void 0;var Nn=function(t,e){if(e)return t.slice();var n=t.length,r=In?In(n):new t.constructor(n);return t.copy(r),r};var Sn=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s};var _n=function(){return[]},Ln=Object.prototype.propertyIsEnumerable,Cn=Object.getOwnPropertySymbols,xn=Cn?function(t){return null==t?[]:(t=Object(t),Sn(Cn(t),(function(e){return Ln.call(t,e)})))}:_n;var kn=function(t,e){return St(t,xn(t),e)},bn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)rn(e,xn(t)),t=un(t);return e}:_n;var Pn=function(t,e){return St(t,bn(t),e)};var wn=function(t,e,n){var r=e(t);return O(t)?r:rn(r,n(t))};var Mn=function(t){return wn(t,ce,xn)};var Un=function(t){return wn(t,fe,bn)},Dn=nt(u,"DataView"),Fn=nt(u,"Promise"),jn=nt(u,"Set"),$n="[object Map]",Gn="[object Promise]",Bn="[object Set]",Wn="[object WeakMap]",Kn="[object DataView]",Hn=V(Dn),zn=V(De),Vn=V(Fn),Yn=V(jn),Xn=V(rt),qn=v;(Dn&&qn(new Dn(new ArrayBuffer(1)))!=Kn||De&&qn(new De)!=$n||Fn&&qn(Fn.resolve())!=Gn||jn&&qn(new jn)!=Bn||rt&&qn(new rt)!=Wn)&&(qn=function(t){var e=v(t),n="[object Object]"==e?t.constructor:void 0,r=n?V(n):"";if(r)switch(r){case Hn:return Kn;case zn:return $n;case Vn:return Gn;case Yn:return Bn;case Xn:return Wn}return e});var Jn=qn,Zn=Object.prototype.hasOwnProperty;var Qn=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Zn.call(t,"index")&&(n.index=t.index,n.input=t.input),n},tr=u.Uint8Array;var er=function(t){var e=new t.constructor(t.byteLength);return new tr(e).set(new tr(t)),e};var nr=function(t,e){var n=e?er(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},rr=/\w*$/;var ir=function(t){var e=new t.constructor(t.source,rr.exec(t));return e.lastIndex=t.lastIndex,e},sr=l?l.prototype:void 0,or=sr?sr.valueOf:void 0;var ar=function(t){return or?Object(or.call(t)):{}};var cr=function(t,e){var n=e?er(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var ur=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return er(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return nr(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return cr(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return ir(t);case"[object Symbol]":return ar(t)}};var lr=function(t){return"function"!=typeof t.constructor||Mt(t)?{}:st(un(t))};var hr=function(t){return y(t)&&"[object Map]"==Jn(t)},pr=Qt&&Qt.isMap,dr=pr?Xt(pr):hr;var fr=function(t){return y(t)&&"[object Set]"==Jn(t)},Er=Qt&&Qt.isSet,mr=Er?Xt(Er):fr,gr="[object Arguments]",Tr="[object Function]",vr="[object Object]",yr={};yr[gr]=yr["[object Array]"]=yr["[object ArrayBuffer]"]=yr["[object DataView]"]=yr["[object Boolean]"]=yr["[object Date]"]=yr["[object Float32Array]"]=yr["[object Float64Array]"]=yr["[object Int8Array]"]=yr["[object Int16Array]"]=yr["[object Int32Array]"]=yr["[object Map]"]=yr["[object Number]"]=yr[vr]=yr["[object RegExp]"]=yr["[object Set]"]=yr["[object String]"]=yr["[object Symbol]"]=yr["[object Uint8Array]"]=yr["[object Uint8ClampedArray]"]=yr["[object Uint16Array]"]=yr["[object Uint32Array]"]=!0,yr["[object Error]"]=yr[Tr]=yr["[object WeakMap]"]=!1;var Rr=function t(e,n,r,i,s,o){var a,c=1&n,u=2&n,l=4&n;if(r&&(a=s?r(e,i,s,o):r(e)),void 0!==a)return a;if(!k(e))return e;var h=O(e);if(h){if(a=Qn(e),!c)return ct(e,a)}else{var p=Jn(e),d=p==Tr||"[object GeneratorFunction]"==p;if(zt(e))return Nn(e,c);if(p==vr||p==gr||d&&!s){if(a=u||d?{}:lr(e),!c)return u?Pn(e,yn(a,e)):kn(e,vn(a,e))}else{if(!yr[p])return s?e:{};a=ur(e,p,c)}}o||(o=new Tn);var f=o.get(e);if(f)return f;o.set(e,a),mr(e)?e.forEach((function(i){a.add(t(i,n,r,i,e,o))})):dr(e)&&e.forEach((function(i,s){a.set(s,t(i,n,r,s,e,o))}));var E=h?void 0:(l?u?Un:Mn:u?fe:ce)(e);return ft(E||e,(function(i,s){E&&(i=e[s=i]),Nt(a,s,t(i,n,r,s,e,o))})),a};var Ar=function(t){return Rr(t,4)};var Or=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i};var Ir=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Nr=function(t){return this.__data__.has(t)};function Sr(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new ze;++e<n;)this.add(t[e])}Sr.prototype.add=Sr.prototype.push=Ir,Sr.prototype.has=Nr;var _r=Sr;var Lr=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var Cr=function(t,e){return t.has(e)};var xr=function(t,e,n,r,i,s){var o=1&n,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(t),l=s.get(e);if(u&&l)return u==e&&l==t;var h=-1,p=!0,d=2&n?new _r:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var f=t[h],E=e[h];if(r)var m=o?r(E,f,h,e,t,s):r(f,E,h,t,e,s);if(void 0!==m){if(m)continue;p=!1;break}if(d){if(!Lr(e,(function(t,e){if(!Cr(d,e)&&(f===t||i(f,t,n,r,s)))return d.push(e)}))){p=!1;break}}else if(f!==E&&!i(f,E,n,r,s)){p=!1;break}}return s.delete(t),s.delete(e),p};var kr=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n};var br=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Pr=l?l.prototype:void 0,wr=Pr?Pr.valueOf:void 0;var Mr=function(t,e,n,r,i,s,o){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!s(new tr(t),new tr(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ot(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=kr;case"[object Set]":var c=1&r;if(a||(a=br),t.size!=e.size&&!c)return!1;var u=o.get(t);if(u)return u==e;r|=2,o.set(t,e);var l=xr(a(t),a(e),r,i,s,o);return o.delete(t),l;case"[object Symbol]":if(wr)return wr.call(t)==wr.call(e)}return!1},Ur=Object.prototype.hasOwnProperty;var Dr=function(t,e,n,r,i,s){var o=1&n,a=Mn(t),c=a.length;if(c!=Mn(e).length&&!o)return!1;for(var u=c;u--;){var l=a[u];if(!(o?l in e:Ur.call(e,l)))return!1}var h=s.get(t),p=s.get(e);if(h&&p)return h==e&&p==t;var d=!0;s.set(t,e),s.set(e,t);for(var f=o;++u<c;){var E=t[l=a[u]],m=e[l];if(r)var g=o?r(m,E,l,e,t,s):r(E,m,l,t,e,s);if(!(void 0===g?E===m||i(E,m,n,r,s):g)){d=!1;break}f||(f="constructor"==l)}if(d&&!f){var T=t.constructor,v=e.constructor;T==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof T&&T instanceof T&&"function"==typeof v&&v instanceof v||(d=!1)}return s.delete(t),s.delete(e),d},Fr="[object Arguments]",jr="[object Array]",$r="[object Object]",Gr=Object.prototype.hasOwnProperty;var Br=function(t,e,n,r,i,s){var o=O(t),a=O(e),c=o?jr:Jn(t),u=a?jr:Jn(e),l=(c=c==Fr?$r:c)==$r,h=(u=u==Fr?$r:u)==$r,p=c==u;if(p&&zt(t)){if(!zt(e))return!1;o=!0,l=!1}if(p&&!l)return s||(s=new Tn),o||ee(t)?xr(t,e,n,r,i,s):Mr(t,e,c,n,r,i,s);if(!(1&n)){var d=l&&Gr.call(t,"__wrapped__"),f=h&&Gr.call(e,"__wrapped__");if(d||f){var E=d?t.value():t,m=f?e.value():e;return s||(s=new Tn),i(E,m,n,r,s)}}return!!p&&(s||(s=new Tn),Dr(t,e,n,r,i,s))};var Wr=function t(e,n,r,i,s){return e===n||(null==e||null==n||!y(e)&&!y(n)?e!=e&&n!=n:Br(e,n,r,i,t,s))};var Kr=function(t,e,n,r){var i=n.length,s=i,o=!r;if(null==t)return!s;for(t=Object(t);i--;){var a=n[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){var c=(a=n[i])[0],u=t[c],l=a[1];if(o&&a[2]){if(void 0===u&&!(c in t))return!1}else{var h=new Tn;if(r)var p=r(u,l,c,t,e,h);if(!(void 0===p?Wr(l,u,3,r,h):p))return!1}}return!0};var Hr=function(t){return t==t&&!k(t)};var zr=function(t){for(var e=ce(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Hr(i)]}return e};var Vr=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}};var Yr=function(t){var e=zr(t);return 1==e.length&&e[0][2]?Vr(e[0][0],e[0][1]):function(n){return n===t||Kr(n,t,e)}};var Xr=function(t,e){return null!=t&&e in Object(t)};var qr=function(t,e,n){for(var r=-1,i=(e=Qe(e,t)).length,s=!1;++r<i;){var o=tn(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&xt(i)&&Rt(o,i)&&(O(t)||Gt(t))};var Jr=function(t,e){return null!=t&&qr(t,e,Xr)};var Zr=function(t,e){return ge(t)&&Hr(e)?Vr(tn(t),e):function(n){var r=nn(n,t);return void 0===r&&r===e?Jr(n,t):Wr(e,r,3)}};var Qr=function(t){return function(e){return null==e?void 0:e[t]}};var ti=function(t){return function(e){return en(e,t)}};var ei=function(t){return ge(t)?Qr(tn(t)):ti(t)};var ni=function(t){return"function"==typeof t?t:null==t?$:"object"==typeof t?O(t)?Zr(t[0],t[1]):Yr(t):ei(t)};var ri=function(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r};var ii=function(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[t?a:++i];if(!1===n(s[c],c,s))break}return e}}();var si=function(t,e){return function(n,r){if(null==n)return n;if(!kt(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Object(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}((function(t,e){return t&&ii(t,e,ce)}));var oi=function(t,e,n,r){return si(t,(function(t,i,s){e(r,t,n(t),s)})),r};var ai=function(t,e){return function(n,r){var i=O(n)?ri:oi,s=e?e():{};return i(n,t,ni(r,2),s)}},ci=Object.prototype,ui=ci.hasOwnProperty,li=Ct((function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&bt(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=fe(s),a=-1,c=o.length;++a<c;){var u=o[a],l=t[u];(void 0===l||Ot(l,ci[u])&&!ui.call(t,u))&&(t[u]=s[u])}return t}));var hi=function(t){return y(t)&&kt(t)};var pi=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1};var di=function(t,e,n,r){var i=-1,s=vt,o=!0,a=t.length,c=[],u=e.length;if(!a)return c;n&&(e=A(e,Xt(n))),r?(s=pi,o=!1):e.length>=200&&(s=Cr,o=!1,e=new _r(e));t:for(;++i<a;){var l=t[i],h=null==n?l:n(l);if(l=r||0!==l?l:0,o&&h==h){for(var p=u;p--;)if(e[p]===h)continue t;c.push(l)}else s(e,h,r)||c.push(l)}return c},fi=Ct((function(t,e){return hi(t)?di(t,an(e,1,hi,!0)):[]}));var Ei=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};var mi=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:j(e),ln(t,e<0?0:e,r)):[]};var gi=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:j(e),ln(t,0,(e=r-e)<0?0:e)):[]};var Ti=function(t){return"function"==typeof t?t:$};var vi=function(t,e){return(O(t)?ft:si)(t,Ti(e))};var yi=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0};var Ri=function(t,e){var n=!0;return si(t,(function(t,r,i){return n=!!e(t,r,i)})),n};var Ai=function(t,e,n){var r=O(t)?yi:Ri;return n&&bt(t,e,n)&&(e=void 0),r(t,ni(e,3))};var Oi=function(t,e){var n=[];return si(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n};var Ii=function(t,e){return(O(t)?Sn:Oi)(t,ni(e,3))};var Ni=function(t){return function(e,n,r){var i=Object(e);if(!kt(e)){var s=ni(n,3);e=ce(e),n=function(t){return s(i[t],t,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}},Si=Math.max;var _i=Ni((function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:j(n);return i<0&&(i=Si(r+i,0)),Et(t,ni(e,3),i)}));var Li=function(t){return t&&t.length?t[0]:void 0};var Ci=function(t,e){var n=-1,r=kt(t)?Array(t.length):[];return si(t,(function(t,i,s){r[++n]=e(t,i,s)})),r};var xi=function(t,e){return(O(t)?A:Ci)(t,ni(e,3))};var ki=function(t,e){return an(xi(t,e),1)},bi=Object.prototype.hasOwnProperty,Pi=ai((function(t,e,n){bi.call(t,n)?t[n].push(e):At(t,n,[e])})),wi=Object.prototype.hasOwnProperty;var Mi=function(t,e){return null!=t&&wi.call(t,e)};var Ui=function(t,e){return null!=t&&qr(t,e,Mi)};var Di=function(t){return"string"==typeof t||!O(t)&&y(t)&&"[object String]"==v(t)};var Fi=function(t,e){return A(e,(function(e){return t[e]}))};var ji=function(t){return null==t?[]:Fi(t,ce(t))},$i=Math.max;var Gi=function(t,e,n,r){t=kt(t)?t:ji(t),n=n&&!r?j(n):0;var i=t.length;return n<0&&(n=$i(i+n,0)),Di(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Tt(t,e,n)>-1},Bi=Math.max;var Wi=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:j(n);return i<0&&(i=Bi(r+i,0)),Tt(t,e,i)},Ki=Object.prototype.hasOwnProperty;var Hi=function(t){if(null==t)return!0;if(kt(t)&&(O(t)||"string"==typeof t||"function"==typeof t.splice||zt(t)||ee(t)||Gt(t)))return!t.length;var e=Jn(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(Mt(t))return!ae(t).length;for(var n in t)if(Ki.call(t,n))return!1;return!0};var zi=function(t){return y(t)&&"[object RegExp]"==v(t)},Vi=Qt&&Qt.isRegExp,Yi=Vi?Xt(Vi):zi;var Xi=function(t){return void 0===t};var qi=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}};var Ji=function(t,e,n,r){if(!k(t))return t;for(var i=-1,s=(e=Qe(e,t)).length,o=s-1,a=t;null!=a&&++i<s;){var c=tn(e[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(i!=o){var l=a[c];void 0===(u=r?r(l,c,a):void 0)&&(u=k(l)?l:Rt(e[i+1])?[]:{})}Nt(a,c,u),a=a[c]}return t};var Zi=function(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=en(t,o);n(a,o)&&Ji(s,Qe(o,t),a)}return s};var Qi=function(t,e){if(null==t)return{};var n=A(Un(t),(function(t){return[t]}));return e=ni(e),Zi(t,n,(function(t,n){return e(t,n[0])}))};var ts=function(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n};var es=function(t,e,n){var r=O(t)?hn:ts,i=arguments.length<3;return r(t,ni(e,4),n,i,si)};var ns=function(t,e){return(O(t)?Sn:Oi)(t,qi(ni(e,3)))};var rs=function(t,e){var n;return si(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n};var is=function(t,e,n){var r=O(t)?Lr:rs;return n&&bt(t,e,n)&&(e=void 0),r(t,ni(e,3))},ss=jn&&1/br(new jn([,-0]))[1]==1/0?function(t){return new jn(t)}:at;var os=function(t,e,n){var r=-1,i=vt,s=t.length,o=!0,a=[],c=a;if(n)o=!1,i=pi;else if(s>=200){var u=e?null:ss(t);if(u)return br(u);o=!1,i=Cr,c=new _r}else c=e?[]:a;t:for(;++r<s;){var l=t[r],h=e?e(l):l;if(l=n||0!==l?l:0,o&&h==h){for(var p=c.length;p--;)if(c[p]===h)continue t;e&&c.push(h),a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a};var as=function(t){return t&&t.length?os(t):[]};function cs(t){console&&console.error&&console.error(`Error: ${t}`)}function us(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function ls(t){const e=(new Date).getTime(),n=t();return{time:(new Date).getTime()-e,value:n}}function hs(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function ps(t){return function(t){return Di(t.LABEL)&&""!==t.LABEL}(t)?t.LABEL:t.name}var ds=class{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),vi(this.definition,(e=>{e.accept(t)}))}},fs=class extends ds{constructor(t){super([]),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}set definition(t){}get definition(){return void 0!==this.referencedRule?this.referencedRule.definition:[]}accept(t){t.visit(this)}},Es=class extends ds{constructor(t){super(t.definition),this.orgText="",le(this,Qi(t,(t=>void 0!==t)))}},ms=class extends ds{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,le(this,Qi(t,(t=>void 0!==t)))}},gs=class extends ds{constructor(t){super(t.definition),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}},Ts=class extends ds{constructor(t){super(t.definition),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}},vs=class extends ds{constructor(t){super(t.definition),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}},ys=class extends ds{constructor(t){super(t.definition),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}},Rs=class extends ds{constructor(t){super(t.definition),this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}},As=class extends ds{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,le(this,Qi(t,(t=>void 0!==t)))}},Os=class{constructor(t){this.idx=1,le(this,Qi(t,(t=>void 0!==t)))}accept(t){t.visit(this)}};function Is(t){function e(t){return xi(t,Is)}if(t instanceof fs){const e={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Di(t.label)&&(e.label=t.label),e}if(t instanceof ms)return{type:"Alternative",definition:e(t.definition)};if(t instanceof gs)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Ts)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof vs)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Is(new Os({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Rs)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Is(new Os({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ys)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof As)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Os){const e={type:"Terminal",name:t.terminalType.name,label:ps(t.terminalType),idx:t.idx};Di(t.label)&&(e.terminalLabel=t.label);const n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(e.pattern=Yi(n)?n.source:n),e}if(t instanceof Es)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}var Ns=class{visit(t){const e=t;switch(e.constructor){case fs:return this.visitNonTerminal(e);case ms:return this.visitAlternative(e);case gs:return this.visitOption(e);case Ts:return this.visitRepetitionMandatory(e);case vs:return this.visitRepetitionMandatoryWithSeparator(e);case Rs:return this.visitRepetitionWithSeparator(e);case ys:return this.visitRepetition(e);case As:return this.visitAlternation(e);case Os:return this.visitTerminal(e);case Es:return this.visitRule(e);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}};function Ss(t,e=[]){return!!(t instanceof gs||t instanceof ys||t instanceof Rs)||(t instanceof As?is(t.definition,(t=>Ss(t,e))):!(t instanceof fs&&Gi(e,t))&&(t instanceof ds&&(t instanceof fs&&e.push(t),Ai(t.definition,(t=>Ss(t,e))))))}function _s(t){if(t instanceof fs)return"SUBRULE";if(t instanceof gs)return"OPTION";if(t instanceof As)return"OR";if(t instanceof Ts)return"AT_LEAST_ONE";if(t instanceof vs)return"AT_LEAST_ONE_SEP";if(t instanceof Rs)return"MANY_SEP";if(t instanceof ys)return"MANY";if(t instanceof Os)return"CONSUME";throw Error("non exhaustive match")}var Ls=class{walk(t,e=[]){vi(t.definition,((n,r)=>{const i=mi(t.definition,r+1);if(n instanceof fs)this.walkProdRef(n,i,e);else if(n instanceof Os)this.walkTerminal(n,i,e);else if(n instanceof ms)this.walkFlat(n,i,e);else if(n instanceof gs)this.walkOption(n,i,e);else if(n instanceof Ts)this.walkAtLeastOne(n,i,e);else if(n instanceof vs)this.walkAtLeastOneSep(n,i,e);else if(n instanceof Rs)this.walkManySep(n,i,e);else if(n instanceof ys)this.walkMany(n,i,e);else{if(!(n instanceof As))throw Error("non exhaustive match");this.walkOr(n,i,e)}}))}walkTerminal(t,e,n){}walkProdRef(t,e,n){}walkFlat(t,e,n){const r=e.concat(n);this.walk(t,r)}walkOption(t,e,n){const r=e.concat(n);this.walk(t,r)}walkAtLeastOne(t,e,n){const r=[new gs({definition:t.definition})].concat(e,n);this.walk(t,r)}walkAtLeastOneSep(t,e,n){const r=Cs(t,e,n);this.walk(t,r)}walkMany(t,e,n){const r=[new gs({definition:t.definition})].concat(e,n);this.walk(t,r)}walkManySep(t,e,n){const r=Cs(t,e,n);this.walk(t,r)}walkOr(t,e,n){const r=e.concat(n);vi(t.definition,(t=>{const e=new ms({definition:[t]});this.walk(e,r)}))}};function Cs(t,e,n){return[new gs({definition:[new Os({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function xs(t){if(t instanceof fs)return xs(t.referencedRule);if(t instanceof Os)return[t.terminalType];if(function(t){return t instanceof ms||t instanceof gs||t instanceof ys||t instanceof Ts||t instanceof vs||t instanceof Rs||t instanceof Os||t instanceof Es}(t))return function(t){let e=[];const n=t.definition;let r,i=0,s=n.length>i,o=!0;for(;s&&o;)r=n[i],o=Ss(r),e=e.concat(xs(r)),i+=1,s=n.length>i;return as(e)}(t);if(function(t){return t instanceof As}(t))return function(t){const e=xi(t.definition,(t=>xs(t)));return as(cn(e))}(t);throw Error("non exhaustive match")}var ks="_~IN~_",bs=class extends Ls{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,e,n){}walkProdRef(t,e,n){const r=(i=t.referencedRule,s=t.idx,i.name+s+ks+this.topProd.name);var i,s;const o=e.concat(n),a=xs(new ms({definition:o}));this.follows[r]=a}};function Ps(t){return t.charCodeAt(0)}function ws(t,e){Array.isArray(t)?t.forEach((function(t){e.push(t)})):e.push(t)}function Ms(t,e){if(!0===t[e])throw"duplicate flag "+e;t[e];t[e]=!0}function Us(t){if(void 0===t)throw Error("Internal Error - Should never get here!");return!0}function Ds(){throw Error("Internal Error - Should never get here!")}function Fs(t){return"Character"===t.type}var js=[];for(let t=Ps("0");t<=Ps("9");t++)js.push(t);var $s=[Ps("_")].concat(js);for(let t=Ps("a");t<=Ps("z");t++)$s.push(t);for(let t=Ps("A");t<=Ps("Z");t++)$s.push(t);var Gs=[Ps(" "),Ps("\f"),Ps("\n"),Ps("\r"),Ps("\t"),Ps("\v"),Ps("\t"),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps(" "),Ps("\u2028"),Ps("\u2029"),Ps(" "),Ps(" "),Ps("　"),Ps("\ufeff")],Bs=/[0-9a-fA-F]/,Ws=/[0-9]/,Ks=/[1-9]/,Hs=class{visitChildren(t){for(const e in t){const n=t[e];t.hasOwnProperty(e)&&(void 0!==n.type?this.visit(n):Array.isArray(n)&&n.forEach((t=>{this.visit(t)}),this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t)}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}},zs={},Vs=new class{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const e=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Ms(n,"global");break;case"i":Ms(n,"ignoreCase");break;case"m":Ms(n,"multiLine");break;case"u":Ms(n,"unicode");break;case"y":Ms(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:e,loc:this.loc(0)}}disjunction(){const t=[],e=this.idx;for(t.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(e)}}alternative(){const t=[],e=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(e)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":let e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}Us(e);const n=this.disjunction();return this.consumeChar(")"),{type:e,value:n,loc:this.loc(t)}}return Ds()}quantifier(t=!1){let e;const n=this.idx;switch(this.popChar()){case"*":e={atLeast:0,atMost:1/0};break;case"+":e={atLeast:1,atMost:1/0};break;case"?":e={atLeast:0,atMost:1};break;case"{":const n=this.integerIncludingZero();switch(this.popChar()){case"}":e={atLeast:n,atMost:n};break;case",":let t;this.isDigit()?(t=this.integerIncludingZero(),e={atLeast:n,atMost:t}):e={atLeast:n,atMost:1/0},this.consumeChar("}")}if(!0===t&&void 0===e)return;Us(e)}if(!0!==t||void 0!==e)return Us(e)?("?"===this.peekChar(0)?(this.consumeChar("?"),e.greedy=!1):e.greedy=!0,e.type="Quantifier",e.loc=this.loc(n),e):void 0}atom(){let t;const e=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group()}return void 0===t&&this.isPatternCharacter()&&(t=this.patternCharacter()),Us(t)?(t.loc=this.loc(e),this.isQuantifier()&&(t.quantifier=this.quantifier()),t):Ds()}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ps("\n"),Ps("\r"),Ps("\u2028"),Ps("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,e=!1;switch(this.popChar()){case"d":t=js;break;case"D":t=js,e=!0;break;case"s":t=Gs;break;case"S":t=Gs,e=!0;break;case"w":t=$s;break;case"W":t=$s,e=!0}return Us(t)?{type:"Set",value:t,complement:e}:Ds()}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ps("\f");break;case"n":t=Ps("\n");break;case"r":t=Ps("\r");break;case"t":t=Ps("\t");break;case"v":t=Ps("\v")}return Us(t)?{type:"Character",value:t}:Ds()}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(!1===/[a-zA-Z]/.test(t))throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ps("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){return{type:"Character",value:Ps(this.popChar())}}classPatternCharacterAtom(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:Ps(this.popChar())}}}characterClass(){const t=[];let e=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),e=!0);this.isClassAtom();){const e=this.classAtom();e.type;if(Fs(e)&&this.isRangeDash()){this.consumeChar("-");const n=this.classAtom();n.type;if(Fs(n)){if(n.value<e.value)throw Error("Range out of order in character class");t.push({from:e.value,to:n.value})}else ws(e.value,t),t.push(Ps("-")),ws(n.value,t)}else ws(e.value,t)}return this.consumeChar("]"),{type:"Set",complement:e,value:t}}classAtom(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ps("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;if(this.consumeChar("("),"?"===this.peekChar(0))this.consumeChar("?"),this.consumeChar(":"),t=!1;else this.groupIdx++;const e=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:t,value:e};return t&&(n.idx=this.groupIdx),n}positiveInteger(){let t=this.popChar();if(!1===Ks.test(t))throw Error("Expecting a positive integer");for(;Ws.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(!1===Ws.test(t))throw Error("Expecting an integer");for(;Ws.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ps(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return"-"===this.peekChar()&&this.isClassAtom(1)}isDigit(){return Ws.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}}isQuantifier(){const t=this.saveState();try{return void 0!==this.quantifier(!0)}catch(t){return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let e="";for(let n=0;n<t;n++){const t=this.popChar();if(!1===Bs.test(t))throw Error("Expecting a HexDecimal digits");e+=t}return{type:"Character",value:parseInt(e,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(void 0!==t&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}};function Ys(t){const e=t.toString();if(zs.hasOwnProperty(e))return zs[e];{const t=Vs.pattern(e);return zs[e]=t,t}}var Xs="Complement Sets are not supported for first char optimization",qs='Unable to use "first char" lexer optimizations:\n';function Js(t,e=!1){try{const e=Ys(t);return Zs(e.value,{},e.flags.ignoreCase)}catch(n){if(n.message===Xs)e&&us(`${qs}\tUnable to optimize: < ${t.toString()} >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),cs(`${qs}\n\tFailed parsing: < ${t.toString()} >\n\tUsing the @chevrotain/regexp-to-ast library\n\tPlease open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Zs(t,e,n){switch(t.type){case"Disjunction":for(let r=0;r<t.value.length;r++)Zs(t.value[r],e,n);break;case"Alternative":const r=t.value;for(let t=0;t<r.length;t++){const i=r[t];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const s=i;switch(s.type){case"Character":Qs(s.value,e,n);break;case"Set":if(!0===s.complement)throw Error(Xs);vi(s.value,(t=>{if("number"==typeof t)Qs(t,e,n);else{const r=t;if(!0===n)for(let t=r.from;t<=r.to;t++)Qs(t,e,n);else{for(let t=r.from;t<=r.to&&t<Ao;t++)Qs(t,e,n);if(r.to>=Ao){const t=r.from>=Ao?r.from:Ao,n=r.to,i=Io(t),s=Io(n);for(let t=i;t<=s;t++)e[t]=t}}}}));break;case"Group":Zs(s.value,e,n);break;default:throw Error("Non Exhaustive Match")}const o=void 0!==s.quantifier&&0===s.quantifier.atLeast;if("Group"===s.type&&!1===eo(s)||"Group"!==s.type&&!1===o)break}break;default:throw Error("non exhaustive match!")}return ji(e)}function Qs(t,e,n){const r=Io(t);e[r]=r,!0===n&&function(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const t=Io(r.charCodeAt(0));e[t]=t}else{const t=n.toLowerCase();if(t!==n){const n=Io(t.charCodeAt(0));e[n]=n}}}(t,e)}function to(t,e){return _i(t.value,(t=>{if("number"==typeof t)return Gi(e,t);{const n=t;return void 0!==_i(e,(t=>n.from<=t&&t<=n.to))}}))}function eo(t){const e=t.quantifier;return!(!e||0!==e.atLeast)||!!t.value&&(O(t.value)?Ai(t.value,eo):eo(t.value))}var no=class extends Hs{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(!0!==this.found){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}super.visitChildren(t)}}visitCharacter(t){Gi(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?void 0===to(t,this.targetCharCodes)&&(this.found=!0):void 0!==to(t,this.targetCharCodes)&&(this.found=!0)}};function ro(t,e){if(e instanceof RegExp){const n=Ys(e),r=new no(t);return r.visit(n),r.found}return void 0!==_i(e,(e=>Gi(t,e.charCodeAt(0))))}var io="PATTERN",so="defaultMode",oo="modes",ao="boolean"==typeof new RegExp("(?:)").sticky;function co(t,e){const n=(e=li(e,{useSticky:ao,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:(t,e)=>e()})).tracer;let r;n("initCharCodeToOptimizedIndexMap",(()=>{!function(){if(Hi(Oo)){Oo=new Array(65536);for(let t=0;t<65536;t++)Oo[t]=t>255?255+~~(t/255):t}}()})),n("Reject Lexer.NA",(()=>{r=ns(t,(t=>t[io]===Fo.NA))}));let i,s,o,a,c,u,l,h,p,d,f,E=!1;n("Transform Patterns",(()=>{E=!1,i=xi(r,(t=>{const n=t[io];if(Yi(n)){const t=n.source;return 1!==t.length||"^"===t||"$"===t||"."===t||n.ignoreCase?2!==t.length||"\\"!==t[0]||Gi(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],t[1])?e.useSticky?fo(n):po(n):t[1]:t}if(B(n))return E=!0,{exec:n};if("object"==typeof n)return E=!0,n;if("string"==typeof n){if(1===n.length)return n;{const t=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),r=new RegExp(t);return e.useSticky?fo(r):po(r)}}throw Error("non exhaustive match")}))})),n("misc mapping",(()=>{s=xi(r,(t=>t.tokenTypeIdx)),o=xi(r,(t=>{const e=t.GROUP;if(e!==Fo.SKIPPED){if(Di(e))return e;if(Xi(e))return!1;throw Error("non exhaustive match")}})),a=xi(r,(t=>{const e=t.LONGER_ALT;if(e){return O(e)?xi(e,(t=>Wi(r,t))):[Wi(r,e)]}})),c=xi(r,(t=>t.PUSH_MODE)),u=xi(r,(t=>Ui(t,"POP_MODE")))})),n("Line Terminator Handling",(()=>{const t=yo(e.lineTerminatorCharacters);l=xi(r,(t=>!1)),"onlyOffset"!==e.positionTracking&&(l=xi(r,(e=>Ui(e,"LINE_BREAKS")?!!e.LINE_BREAKS:!1===vo(e,t)&&ro(t,e.PATTERN))))})),n("Misc Mapping #2",(()=>{h=xi(r,mo),p=xi(i,go),d=es(r,((t,e)=>{const n=e.GROUP;return Di(n)&&n!==Fo.SKIPPED&&(t[n]=[]),t}),{}),f=xi(i,((t,e)=>({pattern:i[e],longerAlt:a[e],canLineTerminator:l[e],isCustom:h[e],short:p[e],group:o[e],push:c[e],pop:u[e],tokenTypeIdx:s[e],tokenType:r[e]})))}));let m=!0,g=[];return e.safeMode||n("First Char Optimization",(()=>{g=es(r,((t,n,r)=>{if("string"==typeof n.PATTERN){const e=Io(n.PATTERN.charCodeAt(0));Ro(t,e,f[r])}else if(O(n.START_CHARS_HINT)){let e;vi(n.START_CHARS_HINT,(n=>{const i=Io("string"==typeof n?n.charCodeAt(0):n);e!==i&&(e=i,Ro(t,i,f[r]))}))}else if(Yi(n.PATTERN))if(n.PATTERN.unicode)m=!1,e.ensureOptimizations&&cs(`${qs}\tUnable to analyze < ${n.PATTERN.toString()} > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const i=Js(n.PATTERN,e.ensureOptimizations);Hi(i)&&(m=!1),vi(i,(e=>{Ro(t,e,f[r])}))}else e.ensureOptimizations&&cs(`${qs}\tTokenType: <${n.name}> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),m=!1;return t}),[])})),{emptyGroups:d,patternIdxToConfig:f,charCodeToPatternIdxToConfig:g,hasCustom:E,canBeOptimized:m}}function uo(t,e){let n=[];const r=function(t){const e=Ii(t,(t=>!Ui(t,io))),n=xi(e,(t=>({message:"Token Type: ->"+t.name+"<- missing static 'PATTERN' property",type:wo.MISSING_PATTERN,tokenTypes:[t]}))),r=fi(t,e);return{errors:n,valid:r}}(t);n=n.concat(r.errors);const i=function(t){const e=Ii(t,(t=>{const e=t[io];return!(Yi(e)||B(e)||Ui(e,"exec")||Di(e))})),n=xi(e,(t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:wo.INVALID_PATTERN,tokenTypes:[t]}))),r=fi(t,e);return{errors:n,valid:r}}(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(function(t){let e=[];const n=Ii(t,(t=>Yi(t[io])));return e=e.concat(function(t){class e extends Hs{constructor(){super(...arguments),this.found=!1}visitEndAnchor(t){this.found=!0}}const n=Ii(t,(t=>{const n=t.PATTERN;try{const t=Ys(n),r=new e;return r.visit(t),r.found}catch(t){return lo.test(n.source)}})),r=xi(n,(t=>({message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+t.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:wo.EOI_ANCHOR_FOUND,tokenTypes:[t]})));return r}(n)),e=e.concat(function(t){class e extends Hs{constructor(){super(...arguments),this.found=!1}visitStartAnchor(t){this.found=!0}}const n=Ii(t,(t=>{const n=t.PATTERN;try{const t=Ys(n),r=new e;return r.visit(t),r.found}catch(t){return ho.test(n.source)}})),r=xi(n,(t=>({message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+t.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:wo.SOI_ANCHOR_FOUND,tokenTypes:[t]})));return r}(n)),e=e.concat(function(t){const e=Ii(t,(t=>{const e=t[io];return e instanceof RegExp&&(e.multiline||e.global)})),n=xi(e,(t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:wo.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[t]})));return n}(n)),e=e.concat(function(t){const e=[];let n=xi(t,(n=>es(t,((t,r)=>(n.PATTERN.source!==r.PATTERN.source||Gi(e,r)||r.PATTERN===Fo.NA||(e.push(r),t.push(r)),t)),[])));n=Or(n);const r=Ii(n,(t=>t.length>1)),i=xi(r,(t=>{const e=xi(t,(t=>t.name));return{message:`The same RegExp pattern ->${Li(t).PATTERN}<-has been used in all of the following Token Types: ${e.join(", ")} <-`,type:wo.DUPLICATE_PATTERNS_FOUND,tokenTypes:t}}));return i}(n)),e=e.concat(function(t){const e=Ii(t,(t=>t.PATTERN.test(""))),n=xi(e,(t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' must not match an empty string",type:wo.EMPTY_MATCH_PATTERN,tokenTypes:[t]})));return n}(n)),e}(s)),n=n.concat(function(t){const e=Ii(t,(t=>{if(!Ui(t,"GROUP"))return!1;const e=t.GROUP;return e!==Fo.SKIPPED&&e!==Fo.NA&&!Di(e)})),n=xi(e,(t=>({message:"Token Type: ->"+t.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:wo.INVALID_GROUP_TYPE_FOUND,tokenTypes:[t]})));return n}(s)),n=n.concat(function(t,e){const n=Ii(t,(t=>void 0!==t.PUSH_MODE&&!Gi(e,t.PUSH_MODE))),r=xi(n,(t=>({message:`Token Type: ->${t.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${t.PUSH_MODE}<-which does not exist`,type:wo.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[t]})));return r}(s,e)),n=n.concat(function(t){const e=[],n=es(t,((t,e,n)=>{const r=e.PATTERN;return r===Fo.NA||(Di(r)?t.push({str:r,idx:n,tokenType:e}):Yi(r)&&(i=r,void 0===_i([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(t=>-1!==i.source.indexOf(t))))&&t.push({str:r.source,idx:n,tokenType:e})),t;var i}),[]);return vi(t,((t,r)=>{vi(n,(({str:n,idx:i,tokenType:s})=>{if(r<i&&function(t,e){if(Yi(e)){const n=e.exec(t);return null!==n&&0===n.index}if(B(e))return e(t,0,[],{});if(Ui(e,"exec"))return e.exec(t,0,[],{});if("string"==typeof e)return e===t;throw Error("non exhaustive match")}(n,t.PATTERN)){const n=`Token: ->${s.name}<- can never be matched.\nBecause it appears AFTER the Token Type ->${t.name}<-in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:n,type:wo.UNREACHABLE_PATTERN,tokenTypes:[t,s]})}}))})),e}(s)),n}var lo=/[^\\][$]/;var ho=/[^\\[][\^]|^\^/;function po(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function fo(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Eo(t,e,n){const r=[];let i=!1;const s=Or(cn(ji(t.modes))),o=ns(s,(t=>t[io]===Fo.NA)),a=yo(n);return e&&vi(o,(t=>{const e=vo(t,a);if(!1!==e){const n=function(t,e){if(e.issue===wo.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <${t.name}> Token Type\n\t Root cause: ${e.errMsg}.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===wo.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <${t.name}> Token Type\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}(t,e),i={message:n,type:e.issue,tokenType:t};r.push(i)}else Ui(t,"LINE_BREAKS")?!0===t.LINE_BREAKS&&(i=!0):ro(a,t.PATTERN)&&(i=!0)})),e&&!i&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:wo.NO_LINE_BREAKS_FLAGS}),r}function mo(t){const e=t.PATTERN;if(Yi(e))return!1;if(B(e))return!0;if(Ui(e,"exec"))return!0;if(Di(e))return!1;throw Error("non exhaustive match")}function go(t){return!(!Di(t)||1!==t.length)&&t.charCodeAt(0)}var To={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const e=t.charCodeAt(n);if(10===e)return this.lastIndex=n+1,!0;if(13===e)return 10===t.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function vo(t,e){if(Ui(t,"LINE_BREAKS"))return!1;if(Yi(t.PATTERN)){try{ro(e,t.PATTERN)}catch(t){return{issue:wo.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}if(Di(t.PATTERN))return!1;if(mo(t))return{issue:wo.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function yo(t){return xi(t,(t=>Di(t)?t.charCodeAt(0):t))}function Ro(t,e,n){void 0===t[e]?t[e]=[n]:t[e].push(n)}var Ao=256,Oo=[];function Io(t){return t<Ao?t:Oo[t]}function No(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx||!0===e.isParent&&!0===e.categoryMatchesMap[n]}function So(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}var _o=1,Lo={};function Co(t){const e=function(t){let e=Ar(t),n=t,r=!0;for(;r;){n=Or(cn(xi(n,(t=>t.CATEGORIES))));const t=fi(n,e);e=e.concat(t),Hi(t)?r=!1:n=t}return e}(t);!function(t){vi(t,(t=>{ko(t)||(Lo[_o]=t,t.tokenTypeIdx=_o++),bo(t)&&!O(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),bo(t)||(t.CATEGORIES=[]),Ui(t,"categoryMatches")||(t.categoryMatches=[]),function(t){return Ui(t,"categoryMatchesMap")}(t)||(t.categoryMatchesMap={})}))}(e),function(t){vi(t,(t=>{xo([],t)}))}(e),function(t){vi(t,(t=>{t.categoryMatches=[],vi(t.categoryMatchesMap,((e,n)=>{t.categoryMatches.push(Lo[n].tokenTypeIdx)}))}))}(e),vi(e,(t=>{t.isParent=t.categoryMatches.length>0}))}function xo(t,e){vi(t,(t=>{e.categoryMatchesMap[t.tokenTypeIdx]=!0})),vi(e.CATEGORIES,(n=>{const r=t.concat(e);Gi(r,n)||xo(r,n)}))}function ko(t){return Ui(t,"tokenTypeIdx")}function bo(t){return Ui(t,"CATEGORIES")}function Po(t){return Ui(t,"tokenTypeIdx")}var wo,Mo,Uo={buildUnableToPopLexerModeMessage:t=>`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`,buildUnexpectedCharactersMessage:(t,e,n,r,i)=>`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`};(Mo=wo||(wo={}))[Mo.MISSING_PATTERN=0]="MISSING_PATTERN",Mo[Mo.INVALID_PATTERN=1]="INVALID_PATTERN",Mo[Mo.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",Mo[Mo.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",Mo[Mo.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",Mo[Mo.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",Mo[Mo.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",Mo[Mo.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",Mo[Mo.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",Mo[Mo.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",Mo[Mo.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",Mo[Mo.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",Mo[Mo.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",Mo[Mo.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",Mo[Mo.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",Mo[Mo.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",Mo[Mo.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",Mo[Mo.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE";var Do={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:Uo,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Do);var Fo=class{constructor(t,e=Do){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(t,e)=>{if(!0===this.traceInitPerf){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--\x3e <${t}>`);const{time:r,value:i}=ls(e),s=r>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(`${n}<-- <${t}> time: ${r}ms`),this.traceInitIndent--,i}return e()},"boolean"==typeof e)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=le({},Do,e);const n=this.config.traceInitPerf;!0===n?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof n&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",(()=>{let n,r=!0;this.TRACE_INIT("Lexer Config handling",(()=>{if(this.config.lineTerminatorsPattern===Do.lineTerminatorsPattern)this.config.lineTerminatorsPattern=To;else if(this.config.lineTerminatorCharacters===Do.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(e.safeMode&&e.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),O(t)?n={modes:{defaultMode:Ar(t)},defaultMode:so}:(r=!1,n=Ar(t))})),!1===this.config.skipValidations&&(this.TRACE_INIT("performRuntimeChecks",(()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(t,e,n){const r=[];return Ui(t,so)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+so+"> property in its definition\n",type:wo.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ui(t,oo)||r.push({message:"A MultiMode Lexer cannot be initialized without a <modes> property in its definition\n",type:wo.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ui(t,oo)&&Ui(t,so)&&!Ui(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${so}: <${t.defaultMode}>which does not exist\n`,type:wo.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ui(t,oo)&&vi(t.modes,((t,e)=>{vi(t,((n,i)=>{if(Xi(n))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${e}> at index: <${i}>\n`,type:wo.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ui(n,"LONGER_ALT")){const i=O(n.LONGER_ALT)?n.LONGER_ALT:[n.LONGER_ALT];vi(i,(i=>{Xi(i)||Gi(t,i)||r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${i.name}> on token <${n.name}> outside of mode <${e}>\n`,type:wo.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})}))}}))})),r}(n,this.trackStartLines,this.config.lineTerminatorCharacters))})),this.TRACE_INIT("performWarningRuntimeChecks",(()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Eo(n,this.trackStartLines,this.config.lineTerminatorCharacters))}))),n.modes=n.modes?n.modes:{},vi(n.modes,((t,e)=>{n.modes[e]=ns(t,(t=>Xi(t)))}));const i=ce(n.modes);if(vi(n.modes,((t,n)=>{this.TRACE_INIT(`Mode: <${n}> processing`,(()=>{if(this.modes.push(n),!1===this.config.skipValidations&&this.TRACE_INIT("validatePatterns",(()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(uo(t,i))})),Hi(this.lexerDefinitionErrors)){let r;Co(t),this.TRACE_INIT("analyzeTokenTypes",(()=>{r=co(t,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:e.positionTracking,ensureOptimizations:e.ensureOptimizations,safeMode:e.safeMode,tracer:this.TRACE_INIT})})),this.patternIdxToConfig[n]=r.patternIdxToConfig,this.charCodeToPatternIdxToConfig[n]=r.charCodeToPatternIdxToConfig,this.emptyGroups=le({},this.emptyGroups,r.emptyGroups),this.hasCustom=r.hasCustom||this.hasCustom,this.canModeBeOptimized[n]=r.canBeOptimized}}))})),this.defaultMode=n.defaultMode,!Hi(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const t=xi(this.lexerDefinitionErrors,(t=>t.message)).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+t)}vi(this.lexerDefinitionWarning,(t=>{us(t.message)})),this.TRACE_INIT("Choosing sub-methods implementations",(()=>{if(ao?(this.chopInput=$,this.match=this.matchWithTest):(this.updateLastIndex=at,this.match=this.matchWithExec),r&&(this.handleModes=at),!1===this.trackStartLines&&(this.computeNewColumn=$),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=at),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)})),this.TRACE_INIT("Failed Optimization Warnings",(()=>{const t=es(this.canModeBeOptimized,((t,e,n)=>(!1===e&&t.push(n),t)),[]);if(e.ensureOptimizations&&!Hi(t))throw Error(`Lexer Modes: < ${t.join(", ")} > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.`)})),this.TRACE_INIT("clearRegExpParserCache",(()=>{zs={}})),this.TRACE_INIT("toFastProperties",(()=>{hs(this)}))}))}tokenize(t,e=this.defaultMode){if(!Hi(this.lexerDefinitionErrors)){const t=xi(this.lexerDefinitionErrors,(t=>t.message)).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+t)}return this.tokenizeInternal(t,e)}tokenizeInternal(t,e){let n,r,i,s,o,a,c,u,l,h,p,d,f,E,m;const g=t,T=g.length;let v=0,y=0;const R=this.hasCustom?0:Math.floor(t.length/10),A=new Array(R),I=[];let N=this.trackStartLines?1:void 0,S=this.trackStartLines?1:void 0;const _=function(t){const e={},n=ce(t);return vi(n,(n=>{const r=t[n];if(!O(r))throw Error("non exhaustive match");e[n]=[]})),e}(this.emptyGroups),L=this.trackStartLines,C=this.config.lineTerminatorsPattern;let x=0,k=[],b=[];const P=[],w=[];let M;function U(){return k}function D(t){const e=Io(t),n=b[e];return void 0===n?w:n}Object.freeze(w);const F=t=>{if(1===P.length&&void 0===t.tokenType.PUSH_MODE){const e=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(t);I.push({offset:t.startOffset,line:t.startLine,column:t.startColumn,length:t.image.length,message:e})}else{P.pop();const t=Ei(P);k=this.patternIdxToConfig[t],b=this.charCodeToPatternIdxToConfig[t],x=k.length;const e=this.canModeBeOptimized[t]&&!1===this.config.safeMode;M=b&&e?D:U}};function j(t){P.push(t),b=this.charCodeToPatternIdxToConfig[t],k=this.patternIdxToConfig[t],x=k.length,x=k.length;const e=this.canModeBeOptimized[t]&&!1===this.config.safeMode;M=b&&e?D:U}let $;j.call(this,e);const G=this.config.recoveryEnabled;for(;v<T;){a=null;const e=g.charCodeAt(v),R=M(e),O=R.length;for(n=0;n<O;n++){$=R[n];const r=$.pattern;c=null;const l=$.short;if(!1!==l?e===l&&(a=r):!0===$.isCustom?(m=r.exec(g,v,A,_),null!==m?(a=m[0],void 0!==m.payload&&(c=m.payload)):a=null):(this.updateLastIndex(r,v),a=this.match(r,t,v)),null!==a){if(o=$.longerAlt,void 0!==o){const e=o.length;for(i=0;i<e;i++){const e=k[o[i]],n=e.pattern;if(u=null,!0===e.isCustom?(m=n.exec(g,v,A,_),null!==m?(s=m[0],void 0!==m.payload&&(u=m.payload)):s=null):(this.updateLastIndex(n,v),s=this.match(n,t,v)),s&&s.length>a.length){a=s,c=u,$=e;break}}}break}}if(null!==a){if(l=a.length,h=$.group,void 0!==h&&(p=$.tokenTypeIdx,d=this.createTokenInstance(a,v,p,$.tokenType,N,S,l),this.handlePayload(d,c),!1===h?y=this.addToken(A,y,d):_[h].push(d)),t=this.chopInput(t,l),v+=l,S=this.computeNewColumn(S,l),!0===L&&!0===$.canLineTerminator){let t,e,n=0;C.lastIndex=0;do{t=C.test(a),!0===t&&(e=C.lastIndex-1,n++)}while(!0===t);0!==n&&(N+=n,S=l-e,this.updateTokenEndLineColumnLocation(d,h,e,n,N,S,l))}this.handleModes($,F,j,d)}else{const e=v,n=N,i=S;let s=!1===G;for(;!1===s&&v<T;)for(t=this.chopInput(t,1),v++,r=0;r<x;r++){const e=k[r],n=e.pattern,i=e.short;if(!1!==i?g.charCodeAt(v)===i&&(s=!0):!0===e.isCustom?s=null!==n.exec(g,v,A,_):(this.updateLastIndex(n,v),s=null!==n.exec(t)),!0===s)break}if(f=v-e,S=this.computeNewColumn(S,f),E=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(g,e,f,n,i),I.push({offset:e,line:n,column:i,length:f,message:E}),!1===G)break}}return this.hasCustom||(A.length=y),{tokens:A,groups:_,errors:I}}handleModes(t,e,n,r){if(!0===t.pop){const i=t.push;e(r),void 0!==i&&n.call(this,i)}else void 0!==t.push&&n.call(this,t.push)}chopInput(t,e){return t.substring(e)}updateLastIndex(t,e){t.lastIndex=e}updateTokenEndLineColumnLocation(t,e,n,r,i,s,o){let a,c;void 0!==e&&(a=n===o-1,c=a?-1:0,1===r&&!0===a||(t.endLine=i+c,t.endColumn=s-1-c))}computeNewColumn(t,e){return t+e}createOffsetOnlyToken(t,e,n,r){return{image:t,startOffset:e,tokenTypeIdx:n,tokenType:r}}createStartOnlyToken(t,e,n,r,i,s){return{image:t,startOffset:e,startLine:i,startColumn:s,tokenTypeIdx:n,tokenType:r}}createFullToken(t,e,n,r,i,s,o){return{image:t,startOffset:e,endOffset:e+o-1,startLine:i,endLine:i,startColumn:s,endColumn:s+o-1,tokenTypeIdx:n,tokenType:r}}addTokenUsingPush(t,e,n){return t.push(n),e}addTokenUsingMemberAccess(t,e,n){return t[e]=n,++e}handlePayloadNoCustom(t,e){}handlePayloadWithCustom(t,e){null!==e&&(t.payload=e)}matchWithTest(t,e,n){return!0===t.test(e)?e.substring(n,t.lastIndex):null}matchWithExec(t,e){const n=t.exec(e);return null!==n?n[0]:null}};function jo(t){return $o(t)?t.LABEL:t.name}function $o(t){return Di(t.LABEL)&&""!==t.LABEL}Fo.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",Fo.NA=/NOT_APPLICABLE/;var Go="parent",Bo="categories",Wo="label",Ko="group",Ho="push_mode",zo="pop_mode",Vo="longer_alt",Yo="line_breaks",Xo="start_chars_hint";function qo(t){return function(t){const e=t.pattern,n={};n.name=t.name,Xi(e)||(n.PATTERN=e);if(Ui(t,Go))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";Ui(t,Bo)&&(n.CATEGORIES=t[Bo]);Co([n]),Ui(t,Wo)&&(n.LABEL=t[Wo]);Ui(t,Ko)&&(n.GROUP=t[Ko]);Ui(t,zo)&&(n.POP_MODE=t[zo]);Ui(t,Ho)&&(n.PUSH_MODE=t[Ho]);Ui(t,Vo)&&(n.LONGER_ALT=t[Vo]);Ui(t,Yo)&&(n.LINE_BREAKS=t[Yo]);Ui(t,Xo)&&(n.START_CHARS_HINT=t[Xo]);return n}(t)}var Jo=qo({name:"EOF",pattern:Fo.NA});function Zo(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}Co([Jo]);var Qo={buildMismatchTokenMessage:({expected:t,actual:e,previous:n,ruleName:r})=>`Expecting ${$o(t)?`--\x3e ${jo(t)} <--`:`token of type --\x3e ${t.name} <--`} but found --\x3e '${e.image}' <--`,buildNotAllInputParsedMessage:({firstRedundant:t,ruleName:e})=>"Redundant input, expecting EOF but found: "+t.image,buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",o="\nbut found: '"+Li(e).image+"'";if(r)return s+r+o;{const e=es(t,((t,e)=>t.concat(e)),[]),n=xi(e,(t=>`[${xi(t,(t=>jo(t))).join(", ")}]`));return s+`one of these possible Token sequences:\n${xi(n,((t,e)=>`  ${e+1}. ${t}`)).join("\n")}`+o}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",s="\nbut found: '"+Li(e).image+"'";if(n)return i+n+s;return i+`expecting at least one iteration which starts with one of these possible Token sequences::\n  <${xi(t,(t=>`[${xi(t,(t=>jo(t))).join(",")}]`)).join(" ,")}>`+s}};Object.freeze(Qo);var ta={buildRuleNotFoundError:(t,e)=>"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+"<-\ninside top level rule: ->"+t.name+"<-"},ea={buildDuplicateFoundError(t,e){const n=t.name,r=Li(e),i=r.idx,s=_s(r),o=(a=r)instanceof Os?a.terminalType.name:a instanceof fs?a.nonTerminalName:"";var a;let c=`->${s}${i>0?i:""}<- ${o?`with argument: ->${o}<-`:""}\n                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  \n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  `;return c=c.replace(/[ \t]+/g," "),c=c.replace(/\s\s+/g,"\n"),c},buildNamespaceConflictError:t=>`Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter.`,buildAlternationPrefixAmbiguityError(t){const e=xi(t.prefixPath,(t=>jo(t))).join(", "),n=0===t.alternation.idx?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix\nin <OR${n}> inside <${t.topLevelRule.name}> Rule,\n<${e}> may appears as a prefix path in all these alternatives.\nSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details.`},buildAlternationAmbiguityError(t){const e=xi(t.prefixPath,(t=>jo(t))).join(", "),n=0===t.alternation.idx?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,\n<${e}> may appears as a prefix path in all these alternatives.\n`;return r+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details.",r},buildEmptyRepetitionError(t){let e=_s(t.repetition);0!==t.repetition.idx&&(e+=t.repetition.idx);return`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.\nThis could lead to an infinite loop.`},buildTokenNameError:t=>"deprecated",buildEmptyAlternationError:t=>`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.\nOnly the last alternative may be an empty alternative.`,buildTooManyAlternativesError:t=>`An Alternation cannot have more than 256 alternatives:\n<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.\n has ${t.alternation.definition.length+1} alternatives.`,buildLeftRecursionError(t){const e=t.topLevelRule.name;return`Left Recursion found in grammar.\nrule: <${e}> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n ${`${e} --\x3e ${xi(t.leftRecursionPath,(t=>t.name)).concat([e]).join(" --\x3e ")}`}\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError:t=>"deprecated",buildDuplicateRuleNameError(t){let e;e=t.topLevelRule instanceof Es?t.topLevelRule.name:t.topLevelRule;return`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};var na,ra,ia=class extends Ns{constructor(t,e){super(),this.nameToTopRule=t,this.errMsgProvider=e,this.errors=[]}resolveRefs(){vi(ji(this.nameToTopRule),(t=>{this.currTopLevel=t,t.accept(this)}))}visitNonTerminal(t){const e=this.nameToTopRule[t.nonTerminalName];if(e)t.referencedRule=e;else{const e=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:e,type:Oc.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}},sa=class extends Ls{constructor(t,e){super(),this.topProd=t,this.path=e,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ar(this.path.ruleStack).reverse(),this.occurrenceStack=Ar(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,e=[]){this.found||super.walk(t,e)}walkProdRef(t,e,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const r=e.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,r)}}updateExpectedNext(){Hi(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}},oa=class extends sa{constructor(t,e){super(t,e),this.path=e,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,e,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const t=e.concat(n),r=new ms({definition:t});this.possibleTokTypes=xs(r),this.found=!0}}},aa=class extends Ls{constructor(t,e){super(),this.topRule=t,this.occurrence=e,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}},ca=class extends aa{walkMany(t,e,n){if(t.idx===this.occurrence){const t=Li(e.concat(n));this.result.isEndOfRule=void 0===t,t instanceof Os&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkMany(t,e,n)}},ua=class extends aa{walkManySep(t,e,n){if(t.idx===this.occurrence){const t=Li(e.concat(n));this.result.isEndOfRule=void 0===t,t instanceof Os&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkManySep(t,e,n)}},la=class extends aa{walkAtLeastOne(t,e,n){if(t.idx===this.occurrence){const t=Li(e.concat(n));this.result.isEndOfRule=void 0===t,t instanceof Os&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkAtLeastOne(t,e,n)}},ha=class extends aa{walkAtLeastOneSep(t,e,n){if(t.idx===this.occurrence){const t=Li(e.concat(n));this.result.isEndOfRule=void 0===t,t instanceof Os&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkAtLeastOneSep(t,e,n)}};function pa(t,e,n=[]){n=Ar(n);let r=[],i=0;function s(s){const o=pa(s.concat(mi(t,i+1)),e,n);return r.concat(o)}for(;n.length<e&&i<t.length;){const e=t[i];if(e instanceof ms)return s(e.definition);if(e instanceof fs)return s(e.definition);if(e instanceof gs)r=s(e.definition);else{if(e instanceof Ts){return s(e.definition.concat([new ys({definition:e.definition})]))}if(e instanceof vs){return s([new ms({definition:e.definition}),new ys({definition:[new Os({terminalType:e.separator})].concat(e.definition)})])}if(e instanceof Rs){const t=e.definition.concat([new ys({definition:[new Os({terminalType:e.separator})].concat(e.definition)})]);r=s(t)}else if(e instanceof ys){const t=e.definition.concat([new ys({definition:e.definition})]);r=s(t)}else{if(e instanceof As)return vi(e.definition,(t=>{!1===Hi(t.definition)&&(r=s(t.definition))})),r;if(!(e instanceof Os))throw Error("non exhaustive match");n.push(e.terminalType)}}i++}return r.push({partialPath:n,suffixDef:mi(t,i)}),r}function da(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Hi(h);){const t=h.pop();if(t===o){a&&Ei(h).idx<=u&&h.pop();continue}const r=t.def,p=t.idx,d=t.ruleStack,f=t.occurrenceStack;if(Hi(r))continue;const E=r[0];if(E===i){const t={idx:p,def:mi(r),ruleStack:gi(d),occurrenceStack:gi(f)};h.push(t)}else if(E instanceof Os)if(p<c-1){const t=p+1;if(n(e[t],E.terminalType)){const e={idx:t,def:mi(r),ruleStack:d,occurrenceStack:f};h.push(e)}}else{if(p!==c-1)throw Error("non exhaustive match");l.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:d,occurrenceStack:f}),a=!0}else if(E instanceof fs){const t=Ar(d);t.push(E.nonTerminalName);const e=Ar(f);e.push(E.idx);const n={idx:p,def:E.definition.concat(s,mi(r)),ruleStack:t,occurrenceStack:e};h.push(n)}else if(E instanceof gs){const t={idx:p,def:mi(r),ruleStack:d,occurrenceStack:f};h.push(t),h.push(o);const e={idx:p,def:E.definition.concat(mi(r)),ruleStack:d,occurrenceStack:f};h.push(e)}else if(E instanceof Ts){const t=new ys({definition:E.definition,idx:E.idx}),e={idx:p,def:E.definition.concat([t],mi(r)),ruleStack:d,occurrenceStack:f};h.push(e)}else if(E instanceof vs){const t=new Os({terminalType:E.separator}),e=new ys({definition:[t].concat(E.definition),idx:E.idx}),n={idx:p,def:E.definition.concat([e],mi(r)),ruleStack:d,occurrenceStack:f};h.push(n)}else if(E instanceof Rs){const t={idx:p,def:mi(r),ruleStack:d,occurrenceStack:f};h.push(t),h.push(o);const e=new Os({terminalType:E.separator}),n=new ys({definition:[e].concat(E.definition),idx:E.idx}),i={idx:p,def:E.definition.concat([n],mi(r)),ruleStack:d,occurrenceStack:f};h.push(i)}else if(E instanceof ys){const t={idx:p,def:mi(r),ruleStack:d,occurrenceStack:f};h.push(t),h.push(o);const e=new ys({definition:E.definition,idx:E.idx}),n={idx:p,def:E.definition.concat([e],mi(r)),ruleStack:d,occurrenceStack:f};h.push(n)}else if(E instanceof As)for(let t=E.definition.length-1;t>=0;t--){const e={idx:p,def:E.definition[t].definition.concat(mi(r)),ruleStack:d,occurrenceStack:f};h.push(e),h.push(o)}else if(E instanceof ms)h.push({idx:p,def:E.definition.concat(mi(r)),ruleStack:d,occurrenceStack:f});else{if(!(E instanceof Es))throw Error("non exhaustive match");h.push(fa(E,p,d,f))}}return l}function fa(t,e,n,r){const i=Ar(n);i.push(t.name);const s=Ar(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}function Ea(t){if(t instanceof gs||"Option"===t)return na.OPTION;if(t instanceof ys||"Repetition"===t)return na.REPETITION;if(t instanceof Ts||"RepetitionMandatory"===t)return na.REPETITION_MANDATORY;if(t instanceof vs||"RepetitionMandatoryWithSeparator"===t)return na.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Rs||"RepetitionWithSeparator"===t)return na.REPETITION_WITH_SEPARATOR;if(t instanceof As||"Alternation"===t)return na.ALTERNATION;throw Error("non exhaustive match")}function ma(t,e,n,r){const i=t.length,s=Ai(t,(t=>Ai(t,(t=>1===t.length))));if(e)return function(e){const r=xi(e,(t=>t.GATE));for(let e=0;e<i;e++){const i=t[e],s=i.length,o=r[e];if(void 0===o||!1!==o.call(this))t:for(let t=0;t<s;t++){const r=i[t],s=r.length;for(let t=0;t<s;t++){const e=this.LA(t+1);if(!1===n(e,r[t]))continue t}return e}}};if(s&&!r){const e=xi(t,(t=>cn(t))),n=es(e,((t,e,n)=>(vi(e,(e=>{Ui(t,e.tokenTypeIdx)||(t[e.tokenTypeIdx]=n),vi(e.categoryMatches,(e=>{Ui(t,e)||(t[e]=n)}))})),t)),{});return function(){const t=this.LA(1);return n[t.tokenTypeIdx]}}return function(){for(let e=0;e<i;e++){const r=t[e],i=r.length;t:for(let t=0;t<i;t++){const i=r[t],s=i.length;for(let t=0;t<s;t++){const e=this.LA(t+1);if(!1===n(e,i[t]))continue t}return e}}}}function ga(t,e,n){const r=Ai(t,(t=>1===t.length)),i=t.length;if(r&&!n){const e=cn(t);if(1===e.length&&Hi(e[0].categoryMatches)){const t=e[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===t}}{const t=es(e,((t,e,n)=>(t[e.tokenTypeIdx]=!0,vi(e.categoryMatches,(e=>{t[e]=!0})),t)),[]);return function(){const e=this.LA(1);return!0===t[e.tokenTypeIdx]}}}return function(){t:for(let n=0;n<i;n++){const r=t[n],i=r.length;for(let t=0;t<i;t++){const n=this.LA(t+1);if(!1===e(n,r[t]))continue t}return!0}return!1}}(ra=na||(na={}))[ra.OPTION=0]="OPTION",ra[ra.REPETITION=1]="REPETITION",ra[ra.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",ra[ra.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",ra[ra.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",ra[ra.ALTERNATION=5]="ALTERNATION";var Ta=class extends Ls{constructor(t,e,n){super(),this.topProd=t,this.targetOccurrence=e,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,e,n,r){return t.idx===this.targetOccurrence&&this.targetProdType===e&&(this.restDef=n.concat(r),!0)}walkOption(t,e,n){this.checkIsTarget(t,na.OPTION,e,n)||super.walkOption(t,e,n)}walkAtLeastOne(t,e,n){this.checkIsTarget(t,na.REPETITION_MANDATORY,e,n)||super.walkOption(t,e,n)}walkAtLeastOneSep(t,e,n){this.checkIsTarget(t,na.REPETITION_MANDATORY_WITH_SEPARATOR,e,n)||super.walkOption(t,e,n)}walkMany(t,e,n){this.checkIsTarget(t,na.REPETITION,e,n)||super.walkOption(t,e,n)}walkManySep(t,e,n){this.checkIsTarget(t,na.REPETITION_WITH_SEPARATOR,e,n)||super.walkOption(t,e,n)}},va=class extends Ns{constructor(t,e,n){super(),this.targetOccurrence=t,this.targetProdType=e,this.targetRef=n,this.result=[]}checkIsTarget(t,e){t.idx!==this.targetOccurrence||this.targetProdType!==e||void 0!==this.targetRef&&t!==this.targetRef||(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,na.OPTION)}visitRepetition(t){this.checkIsTarget(t,na.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,na.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,na.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,na.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,na.ALTERNATION)}};function ya(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Ra(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let t=0;t<e.length;t++){const n=e[t];i.push(n+"_"+r.tokenTypeIdx);for(let t=0;t<r.categoryMatches.length;t++){const e="_"+r.categoryMatches[t];i.push(n+e)}}e=i}return e}function Aa(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let t=0;t<e.length;t++){if(!0===i[e[t]])return!1}}return!0}function Oa(t,e){const n=xi(t,(t=>pa([t],1))),r=ya(n.length),i=xi(n,(t=>{const e={};return vi(t,(t=>{const n=Ra(t.partialPath);vi(n,(t=>{e[t]=!0}))})),e}));let s=n;for(let t=1;t<=e;t++){const n=s;s=ya(n.length);for(let o=0;o<n.length;o++){const a=n[o];for(let n=0;n<a.length;n++){const c=a[n].partialPath,u=a[n].suffixDef,l=Ra(c);if(Aa(i,l,o)||Hi(u)||c.length===e){const t=r[o];if(!1===Sa(t,c)){t.push(c);for(let t=0;t<l.length;t++){const e=l[t];i[o][e]=!0}}}else{const e=pa(u,t+1,c);s[o]=s[o].concat(e),vi(e,(t=>{const e=Ra(t.partialPath);vi(e,(t=>{i[o][t]=!0}))}))}}}}return r}function Ia(t,e,n,r){const i=new va(t,na.ALTERNATION,r);return e.accept(i),Oa(i.result,n)}function Na(t,e,n,r){const i=new va(t,n);e.accept(i);const s=i.result,o=new Ta(e,t,n).startWalking();return Oa([new ms({definition:s}),new ms({definition:o})],r)}function Sa(t,e){t:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let t=0;t<r.length;t++){const n=e[t],i=r[t];if(!1===(n===i||void 0!==i.categoryMatchesMap[n.tokenTypeIdx]))continue t}return!0}}return!1}function _a(t){return Ai(t,(t=>Ai(t,(t=>Ai(t,(t=>Hi(t.categoryMatches)))))))}function La(t,e,n,r){const i=ki(t,(t=>function(t,e){const n=new ka;t.accept(n);const r=n.allProductions,i=Pi(r,Ca),s=Qi(i,(t=>t.length>1)),o=xi(ji(s),(n=>{const r=Li(n),i=e.buildDuplicateFoundError(t,n),s=_s(r),o={message:i,type:Oc.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:s,occurrence:r.idx},a=xa(r);return a&&(o.parameter=a),o}));return o}(t,n))),s=function(t,e,n){const r=[],i=xi(e,(t=>t.name));return vi(t,(t=>{const e=t.name;if(Gi(i,e)){const i=n.buildNamespaceConflictError(t);r.push({message:i,type:Oc.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:e})}})),r}(t,e,n),o=ki(t,(t=>function(t,e){const n=new wa;t.accept(n);const r=n.alternations,i=ki(r,(n=>n.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:n}),type:Oc.TOO_MANY_ALTS,ruleName:t.name,occurrence:n.idx}]:[]));return i}(t,n))),a=ki(t,(e=>function(t,e,n,r){const i=[],s=es(e,((e,n)=>n.name===t.name?e+1:e),0);if(s>1){const e=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:e,type:Oc.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}(e,t,r,n)));return i.concat(s,o,a)}function Ca(t){return`${_s(t)}_#_${t.idx}_#_${xa(t)}`}function xa(t){return t instanceof Os?t.terminalType.name:t instanceof fs?t.nonTerminalName:""}var ka=class extends Ns{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}};function ba(t,e,n,r=[]){const i=[],s=Pa(e.definition);if(Hi(s))return[];{const e=t.name;Gi(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Oc.LEFT_RECURSION,ruleName:e});const o=fi(s,r.concat([t])),a=ki(o,(e=>{const i=Ar(r);return i.push(e),ba(t,e,n,i)}));return i.concat(a)}}function Pa(t){let e=[];if(Hi(t))return e;const n=Li(t);if(n instanceof fs)e.push(n.referencedRule);else if(n instanceof ms||n instanceof gs||n instanceof Ts||n instanceof vs||n instanceof Rs||n instanceof ys)e=e.concat(Pa(n.definition));else if(n instanceof As)e=cn(xi(n.definition,(t=>Pa(t.definition))));else if(!(n instanceof Os))throw Error("non exhaustive match");const r=Ss(n),i=t.length>1;if(r&&i){const n=mi(t);return e.concat(Pa(n))}return e}var wa=class extends Ns{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}};function Ma(t,e,n){const r=new wa;t.accept(r);let i=r.alternations;i=ns(i,(t=>!0===t.ignoreAmbiguities));const s=ki(i,(r=>{const i=r.idx,s=r.maxLookahead||e,o=Ia(i,t,s,r),a=function(t,e,n,r){const i=[],s=es(t,((n,r,s)=>(!0===e.definition[s].ignoreAmbiguities||vi(r,(r=>{const o=[s];vi(t,((t,n)=>{s!==n&&Sa(t,r)&&!0!==e.definition[n].ignoreAmbiguities&&o.push(n)})),o.length>1&&!Sa(i,r)&&(i.push(r),n.push({alts:o,path:r}))})),n)),[]),o=xi(s,(t=>{const i=xi(t.alts,(t=>t+1));return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:i,prefixPath:t.path}),type:Oc.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:t.alts}}));return o}(o,r,t,n),c=function(t,e,n,r){const i=es(t,((t,e,n)=>{const r=xi(e,(t=>({idx:n,path:t})));return t.concat(r)}),[]),s=Or(ki(i,(t=>{if(!0===e.definition[t.idx].ignoreAmbiguities)return[];const s=t.idx,o=t.path,a=Ii(i,(t=>{return!0!==e.definition[t.idx].ignoreAmbiguities&&t.idx<s&&(n=t.path,r=o,n.length<r.length&&Ai(n,((t,e)=>{const n=r[e];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})));var n,r}));return xi(a,(t=>{const i=[t.idx+1,s+1],o=0===e.idx?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:i,prefixPath:t.path}),type:Oc.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:o,alternatives:i}}))})));return s}(o,r,t,n);return a.concat(c)}));return s}var Ua=class extends Ns{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}};function Da(t){const e=li(t,{errMsgProvider:ta}),n={};return vi(t.rules,(t=>{n[t.name]=t})),function(t,e){const n=new ia(t,e);return n.resolveRefs(),n.errors}(n,e.errMsgProvider)}var Fa="MismatchedTokenException",ja="NoViableAltException",$a="EarlyExitException",Ga="NotAllInputParsedException",Ba=[Fa,ja,$a,Ga];function Wa(t){return Gi(Ba,t.name)}Object.freeze(Ba);var Ka=class extends Error{constructor(t,e){super(t),this.token=e,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},Ha=class extends Ka{constructor(t,e,n){super(t,e),this.previousToken=n,this.name=Fa}},za=class extends Ka{constructor(t,e,n){super(t,e),this.previousToken=n,this.name=ja}},Va=class extends Ka{constructor(t,e){super(t,e),this.name=Ga}},Ya=class extends Ka{constructor(t,e,n){super(t,e),this.previousToken=n,this.name=$a}},Xa={},qa="InRuleRecoveryException",Ja=class extends Error{constructor(t){super(t),this.name=qa}};function Za(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(void 0===c){const t=this.getCurrRuleFullName();c=new s(this.getGAstProductions()[t],i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;1===this.RULE_STACK.length&&h&&void 0===u&&(u=Jo,l=1),void 0!==u&&void 0!==l&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(t,e,n,u)}var Qa=1024,tc=1280,ec=1536;function nc(t,e,n){return n|e|t}var rc=class{constructor(t){var e;this.maxLookahead=null!==(e=null==t?void 0:t.maxLookahead)&&void 0!==e?e:Nc.maxLookahead}validate(t){const e=this.validateNoLeftRecursion(t.rules);if(Hi(e)){const n=this.validateEmptyOrAlternatives(t.rules),r=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...e,...n,...r,...i]}return e}validateNoLeftRecursion(t){return ki(t,(t=>ba(t,t,ea)))}validateEmptyOrAlternatives(t){return ki(t,(t=>function(t,e){const n=new wa;t.accept(n);const r=n.alternations;return ki(r,(n=>{const r=gi(n.definition);return ki(r,((r,i)=>{const s=da([r],[],No,1);return Hi(s)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:n,emptyChoiceIdx:i}),type:Oc.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:n.idx,alternative:i+1}]:[]}))}))}(t,ea)))}validateAmbiguousAlternationAlternatives(t,e){return ki(t,(t=>Ma(t,e,ea)))}validateSomeNonEmptyLookaheadPath(t,e){return function(t,e,n){const r=[];return vi(t,(t=>{const i=new Ua;t.accept(i);const s=i.allProductions;vi(s,(i=>{const s=Ea(i),o=i.maxLookahead||e,a=Na(i.idx,t,s,o)[0];if(Hi(cn(a))){const e=n.buildEmptyRepetitionError({topLevelRule:t,repetition:i});r.push({message:e,type:Oc.NO_NON_EMPTY_LOOKAHEAD,ruleName:t.name})}}))})),r}(t,e,ea)}buildLookaheadForAlternation(t){return function(t,e,n,r,i,s){const o=Ia(t,e,n);return s(o,r,_a(o)?So:No,i)}(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,ma)}buildLookaheadForOptional(t){return function(t,e,n,r,i,s){const o=Na(t,e,i,n),a=_a(o)?So:No;return s(o[0],a,r)}(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ea(t.prodType),ga)}},ic=new class extends Ns{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}};function sc(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset==!0&&(t.endOffset=e.endOffset)}function oc(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset==!0&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}var ac,cc,uc="name";function lc(t,e){Object.defineProperty(t,uc,{enumerable:!1,configurable:!0,writable:!1,value:e})}function hc(t,e){const n=ce(t),r=n.length;for(let i=0;i<r;i++){const r=t[n[i]],s=r.length;for(let t=0;t<s;t++){const n=r[t];void 0===n.tokenTypeIdx&&this[n.name](n.children,e)}}}function pc(t,e){const n=function(){};lc(n,t+"BaseSemantics");const r={visit:function(t,e){if(O(t)&&(t=t[0]),!Xi(t))return this[t.name](t.children,e)},validateVisitor:function(){const t=function(t,e){const n=function(t,e){const n=Ii(e,(e=>!1===B(t[e]))),r=xi(n,(e=>({msg:`Missing visitor method: <${e}> on ${t.constructor.name} CST Visitor.`,type:ac.MISSING_METHOD,methodName:e})));return Or(r)}(t,e);return n}(this,e);if(!Hi(t)){const e=xi(t,(t=>t.msg));throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:\n\t${e.join("\n\n").replace(/\n/g,"\n\t")}`)}}};return(n.prototype=r).constructor=n,n._RULE_NAMES=e,n}(cc=ac||(ac={}))[cc.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",cc[cc.MISSING_METHOD=1]="MISSING_METHOD";var dc={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(dc);var fc=Math.pow(2,8)-1,Ec=qo({name:"RECORDING_PHASE_TOKEN",pattern:Fo.NA});Co([Ec]);var mc=Zo(Ec,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(mc);var gc={name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}};function Tc(t,e,n,r=!1){Rc(n);const i=Ei(this.recordingProdStack),s=B(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),Ui(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),dc}function vc(t,e){Rc(e);const n=Ei(this.recordingProdStack),r=!1===O(t),i=!1===r?t:t.DEF,s=new As({definition:[],idx:e,ignoreAmbiguities:r&&!0===t.IGNORE_AMBIGUITIES});Ui(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=is(i,(t=>B(t.GATE)));return s.hasPredicates=o,n.definition.push(s),vi(i,(t=>{const e=new ms({definition:[]});s.definition.push(e),Ui(t,"IGNORE_AMBIGUITIES")?e.ignoreAmbiguities=t.IGNORE_AMBIGUITIES:Ui(t,"GATE")&&(e.ignoreAmbiguities=!0),this.recordingProdStack.push(e),t.ALT.call(this),this.recordingProdStack.pop()})),dc}function yc(t){return 0===t?"":`${t}`}function Rc(t){if(t<0||t>fc){const e=new Error(`Invalid DSL Method idx value: <${t}>\n\tIdx value must be a none negative value smaller than ${fc+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}var Ac=Zo(Jo,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ac);var Oc,Ic,Nc=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Qo,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Sc=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});(Ic=Oc||(Oc={}))[Ic.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",Ic[Ic.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",Ic[Ic.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",Ic[Ic.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",Ic[Ic.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",Ic[Ic.LEFT_RECURSION=5]="LEFT_RECURSION",Ic[Ic.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",Ic[Ic.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",Ic[Ic.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",Ic[Ic.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",Ic[Ic.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",Ic[Ic.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",Ic[Ic.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",Ic[Ic.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION";var _c,Lc=class t{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",(()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",(()=>{hs(this)})),this.TRACE_INIT("Grammar Recording",(()=>{try{this.enableRecording(),vi(this.definedRulesNames,(t=>{const e=this[t].originalGrammarAction;let n;this.TRACE_INIT(`${t} Rule`,(()=>{n=this.topLevelRuleRecord(t,e)})),this.gastProductionsCache[t]=n}))}finally{this.disableRecording()}}));let r=[];if(this.TRACE_INIT("Grammar Resolving",(()=>{r=Da({rules:ji(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)})),this.TRACE_INIT("Grammar Validations",(()=>{if(Hi(r)&&!1===this.skipValidations){const e=(t={rules:ji(this.gastProductionsCache),tokenTypes:ji(this.tokensMap),errMsgProvider:ea,grammarName:n},La((t=li(t,{errMsgProvider:ea})).rules,t.tokenTypes,t.errMsgProvider,t.grammarName)),r=function(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return xi(e,(t=>Object.assign({type:Oc.CUSTOM_LOOKAHEAD_VALIDATION},t)))}({lookaheadStrategy:this.lookaheadStrategy,rules:ji(this.gastProductionsCache),tokenTypes:ji(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(e,r)}var t})),Hi(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",(()=>{const t=function(t){const e={};return vi(t,(t=>{const n=new bs(t).startWalking();le(e,n)})),e}(ji(this.gastProductionsCache));this.resyncFollows=t})),this.TRACE_INIT("ComputeLookaheadFunctions",(()=>{var t,e;null===(e=(t=this.lookaheadStrategy).initialize)||void 0===e||e.call(t,{rules:ji(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ji(this.gastProductionsCache))}))),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!Hi(this.definitionErrors))throw e=xi(this.definitionErrors,(t=>t.message)),new Error(`Parser Definition Errors detected:\n ${e.join("\n-------------------------------\n")}`)}))}constructor(t,e){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(e),n.initLexerAdapter(),n.initLooksAhead(e),n.initRecognizerEngine(t,e),n.initRecoverable(e),n.initTreeBuilder(e),n.initContentAssist(),n.initGastRecorder(e),n.initPerformanceTracer(e),Ui(e,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=Ui(e,"skipValidations")?e.skipValidations:Nc.skipValidations}};Lc.DEFER_DEFINITION_ERRORS_HANDLING=!1,_c=Lc,[class{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ui(t,"recoveryEnabled")?t.recoveryEnabled:Nc.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Za)}getTokenToInsert(t){const e=Zo(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return e.isInsertedInRecovery=!0,e}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,e,n,r){const i=this.findReSyncTokenType(),s=this.exportLexerState(),o=[];let a=!1;const c=this.LA(1);let u=this.LA(1);const l=()=>{const t=this.LA(0),e=this.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:c,previous:t,ruleName:this.getCurrRuleFullName()}),n=new Ha(e,c,this.LA(0));n.resyncedTokens=gi(o),this.SAVE_ERROR(n)};for(;!a;){if(this.tokenMatcher(u,r))return void l();if(n.call(this))return l(),void t.apply(this,e);this.tokenMatcher(u,i)?a=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,o))}this.importLexerState(s)}shouldInRepetitionRecoveryBeTried(t,e,n){return!1!==n&&!this.tokenMatcher(this.LA(1),t)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,e))}getFollowsForInRuleRecovery(t,e){const n=this.getCurrentGrammarPath(t,e);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(t,e){if(this.canRecoverWithSingleTokenInsertion(t,e))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const t=this.SKIP_TOKEN();return this.consumeToken(),t}throw new Ja("sad sad panda")}canPerformInRuleRecovery(t,e){return this.canRecoverWithSingleTokenInsertion(t,e)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,e){if(!this.canTokenTypeBeInsertedInRecovery(t))return!1;if(Hi(e))return!1;const n=this.LA(1);return void 0!==_i(e,(t=>this.tokenMatcher(n,t)))}canRecoverWithSingleTokenDeletion(t){return!!this.canTokenTypeBeDeletedInRecovery(t)&&this.tokenMatcher(this.LA(2),t)}isInCurrentRuleReSyncSet(t){const e=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(e);return Gi(n,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let e=this.LA(1),n=2;for(;;){const r=_i(t,(t=>No(e,t)));if(void 0!==r)return r;e=this.LA(n),n++}}getCurrFollowKey(){if(1===this.RULE_STACK.length)return Xa;const t=this.getLastExplicitRuleShortName(),e=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:e,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,e=this.RULE_OCCURRENCE_STACK;return xi(t,((n,r)=>0===r?Xa:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:e[r],inRule:this.shortRuleNameToFullName(t[r-1])}))}flattenFollowSet(){const t=xi(this.buildFullFollowKeyStack(),(t=>this.getFollowSetFromFollowKey(t)));return cn(t)}getFollowSetFromFollowKey(t){if(t===Xa)return[Jo];const e=t.ruleName+t.idxInCallingRule+ks+t.inRule;return this.resyncFollows[e]}addToResyncTokens(t,e){return this.tokenMatcher(t,Jo)||e.push(t),e}reSyncTo(t){const e=[];let n=this.LA(1);for(;!1===this.tokenMatcher(n,t);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,e);return gi(e)}attemptInRepetitionRecovery(t,e,n,r,i,s,o){}getCurrentGrammarPath(t,e){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:Ar(this.RULE_OCCURRENCE_STACK),lastTok:t,lastTokOccurrence:e}}getHumanReadableRuleStack(){return xi(this.RULE_STACK,(t=>this.shortRuleNameToFullName(t)))}},class{initLooksAhead(t){this.dynamicTokensEnabled=Ui(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Nc.dynamicTokensEnabled,this.maxLookahead=Ui(t,"maxLookahead")?t.maxLookahead:Nc.maxLookahead,this.lookaheadStrategy=Ui(t,"lookaheadStrategy")?t.lookaheadStrategy:new rc({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){vi(t,(t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,(()=>{const{alternation:e,repetition:n,option:r,repetitionMandatory:i,repetitionMandatoryWithSeparator:s,repetitionWithSeparator:o}=function(t){ic.reset(),t.accept(ic);const e=ic.dslMethods;return ic.reset(),e}(t);vi(e,(e=>{const n=0===e.idx?"":e.idx;this.TRACE_INIT(`${_s(e)}${n}`,(()=>{const n=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:e.idx,rule:t,maxLookahead:e.maxLookahead||this.maxLookahead,hasPredicates:e.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),r=nc(this.fullRuleNameToShort[t.name],256,e.idx);this.setLaFuncCache(r,n)}))})),vi(n,(e=>{this.computeLookaheadFunc(t,e.idx,768,"Repetition",e.maxLookahead,_s(e))})),vi(r,(e=>{this.computeLookaheadFunc(t,e.idx,512,"Option",e.maxLookahead,_s(e))})),vi(i,(e=>{this.computeLookaheadFunc(t,e.idx,Qa,"RepetitionMandatory",e.maxLookahead,_s(e))})),vi(s,(e=>{this.computeLookaheadFunc(t,e.idx,ec,"RepetitionMandatoryWithSeparator",e.maxLookahead,_s(e))})),vi(o,(e=>{this.computeLookaheadFunc(t,e.idx,tc,"RepetitionWithSeparator",e.maxLookahead,_s(e))}))}))}))}computeLookaheadFunc(t,e,n,r,i,s){this.TRACE_INIT(`${s}${0===e?"":e}`,(()=>{const s=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:e,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:r}),o=nc(this.fullRuleNameToShort[t.name],n,e);this.setLaFuncCache(o,s)}))}getKeyForAutomaticLookahead(t,e){return nc(this.getLastExplicitRuleShortName(),t,e)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,e){this.lookAheadFuncsCache.set(t,e)}},class{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ui(t,"nodeLocationTracking")?t.nodeLocationTracking:Nc.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=oc,this.setNodeLocationFromNode=oc,this.cstPostRule=at,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=at,this.setNodeLocationFromNode=at,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=sc,this.setNodeLocationFromNode=sc,this.cstPostRule=at,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=at,this.setNodeLocationFromNode=at,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`);this.setNodeLocationFromToken=at,this.setNodeLocationFromNode=at,this.cstPostRule=at,this.setInitialNodeLocation=at}else this.cstInvocationStateUpdate=at,this.cstFinallyStateUpdate=at,this.cstPostTerminal=at,this.cstPostNonTerminal=at,this.cstPostRule=at}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const e=this.LA(1);t.location={startOffset:e.startOffset,startLine:e.startLine,startColumn:e.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const e={name:t,children:Object.create(null)};this.setInitialNodeLocation(e),this.CST_STACK.push(e)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const e=this.LA(0),n=t.location;n.startOffset<=e.startOffset==1?(n.endOffset=e.endOffset,n.endLine=e.endLine,n.endColumn=e.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(t){const e=this.LA(0),n=t.location;n.startOffset<=e.startOffset==1?n.endOffset=e.endOffset:n.startOffset=NaN}cstPostTerminal(t,e){const n=this.CST_STACK[this.CST_STACK.length-1];var r,i,s;i=e,s=t,void 0===(r=n).children[s]?r.children[s]=[i]:r.children[s].push(i),this.setNodeLocationFromToken(n.location,e)}cstPostNonTerminal(t,e){const n=this.CST_STACK[this.CST_STACK.length-1];!function(t,e,n){void 0===t.children[e]?t.children[e]=[n]:t.children[e].push(n)}(n,e,t),this.setNodeLocationFromNode(n.location,t.location)}getBaseCstVisitorConstructor(){if(Xi(this.baseCstVisitorConstructor)){const t=pc(this.className,ce(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Xi(this.baseCstVisitorWithDefaultsConstructor)){const t=function(t,e,n){const r=function(){};lc(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return vi(e,(t=>{i[t]=hc})),(r.prototype=i).constructor=r,r}(this.className,ce(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}},class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ac}LA(t){const e=this.currIdx+t;return e<0||this.tokVectorLength<=e?Ac:this.tokVector[e]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}},class{initRecognizerEngine(t,e){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=So,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ui(e,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if(O(t)){if(Hi(t))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof t[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(O(t))this.tokensMap=es(t,((t,e)=>(t[e.name]=e,t)),{});else if(Ui(t,"modes")&&Ai(cn(ji(t.modes)),Po)){const e=cn(ji(t.modes)),n=as(e);this.tokensMap=es(n,((t,e)=>(t[e.name]=e,t)),{})}else{if(!k(t))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=Ar(t)}this.tokensMap.EOF=Jo;const n=Ui(t,"modes")?cn(ji(t.modes)):ji(t),r=Ai(n,(t=>Hi(t.categoryMatches)));this.tokenMatcher=r?So:No,Co(ji(this.tokensMap))}defineRule(t,e,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const r=Ui(n,"resyncEnabled")?n.resyncEnabled:Sc.resyncEnabled,i=Ui(n,"recoveryValueFunc")?n.recoveryValueFunc:Sc.recoveryValueFunc,s=this.ruleShortNameIdx<<12;let o;return this.ruleShortNameIdx++,this.shortRuleNameToFull[s]=t,this.fullRuleNameToShort[t]=s,o=!0===this.outputCst?function(...n){try{this.ruleInvocationStateUpdate(s,t,this.subruleIdx),e.apply(this,n);const r=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(r),r}catch(t){return this.invokeRuleCatch(t,r,i)}finally{this.ruleFinallyStateUpdate()}}:function(...n){try{return this.ruleInvocationStateUpdate(s,t,this.subruleIdx),e.apply(this,n)}catch(t){return this.invokeRuleCatch(t,r,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(o,{ruleName:t,originalGrammarAction:e})}invokeRuleCatch(t,e,n){const r=1===this.RULE_STACK.length,i=e&&!this.isBackTracking()&&this.recoveryEnabled;if(Wa(t)){const e=t;if(i){const r=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(r)){if(e.resyncedTokens=this.reSyncTo(r),this.outputCst){const t=this.CST_STACK[this.CST_STACK.length-1];return t.recoveredNode=!0,t}return n(t)}if(this.outputCst){const t=this.CST_STACK[this.CST_STACK.length-1];t.recoveredNode=!0,e.partialCstResult=t}throw e}if(r)return this.moveToTerminatedState(),n(t);throw e}throw t}optionInternal(t,e){const n=this.getKeyForAutomaticLookahead(512,e);return this.optionInternalLogic(t,e,n)}optionInternalLogic(t,e,n){let r,i=this.getLaFuncFromCache(n);if("function"!=typeof t){r=t.DEF;const e=t.GATE;if(void 0!==e){const t=i;i=()=>e.call(this)&&t.call(this)}}else r=t;if(!0===i.call(this))return r.call(this)}atLeastOneInternal(t,e){const n=this.getKeyForAutomaticLookahead(Qa,t);return this.atLeastOneInternalLogic(t,e,n)}atLeastOneInternalLogic(t,e,n){let r,i=this.getLaFuncFromCache(n);if("function"!=typeof e){r=e.DEF;const t=e.GATE;if(void 0!==t){const e=i;i=()=>t.call(this)&&e.call(this)}}else r=e;if(!0!==i.call(this))throw this.raiseEarlyExitException(t,na.REPETITION_MANDATORY,e.ERR_MSG);{let t=this.doSingleRepetition(r);for(;!0===i.call(this)&&!0===t;)t=this.doSingleRepetition(r)}this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,e],i,Qa,t,la)}atLeastOneSepFirstInternal(t,e){const n=this.getKeyForAutomaticLookahead(ec,t);this.atLeastOneSepFirstInternalLogic(t,e,n)}atLeastOneSepFirstInternalLogic(t,e,n){const r=e.DEF,i=e.SEP;if(!0!==this.getLaFuncFromCache(n).call(this))throw this.raiseEarlyExitException(t,na.REPETITION_MANDATORY_WITH_SEPARATOR,e.ERR_MSG);{r.call(this);const e=()=>this.tokenMatcher(this.LA(1),i);for(;!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,e,r,ha],e,ec,t,ha)}}manyInternal(t,e){const n=this.getKeyForAutomaticLookahead(768,t);return this.manyInternalLogic(t,e,n)}manyInternalLogic(t,e,n){let r,i=this.getLaFuncFromCache(n);if("function"!=typeof e){r=e.DEF;const t=e.GATE;if(void 0!==t){const e=i;i=()=>t.call(this)&&e.call(this)}}else r=e;let s=!0;for(;!0===i.call(this)&&!0===s;)s=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[t,e],i,768,t,ca,s)}manySepFirstInternal(t,e){const n=this.getKeyForAutomaticLookahead(tc,t);this.manySepFirstInternalLogic(t,e,n)}manySepFirstInternalLogic(t,e,n){const r=e.DEF,i=e.SEP;if(!0===this.getLaFuncFromCache(n).call(this)){r.call(this);const e=()=>this.tokenMatcher(this.LA(1),i);for(;!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,e,r,ua],e,tc,t,ua)}}repetitionSepSecondInternal(t,e,n,r,i){for(;n();)this.CONSUME(e),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,e,n,r,i],n,ec,t,i)}doSingleRepetition(t){const e=this.getLexerPosition();return t.call(this),this.getLexerPosition()>e}orInternal(t,e){const n=this.getKeyForAutomaticLookahead(256,e),r=O(t)?t:t.DEF,i=this.getLaFuncFromCache(n).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(e,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){const t=this.LA(1),e=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Va(e,t))}}subruleInternal(t,e,n){let r;try{const i=void 0!==n?n.ARGS:void 0;return this.subruleIdx=e,r=t.apply(this,i),this.cstPostNonTerminal(r,void 0!==n&&void 0!==n.LABEL?n.LABEL:t.ruleName),r}catch(e){throw this.subruleInternalError(e,n,t.ruleName)}}subruleInternalError(t,e,n){throw Wa(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==e&&void 0!==e.LABEL?e.LABEL:n),delete t.partialCstResult),t}consumeInternal(t,e,n){let r;try{const e=this.LA(1);!0===this.tokenMatcher(e,t)?(this.consumeToken(),r=e):this.consumeInternalError(t,e,n)}catch(n){r=this.consumeInternalRecovery(t,e,n)}return this.cstPostTerminal(void 0!==n&&void 0!==n.LABEL?n.LABEL:t.name,r),r}consumeInternalError(t,e,n){let r;const i=this.LA(0);throw r=void 0!==n&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:e,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Ha(r,e,i))}consumeInternalRecovery(t,e,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;{const r=this.getFollowsForInRuleRecovery(t,e);try{return this.tryInRuleRecovery(t,r)}catch(t){throw t.name===qa?n:t}}}saveRecogState(){const t=this.errors,e=Ar(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:e,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,e,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(e)}isBackTracking(){return 0!==this.isBackTrackingStack.length}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Jo)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}},class{ACTION(t){return t.call(this)}consume(t,e,n){return this.consumeInternal(e,t,n)}subrule(t,e,n){return this.subruleInternal(e,t,n)}option(t,e){return this.optionInternal(e,t)}or(t,e){return this.orInternal(e,t)}many(t,e){return this.manyInternal(t,e)}atLeastOne(t,e){return this.atLeastOneInternal(t,e)}CONSUME(t,e){return this.consumeInternal(t,0,e)}CONSUME1(t,e){return this.consumeInternal(t,1,e)}CONSUME2(t,e){return this.consumeInternal(t,2,e)}CONSUME3(t,e){return this.consumeInternal(t,3,e)}CONSUME4(t,e){return this.consumeInternal(t,4,e)}CONSUME5(t,e){return this.consumeInternal(t,5,e)}CONSUME6(t,e){return this.consumeInternal(t,6,e)}CONSUME7(t,e){return this.consumeInternal(t,7,e)}CONSUME8(t,e){return this.consumeInternal(t,8,e)}CONSUME9(t,e){return this.consumeInternal(t,9,e)}SUBRULE(t,e){return this.subruleInternal(t,0,e)}SUBRULE1(t,e){return this.subruleInternal(t,1,e)}SUBRULE2(t,e){return this.subruleInternal(t,2,e)}SUBRULE3(t,e){return this.subruleInternal(t,3,e)}SUBRULE4(t,e){return this.subruleInternal(t,4,e)}SUBRULE5(t,e){return this.subruleInternal(t,5,e)}SUBRULE6(t,e){return this.subruleInternal(t,6,e)}SUBRULE7(t,e){return this.subruleInternal(t,7,e)}SUBRULE8(t,e){return this.subruleInternal(t,8,e)}SUBRULE9(t,e){return this.subruleInternal(t,9,e)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,e,n=Sc){if(Gi(this.definedRulesNames,t)){const e={message:ea.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Oc.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(e)}this.definedRulesNames.push(t);const r=this.defineRule(t,e,n);return this[t]=r,r}OVERRIDE_RULE(t,e,n=Sc){const r=function(t,e,n){const r=[];let i;return Gi(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Oc.INVALID_RULE_OVERRIDE,ruleName:t})),r}(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(r);const i=this.defineRule(t,e,n);return this[t]=i,i}BACKTRACK(t,e){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return t.apply(this,e),!0}catch(t){if(Wa(t))return!1;throw t}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return t=ji(this.gastProductionsCache),xi(t,Is);var t}},class{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ui(t,"errorMessageProvider")?t.errorMessageProvider:Nc.errorMessageProvider}SAVE_ERROR(t){if(Wa(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ar(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ar(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,e,n){const r=this.getCurrRuleFullName(),i=Na(t,this.getGAstProductions()[r],e,this.maxLookahead)[0],s=[];for(let t=1;t<=this.maxLookahead;t++)s.push(this.LA(t));const o=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:i,actual:s,previous:this.LA(0),customUserDescription:n,ruleName:r});throw this.SAVE_ERROR(new Ya(o,this.LA(1),this.LA(0)))}raiseNoAltException(t,e){const n=this.getCurrRuleFullName(),r=Ia(t,this.getGAstProductions()[n],this.maxLookahead),i=[];for(let t=1;t<=this.maxLookahead;t++)i.push(this.LA(t));const s=this.LA(0),o=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:r,actual:i,previous:s,customUserDescription:e,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new za(o,this.LA(1),s))}},class{initContentAssist(){}computeContentAssist(t,e){const n=this.gastProductionsCache[t];if(Xi(n))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return da([n],e,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const e=Li(t.ruleStack),n=this.getGAstProductions()[e];return new oa(n,t).startWalking()}},class{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",(()=>{for(let t=0;t<10;t++){const e=t>0?t:"";this[`CONSUME${e}`]=function(e,n){return this.consumeInternalRecord(e,t,n)},this[`SUBRULE${e}`]=function(e,n){return this.subruleInternalRecord(e,t,n)},this[`OPTION${e}`]=function(e){return this.optionInternalRecord(e,t)},this[`OR${e}`]=function(e){return this.orInternalRecord(e,t)},this[`MANY${e}`]=function(e){this.manyInternalRecord(t,e)},this[`MANY_SEP${e}`]=function(e){this.manySepFirstInternalRecord(t,e)},this[`AT_LEAST_ONE${e}`]=function(e){this.atLeastOneInternalRecord(t,e)},this[`AT_LEAST_ONE_SEP${e}`]=function(e){this.atLeastOneSepFirstInternalRecord(t,e)}}this.consume=function(t,e,n){return this.consumeInternalRecord(e,t,n)},this.subrule=function(t,e,n){return this.subruleInternalRecord(e,t,n)},this.option=function(t,e){return this.optionInternalRecord(e,t)},this.or=function(t,e){return this.orInternalRecord(e,t)},this.many=function(t,e){this.manyInternalRecord(t,e)},this.atLeastOne=function(t,e){this.atLeastOneInternalRecord(t,e)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD}))}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",(()=>{const t=this;for(let e=0;e<10;e++){const n=e>0?e:"";delete t[`CONSUME${n}`],delete t[`SUBRULE${n}`],delete t[`OPTION${n}`],delete t[`OR${n}`],delete t[`MANY${n}`],delete t[`MANY_SEP${n}`],delete t[`AT_LEAST_ONE${n}`],delete t[`AT_LEAST_ONE_SEP${n}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA}))}ACTION_RECORD(t){}BACKTRACK_RECORD(t,e){return()=>!0}LA_RECORD(t){return Ac}topLevelRuleRecord(t,e){try{const n=new Es({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),e.call(this),this.recordingProdStack.pop(),n}catch(t){if(!0!==t.KNOWN_RECORDER_ERROR)try{t.message=t.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(e){throw t}throw t}}optionInternalRecord(t,e){return Tc.call(this,gs,t,e)}atLeastOneInternalRecord(t,e){Tc.call(this,Ts,e,t)}atLeastOneSepFirstInternalRecord(t,e){Tc.call(this,vs,e,t,!0)}manyInternalRecord(t,e){Tc.call(this,ys,e,t)}manySepFirstInternalRecord(t,e){Tc.call(this,Rs,e,t,!0)}orInternalRecord(t,e){return vc.call(this,t,e)}subruleInternalRecord(t,e,n){if(Rc(e),!t||!1===Ui(t,"ruleName")){const n=new Error(`<SUBRULE${yc(e)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>\n inside top level rule: <${this.recordingProdStack[0].name}>`);throw n.KNOWN_RECORDER_ERROR=!0,n}const r=Ei(this.recordingProdStack),i=t.ruleName,s=new fs({idx:e,nonTerminalName:i,label:null==n?void 0:n.LABEL,referencedRule:void 0});return r.definition.push(s),this.outputCst?gc:dc}consumeInternalRecord(t,e,n){if(Rc(e),!ko(t)){const n=new Error(`<CONSUME${yc(e)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>\n inside top level rule: <${this.recordingProdStack[0].name}>`);throw n.KNOWN_RECORDER_ERROR=!0,n}const r=Ei(this.recordingProdStack),i=new Os({idx:e,terminalType:t,label:null==n?void 0:n.LABEL});return r.definition.push(i),mc}},class{initPerformanceTracer(t){if(Ui(t,"traceInitPerf")){const e=t.traceInitPerf,n="number"==typeof e;this.traceInitMaxIdent=n?e:1/0,this.traceInitPerf=n?e>0:e}else this.traceInitMaxIdent=0,this.traceInitPerf=Nc.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,e){if(!0===this.traceInitPerf){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--\x3e <${t}>`);const{time:r,value:i}=ls(e),s=r>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(`${n}<-- <${t}> time: ${r}ms`),this.traceInitIndent--,i}return e()}}].forEach((t=>{const e=t.prototype;Object.getOwnPropertyNames(e).forEach((n=>{if("constructor"===n)return;const r=Object.getOwnPropertyDescriptor(e,n);r&&(r.get||r.set)?Object.defineProperty(_c.prototype,n,r):_c.prototype[n]=t.prototype[n]}))}));var Cc=class extends Lc{constructor(t,e=Nc){const n=Ar(e);n.outputCst=!0,super(t,n)}};var xc=class extends Cc{constructor(t){super(t,{nodeLocationTracking:"full"}),this.atomTypes=["silent","assign","symbol","choice","pgate","text","entity"],this.buildRules()}parse(t){this.input=t.tokens;let e=this.script();if(this.errors.length>0)throw Error("[PARSING]\n"+this.errors[0].message);return e}buildRules(){const t=this,e=this.tokensMap;t.RULE("script",(()=>{t.MANY((()=>t.SUBRULE(t.expr)))})),t.RULE("pgate",(()=>{t.CONSUME(e.PendingGate),t.MANY((()=>t.CONSUME(e.TF)))})),t.RULE("entity",(()=>{t.CONSUME(e.Entity)})),t.RULE("gate",(()=>{t.CONSUME(e.EnterGate),t.MANY((()=>t.CONSUME(e.Gate))),t.CONSUME(e.ExitGate)})),t.RULE("silent",(()=>{t.CONSUME(e.OS),t.OPTION1((()=>t.SUBRULE(t.gate))),t.CONSUME(e.SYM),t.OPTION2((()=>{t.CONSUME(e.EQ),t.SUBRULE(t.expr)})),t.CONSUME(e.CS)})),t.RULE("assign",(()=>{t.CONSUME(e.SYM),t.CONSUME(e.EQ),t.SUBRULE(t.expr)})),t.RULE("symbol",(()=>{t.CONSUME(e.SYM),t.MANY((()=>t.CONSUME(e.TF)))})),t.RULE("accept",(()=>{t.SUBRULE(t.or_expr)})),t.RULE("reject",(()=>{t.SUBRULE(t.or_expr)})),t.RULE("or_expr",(()=>{t.MANY_SEP({SEP:e.OR,DEF:()=>t.SUBRULE(t.wexpr)})})),t.RULE("choice",(()=>{t.CONSUME(e.OC),t.OPTION1((()=>t.SUBRULE(t.gate))),t.SUBRULE(t.accept),t.OPTION2((()=>{t.CONSUME(e.ELSE),t.SUBRULE(t.reject)})),t.CONSUME(e.CC),t.MANY((()=>t.CONSUME(e.TF)))})),t.RULE("wexpr",(()=>{t.MANY((()=>{t.OR([{ALT:()=>t.SUBRULE(t.expr)},{ALT:()=>t.CONSUME(e.Weight)}])}))})),t.RULE("expr",(()=>{t.AT_LEAST_ONE((()=>t.SUBRULE(t.atom)))})),t.RULE("atom",(()=>{t.OR(this.atomTypes.map((e=>({ALT:()=>t.SUBRULE(t[e])}))))})),t.RULE("text",(()=>{t.CONSUME(e.Raw)})),this.performSelfAnalysis()}},kc=class{constructor(t){this.input=0,this.path="",this.tracePath=!0,this.scripting=t,this.warnOnInvalidGates=!1,this.RiScript=this.scripting.constructor}isCstNode(t){return"object"==typeof t&&("accept"in t||"name"in t&&"location"in t&&"children"in t)}visit(t,e){if(Array.isArray(t)&&(t=t[0]),void 0===t)return;if(!this.isCstNode(t))throw Error("Non-cstNode passed to visit: "+JSON.stringify(t));const{name:n,location:r}=t;if(this.nodeText=this.input.substring(r.startOffset,r.endOffset+1),"function"!=typeof this[n])throw Error(`BaseVisitor.visit: expecting function for this[${n}], found ${typeof this[n]}: ${JSON.stringify(this[n])}`);return this.tracePath&&!/(expr|atom|silent)/.test(n)&&(this.path+=n+"."),this[n](t.children,e)}validateVisitor(){}},bc=class extends kc{constructor(t,e={}){super(t),this.context=e,this.trace=0,this.choices={},this.isNoRepeat=!1,this.symbols=this.scripting.Symbols,this.escaped=this.scripting.Escaped,this.statics={},this.dynamics={},this.pendingGates={},this.pendingSymbols=new Set,this.validateVisitor()}start(t={}){if(this.input=t.input,this.trace=t.trace,this.traceTx=t.traceTx,!t.cst)throw Error("no cst");return super.visit(t.cst)}script(t){this.order=0;const e=t.expr?t.expr.length:0;if(this.print("script","'"+this.RiScript._escapeText(this.input)+"' :: "+e+" expression(s)"),!e)return"";if(1!==Object.keys(t).length)throw Error("script: invalid expr");return this.visit(t.expr)}expr(t){const e=Object.keys(t);if(1!==e.length)throw Error("invalid expr: "+e.length);const n=t.atom.map((t=>this.visit(t)));for(let t=1;t<n.length-1;t++)0===n[t].length&&n[t-1].endsWith(" ")&&n[t+1].startsWith(" ")&&(n[t+1]=n[t+1].substring(1));return n.join("")}wexpr(t){this.print("wexpr")}gate(t){if(1!==t.Gate.length)throw Error("Invalid gate: "+t.Gate);let e;const n=t.Gate[0].image;try{e=this.scripting._query(n)}catch(t){if(!this.warnOnInvalidGates)throw Error(`Invalid gate[2]: "@${n}@"\n\nRootCause -> ${t}`);return this.scripting.RiTa.SILENT||this.scripting.silent||console.warn(`[WARN] Ignoring invalid gate: @${n}@\n`,t),{decision:"accept"}}const r={},i=[],s=e.operands();if(s.forEach((t=>{let{result:e,resolved:n,isStatic:s,isUser:o}=this.checkContext(t);"function"==typeof e&&(e=e.call(),n=!this.scripting.isParseable(e)),void 0!==e&&n?(s?this.statics[t]=e:o?this.context[t]=e:this.dynamics[t]=e,r[t]=e):i.push(t)})),Object.keys(r).length+i.length!==s.length)throw Error("invalid operands");if(i.length)return{decision:"defer",operands:i};let o=e.test(r);return!o&&this.castValues(r)&&(o=e.test(r)),{decision:o?"accept":"reject"}}assign(e,n){const r=e.SYM[0].image;let i,s;const o=r.replace(this.scripting.AnySymbolRE,"");if(r.startsWith(this.symbols.STATIC))i=this.visit(e.expr),this.scripting.isParseable(i)?(this.statics[o]=i,i=this.inlineAssignment(o,e.TF,i)):(this.statics[o]=i,this.pendingSymbols.delete(o),this.trace&&console.log("  [pending.delete]",r,this.pendingSymbols.length?JSON.stringify(this.pendingSymbols):"")),s=`${r} = ${this.RiScript._escapeText(i)} [#static] ${t([n,"optionalAccess",t=>t.silent])?"{silent}":""}`;else{const a=this;i=()=>a.visit(e.expr),s=`${r} = <f*:pending>`+(t([n,"optionalAccess",t=>t.silent])?"{silent}":""),this.dynamics[o]=i}return this.print("assign",s),i}silent(t){return t.EQ?this.assign(t,{silent:!0}):this.symbol(t,{silent:!0}),""}atom(t){let e;const n=Object.keys(t);if(1!==n.length)throw Error("invalid atom: "+n);return this.scripting.parser.atomTypes.forEach((n=>{const r=t[n];if(r){if(1!==r.length)throw Error(n+": bad length -> "+t[n].length);e=this.visit(r[0])}})),"function"==typeof e&&(e=e.call()),e}text(t){if(1!==t.Raw.length)throw Error("[1] invalid text");if(1!==Object.keys(t).length)throw Error("[2] invalid text");const e=t.Raw[0].image;return this.print("text",this.RiScript._escapeText("'"+e+"'")),e}entity(t){return this.nodeText}symbol(e,n){if(1!==e.SYM.length)throw Error("[1] invalid symbol");const r=this.nodeText,i=e.SYM[0].image,s=i.replace(this.scripting.AnySymbolRE,"");if(this.isNoRepeat=this.hasNoRepeat(e.TF),this.pendingSymbols.has(s))return this.print("symbol",`${i} [is-pending]`),r;let{result:o,isStatic:a,isUser:c,resolved:u}=this.checkContext(s);if(!a&&i.startsWith(this.symbols.STATIC)&&!this.scripting.EntityRE.test(i))throw Error(`Attempt to refer to dynamic symbol '${s}' as ${this.symbols.STATIC}${s}, did you mean $${s}?`);if("function"==typeof o&&(o=o.call(),u=!this.scripting.isParseable(o)),this.isNoRepeat&&(a||c)){this.isNoRepeat=!1;const t="Attempt to call norepeat() on "+(a?"static symbol '"+i+"'. Did you mean to use '"+this.symbols.DYNAMIC+s+"' ?":"non-dynamic symbol '"+s+"'. Did you mean to define '"+this.symbols.DYNAMIC+s+"' in riscript?");throw Error(t)}if(void 0===o)return this.print("symbol",i+" -> '"+r+"' ctx="+this.lookupsToString(),"[deferred]",t([n,"optionalAccess",t=>t.silent])?"{silent}":""),r;let l=r+" -> '"+o+"'"+(t([n,"optionalAccess",t=>t.silent])?" {silent}":"");return"string"!=typeof o||u?(a&&(this.statics[s]=o),e.TF&&(o=this.applyTransforms(o,e.TF),l+=" -> '"+o+"'",this.isNoRepeat&&(l+=" (norepeat)")),this.print("symbol",l),this.pendingSymbols.has(s)&&(this.trace&&console.log("  [$pending.delete]",(a?"#":"$")+s,this.pendingSymbols.length?JSON.stringify(this.pendingSymbols):""),this.pendingSymbols.delete(s)),this.isNoRepeat=!1,o):(a?(this.pendingSymbols.add(s),o=this.inlineAssignment(s,e.TF,o),this.print("symbol*",`${r} -> ${o} :: pending.add(${s})`)):(e.TF&&(o=this.restoreTransforms(o,e.TF)),this.print("symbol",l)),o)}pgate(t){this.print("pgate",this.nodeText);const e=this.nodeText,n=e.replace(this.symbols.PENDING_GATE,""),r=this.pendingGates[n];if(!r)throw Error('no pending gate="'+e+'" pgates='+JSON.stringify(Object.keys(this.pendingGates)));if(r.operands.some((t=>{let{result:e,resolved:n}=this.checkContext(t);return"function"==typeof e&&(e=e.call(),n=!this.scripting.isParseable(e)),void 0===e||!n})))return e;return this.choice(r.deferredContext)}else(t){return this.visit(t.expr).trim()}choice(e,n){const r=this.symbols;let i,s;const o=this.nodeText;let a=o;const c=this.RiScript._stringHash(o+" #"+this.choiceId(e));if(!this.isNoRepeat&&this.hasNoRepeat(e.TF))throw Error("noRepeat() not allowed on choice (use a $variable instead): "+o);let u="accept";if(t([n,"optionalAccess",t=>t.forceReject]))u="reject";else if(e.gate&&(i=e.gate[0].children.Gate[0].image,s=this.visit(e.gate),u=s.decision,a+=`\n  [gate] ${i} -> ${"defer"!==u?u.toUpperCase():`DEFER ${r.PENDING_GATE}${c}`}  ${this.lookupsToString()}`),s&&"defer"===s.decision)return this.pendingGates[c]={deferredContext:e,operands:s.operands},`${r.PENDING_GATE}${c}`;if("reject"===u&&!("reject"in e))return"";const l=t([e,"access",t=>t[u],"optionalAccess",t=>t[0],"optionalAccess",t=>t.children,"optionalAccess",t=>t.or_expr,"optionalAccess",t=>t[0]]),h=this.parseOptions(l);if(!h)throw Error("No options in choice: "+o);let p=null;const d=[];let f=!1;for(;null===p;){if(p=this.choose(h,d).value,this.scripting.isParseable(p)){e.TF&&(p=this.restoreTransforms(p,e.TF)),f=!0;break}e.TF&&(p=this.applyTransforms(p,e.TF)),this.isNoRepeat&&p===this.choices[c]&&(this.print("choice.reject",p+" [norepeat]"),d.push(p),p=null)}return f||(this.choices[c]=p),p}hasNoRepeat(t){const e=this.RiScript._transformNames(t);return!!e.length&&(e.includes("nr")||e.includes("norepeat"))}checkContext(t){let e,n=!1,r=!1;if(0===t.length)return{result:"",resolved:!0,isStatic:n,isUser:r};e=this.dynamics[t],void 0===e&&(e=this.statics[t],void 0!==e&&(n=!0)),void 0===e&&(e=this.context[t],void 0!==e?r=!0:e=this.context[this.symbols.DYNAMIC+t]);return{result:e,isStatic:n,isUser:r,resolved:!this.scripting.isParseable(e)}}inlineAssignment(t,e,n){const r=this.symbols,i=r.STATIC+t,s=this.restoreTransforms(n,e);return n=r.OPEN_CHOICE+(i+"=")+s+r.CLOSE_CHOICE}choiceId(t){if(!t.OC||!t.OC.length)throw Error("invalid choice");return t.OC[0].startOffset+"."+t.OC[0].endOffset}parseOptions(e){const n=[];if(e&&t([e,"optionalAccess",t=>t.children,"optionalAccess",t=>t.wexpr])){const t=e.children.wexpr;for(let e=0;e<t.length;e++){const r=t[e],i=r.children.expr;if(i&&1!=i.length)throw Error("invalid choice-expr: "+i.length);const s=r.children.Weight;if(s){if(1!=s.length)throw Error("invalid weight: "+s.length);let t=1;try{t=parseInt(this.symbols.CLOSE_WEIGHT.length?s[0].image.trim().slice(1,-1):s[0].image.trim().slice(1))}catch(e){console.log("EX: "+t)}Array.from({length:t},(()=>n.push(i)))}else n.push(i||"")}}return n}chooseUnique(t,e){for(;t.length;){const{index:n,value:r}=this.choose(t);if(r!==this.choices[e])return r;t.splice(n,1)}throw Error("No remaining options")}choose(t,e=[]){if(!t||!t.length)throw Error("Invalid choice: no options");const n=t.filter((t=>!e.includes(t)));if(!n.length)throw Error("Invalid choice: no valid options");const r=this.scripting.RiTa.randi(n.length);let i="";const s=n[r];return"string"==typeof s?this.print("choice.text","''"):(this.path="choice."+this.path,i=this.visit(s)),"string"==typeof i&&(i=i.trim()),{index:r,value:i}}applyTransforms(t,e){this.traceTx&&console.log("applyTransforms",this.formatTxs(...arguments));for(let n=0;n<e.length;n++)t=this.applyTransform(t,e[n]);return t}restoreTransforms(t,e){if("string"==typeof t){new RegExp("^"+this.escaped.OPEN_CHOICE+".*"+this.escaped.CLOSE_CHOICE+"$").test(t)||(t=this.symbols.OPEN_CHOICE+t+this.symbols.CLOSE_CHOICE),e&&e.forEach((e=>t+=e.image)),this.traceTx&&console.log("restoreTransforms:",t)}return t}castValues(t){let e=!1;return Object.entries(t).forEach((([n,r])=>{const i=parseFloat(r);isNaN(i)||(e=!0,t[n]=i)})),e}contextIsResolved(t){let e=!0;return Object.entries(t).forEach((([t,n])=>{this.scripting.isParseable(n)||(e=!1)})),e}applyTransform(t,e){const n=e.image;let r;const i=t+n,s=n.substring(1).replace(/\(\)$/,"");return"function"==typeof this.dynamics[s]?r=this.dynamics[s](t):"function"==typeof this.statics[s]?r=this.statics[s](t):"function"==typeof this.context[s]?r=this.context[s](t):"function"==typeof this.RiScript.transforms[s]?r=this.RiScript.transforms[s](t):"function"==typeof t[s]?r=t[s]():t.hasOwnProperty(s)?r=t[s]:(this.scripting.RiTa.SILENT||this.scripting.silent||console.warn("[WARN] Unresolved transform: "+i),r=i.replace(/\(\)$/,"&lpar;&rpar;")),this.trace&&console.log(`${this.tindent()}[transform] ${i} -> '${r}'`),r}lookupsToString(){const t={},e={};return Object.entries(this.dynamics||{}).forEach((([e,n])=>t[`$${e} `]=n)),Object.entries(this.statics||{}).forEach((([t,n])=>e[`#${t} `]=n)),JSON.stringify({...this.context,...e,...t},((t,e)=>"function"==typeof e?"<f*:pending>":e)).replace(/"/g,"")}formatTxs(t,e){return t+e.map((t=>t.image.replace(/()/,"")+"()")).join("")}print(t,...e){this.trace&&(this.path&&"script"!==t&&(t=this.path.replace(/\.$/,"")),console.log(++this.order,`[${t}]`,...e),this.path="")}tindent(){return" ".repeat((this.order+"").length+1)}},{decode:Pc}=s.default,wc=/[aeiou]/,Mc="_RE_",Uc=/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/gi,Dc=class extends o.Query{constructor(t,e,n){if("string"==typeof e){e=t.parseJSOL(e)}super(e,n)}test(t){for(let e=0,n=this.compiled.length;e<n;e++)if(!this.compiled[e](t))return!1;return!0}operands(){const e=[this.condition],n=new Set;for(;t([e,"optionalAccess",t=>t.length])>0;){const t=e.pop();Object.keys(t).forEach((r=>{const i=t[r];if(r.startsWith("$")||n.add(r),"object"==typeof i&&null!==i){(Array.isArray(i)?i:[i]).forEach((t=>e.push(t)))}}))}return Array.from(n)}},Fc=class e{static evaluate(t,n,r={}){return(new e).evaluate(t,n,r)}constructor(t={}){this.visitor=0,this.v2Compatible=2===t.compatibility;const{Constants:e,tokens:n}=function(t){let e={OR:"|",ELSE:"||",DYNAMIC:"$",STATIC:"#",ENTITY:"&",OPEN_GATE:"@",CLOSE_GATE:"@",PENDING_GATE:"@@",OPEN_SILENT:"{",CLOSE_SILENT:"}"};Object.assign(e,t?{OPEN_CHOICE:"(",CLOSE_CHOICE:")",OPEN_WEIGHT:"[",CLOSE_WEIGHT:"]",CONTINUATION:"\\"}:{OPEN_CHOICE:"[",CLOSE_CHOICE:"]",OPEN_WEIGHT:"^",CLOSE_WEIGHT:"^",CONTINUATION:"~"});const n={};Object.entries(e).forEach((([t,e])=>{n[t]=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}));const r=new RegExp(`${n.PENDING_GATE}([0-9]{9,11})`);n.SPECIAL=Object.values(n).join("").replace(/[<>]/g,""),e.PENDING_GATE_RE=new RegExp(r.source,"g");const i=qo({name:"ExitGate",pattern:new RegExp(`\\s*${n.CLOSE_GATE}`),pop_mode:!0}),s=qo({name:"Gate",pattern:new RegExp(`[^${n.CLOSE_GATE}]+`)}),o=qo({name:"PendingGate",pattern:r}),a=qo({name:"EnterGate",pattern:new RegExp(`${n.OPEN_GATE}\\s*`),push_mode:"gate_mode"}),c=qo({name:"OC",pattern:new RegExp(n.OPEN_CHOICE+"\\s*")}),u=qo({name:"CC",pattern:new RegExp(`\\s*${n.CLOSE_CHOICE}`)}),l=qo({name:"OR",pattern:/\s*\|\s*/}),h=qo({name:"ELSE",pattern:/\s*\|\|\s*/}),p=qo({name:"EQ",pattern:/\s*=\s*/}),d=qo({name:"TF",pattern:/\.[A-Za-z_0-9][A-Za-z_0-9]*(\(\))?/}),f=qo({name:"OS",pattern:new RegExp(`${n.OPEN_SILENT}\\s*`)}),E=qo({name:"CS",pattern:new RegExp(`\\s*${n.CLOSE_SILENT}`)}),m=qo({name:"SYM",pattern:new RegExp(`[${n.DYNAMIC}${n.STATIC}][A-Za-z_0-9]*`)});return{tokens:{modes:{normal:[qo({name:"Entity",pattern:/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/i}),qo({name:"Weight",pattern:new RegExp(`\\s*${n.OPEN_WEIGHT}.+${n.CLOSE_WEIGHT}\\s*`)}),h,c,u,l,p,m,d,f,E,o,qo({name:"Raw",pattern:new RegExp(`[^${n.SPECIAL}]+`)}),a],gate_mode:[s,i]},defaultMode:"normal"},Constants:{Symbols:e,Escaped:n}}}(this.v2Compatible);this.Escaped=e.Escaped,this.Symbols=e.Symbols;const r=e.Escaped.STATIC+e.Escaped.DYNAMIC,i=e.Escaped.OPEN_CHOICE,s=e.Escaped.CLOSE_CHOICE;this.JSOLIdentRE=new RegExp(`([${r}]?[A-Za-z_0-9][A-Za-z_0-9]*)\\s*:`,"g"),this.RawAssignRE=new RegExp(`^[${r}][A-Za-z_0-9][A-Za-z_0-9]*\\s*=`),this.ChoiceWrapRE=new RegExp("^"+i+"[^"+i+s+"]*"+s+"$"),this.SpecialRE=new RegExp(`[${this.Escaped.SPECIAL.replace("&","")}]`),this.ContinueRE=new RegExp(this.Escaped.CONTINUATION+"\\r?\\n","g"),this.WhitespaceRE=/[\u00a0\u2000-\u200b\u2028-\u2029\u3000]+/g,this.AnySymbolRE=new RegExp(`[${r}]`),this.silent=!1,this.lexer=new Fo(n),this.parser=new xc(n),this.RiTa=t.RiTa||{VERSION:0,randi:t=>Math.floor(Math.random()*t)}}lex(t){if(!t.input)throw Error("no input");const e=this.lexer.tokenize(t.input);if(e.errors.length)throw console.error("Input: "+t.input+"\n",e.errors[0].message),Error("[LEXING] "+e.errors[0].message);t.trace&&this.printTokens(e.tokens),t.tokens=e.tokens}parse(t){t.cst=this.parser.parse(t)}visit(t){return this.visitor.start(t)}lexParseVisit(t={}){return this.lex(t),this.parse(t),this.visit(t)}evaluate(t,e,n={}){if("string"!=typeof t)throw Error("RiScript.evaluate() expects a string, got "+typeof t);return n.input=t,n.visitor=new bc(this,e),this._evaluate(n)}_evaluate(t){const{input:n}=t;let r,i=/\r?\n$/.test(n),s=this.preParse(n,t);if(!s)return"";if(t.trace&&console.log(`\nInput:  '${e._escapeText(n)}'`),t.trace&&n!==s&&console.log(`Parsed: '${e._escapeText(s)}'`),!t.visitor)throw Error("no visitor");this.visitor=t.visitor,delete t.visitor;for(let n=1;s!==r&&n<=10&&(r=s,t.trace&&console.log("-".repeat(20)+" Pass#"+n+" "+"-".repeat(20)),t.input=s,s=this.lexParseVisit(t),t.trace&&console.log(`Result(${n}) -> "${e._escapeText(s)}" ctx=${this.visitor.lookupsToString()}`),!t.onepass&&this.isParseable(s));n++);return this.silent||this.RiTa.SILENT||this.AnySymbolRE.test(s.replace(Uc,""))&&console.warn('[WARN] Unresolved symbol(s) in "'+s.replace(/\n/g,"\\n")+'" '),this.postParse(s,t)+(i?"\n":"")}_query(t,e){return new Dc(this,t,e)}printTokens(t){let n=t.reduce(((t,n)=>{let{name:r}=n.tokenType,i=r;return"TEXT"===i&&(i=e._escapeText(n.image,1)),"SYM"===i&&(i="sym("+n.image+")"),"TX"===i&&(i="tx("+n.image+")"),t+i+", "}),"").slice(0,-2);console.log("\nTokens: [ "+n+" ]  Context:",this.visitor.lookupsToString())}postParse(t,e){if("string"!=typeof t)return"";let n=Pc(t).replace(this.WhitespaceRE," ").replace(/\r?\n$/,"");return[...n.matchAll(this.Symbols.PENDING_GATE_RE)].forEach((t=>{if(!t||!t[0]||!t[1])throw Error("bad gate: "+t);let r=this.visitor.pendingGates[t[1]],{deferredContext:i,operands:s}=r;if(!s.length)throw Error("no operands");let o=this.visitor.choice(i,{forceReject:!0});n=n.replace(t[0],o),e.trace&&console.log("  "+t[0]+"-> "+o)})),e.trace&&console.log(`\nFinal: '${n}'`),e.preserveLookups||(this.visitor.statics=void 0,this.visitor.dynamics=void 0),n}preParse(t,e){if("string"!=typeof t)return"";const n=this.Symbols;let r=t;var i;this.v2Compatible||(r=r.replace(/\((\s*\d+\s*)\)/g,"^$1^")),r=r.replace(/\/\*[^]*?(\r?\n)?\//g,""),r=r.replace(/\/\/[^\n]+(\r?\n|$)/g,""),r=r.replace(this.ContinueRE,""),i=$c(i=r,"\\(","&lpar;"),i=$c(i,"\\)","&rpar;"),i=$c(i,"\\[","&lsqb;"),i=$c(i,"\\]","&rsqb;"),i=$c(i,"\\{","&lcqb;"),i=$c(i,"\\}","&rcqb;"),i=$c(i,"\\@","&commat;"),i=$c(i,"\\#","&num;"),i=$c(i,"\\|"," &vert"),r=i=$c(i,"\\="," &equals");let s="",o=r.split(/\r?\n/);for(let t=0;t<o.length;t++)if(
/*!opts.noAddedSilence && */
this.RawAssignRE.test(o[t])){let e=o[t].indexOf("=");if(e<0)throw Error("invalid state: no assigment: "+o[t]);let r=o[t].substring(0,e),i=o[t].substring(e+1),a=Gc(i,n.OPEN_CHOICE),c=Gc(i,n.CLOSE_CHOICE);for(;a>c;){let e=o[++t];i+="\n"+e,a+=Gc(e,n.OPEN_CHOICE),c+=Gc(e,n.CLOSE_CHOICE)}s+=n.OPEN_SILENT+(r+"=")+i+n.CLOSE_SILENT}else s+=o[t],t<o.length-1&&(s+="\n");return s}parseJSOL(t){let n=e._escapeJSONRegex(t).replace(this.JSOLIdentRE,'"$1":').replace(/'/g,'"'),r=JSON.parse(n),i=t=>{let e=t;if("string"==typeof t&&t.startsWith(Mc)&&t.endsWith(Mc)){let n=t.split(Mc);if(4!==n.length)throw Error("invalid regex in unescape");e=new RegExp(n[1],n[2])}return e};return Object.keys(r).forEach((t=>r[t]=i(r[t]))),r}isParseable(t){let e=!0;return/(string|number)/.test(typeof t)&&(e=this.SpecialRE.test(t.toString())),e}static articlize(n){if(!n||!n.length)return"";let r=n.split(/\s+/)[0];if(!t([e,"access",t=>t.RiTa,"optionalAccess",t=>t.phones]))return e.RiTaWarnings.phones||(console.warn("[WARN] Install RiTa for proper phonemes"),e.RiTaWarnings.phones=!0),(/^[aeiou].*/i.test(r)?"an ":"a ")+n;let i=e.RiTa.phones(r,{silent:!0});return(i&&i.length&&wc.test(i[0])?"an ":"a ")+n}static capitalize(t){return t?t[0].toUpperCase()+t.substring(1):""}static uppercase(t){return t?t.toUpperCase():""}static quotify(t){return"&#8220;"+(t||"")+"&#8221;"}static pluralize(n){return t([e,"access",t=>t.RiTa,"optionalAccess",t=>t.pluralize])?e.RiTa.pluralize(n):(e.RiTaWarnings.plurals||(e.RiTaWarnings.plurals=!0,console.warn("[WARN] Install RiTa for proper pluralization")),n.endsWith("s")?n:n+"s")}static identity(t){return t}static _transformNames(t){return t&&t.length?t.map((t=>t.image.replace(/(^\.|\(\)$)/g,"")),[]):[]}static _escapeText(t,e){if("string"!=typeof t)return t;let n=t.replace(/\r?\n/g,"\\n");return e||!n.length?"'"+n+"'":n}static _escapeJSONRegex(t){return t.replace(/\/([^/]+?)\/([igmsuy]*)/g,`"${Mc}$1${Mc}$2${Mc}"`)}static _stringHash(t){let e,n=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r),n=(n<<5)-n+e,n|=0;let r=n.toString();return n<0?r.replace("-","0"):r}};r(Fc,"Query",Dc),r(Fc,"VERSION","1.0.19"),r(Fc,"RiTaWarnings",{plurals:!1,phones:!1});var jc=Fc;function $c(t,e,n){return t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),(()=>n))}function Gc(t,e){let n=0;for(let r=0;r<t.length;r++)t[r]===e&&n++;return n}jc.transforms={quotify:jc.quotify,pluralize:jc.pluralize,capitalize:jc.capitalize,articlize:jc.articlize,uppercase:jc.uppercase,norepeat:jc.identity,art:jc.articlize,nr:jc.identity,cap:jc.capitalize,ucf:jc.capitalize,uc:jc.uppercase,qq:jc.quotify,s:jc.pluralize};jc.Grammar=class e{constructor(t={},e={}){if("object"!=typeof t)throw Error("RiGrammar: expecting object, found "+typeof t);this.scripting=new jc,this.context=e,this.setRules(t)}static expand(t,n,r){return new e(t,n).expand(r)}addTransform(){return jc.addTransform(...arguments)}removeTransform(){return jc.removeTransform(...arguments)}getTransforms(){return jc.transforms}equals(t){return t.toJSON()===this.toJSON()}expand(t={}){if("context"in t)throw Error("pass context to RiScript.grammar() or new RiGrammar() instead");return t.visitor=t.visitor||new jc.Visitor(this.scripting),t.visitor.context=this.context||{},t.input=this._toScript(t),this.scripting._evaluate(t)}addRule(t,e){this._validateRule(t,e),this.rules[t]=e}setRules(t){if(void 0===t)throw Error("undefined rules");this.rules={};let e="string"==typeof t?function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){throw Error("RiGrammar appears to be invalid JSON, please check it at http://jsonlint.com/\n"+t)}}(t):t,n=this;Object.entries(e).forEach((t=>n.addRule(...t)))}removeRule(t){t in this.rules&&delete this.rules[t]}toJSON(){return JSON.stringify(this.rules,...arguments)}toString(e={}){let n=e.replacer||0,r=e.space||2,i=t([e,"optionalAccess",t=>t.linebreak]),s=this.toJSON(n,r);return i&&(s=s.replace(/\n/g,i)),s}static fromJSON(t,n){return new e(JSON.parse(t),n)}_toScript(t){let e="",n=t.start||"start",{Symbols:r}=this.scripting;if(n.startsWith(r.DYNAMIC)&&(n=n.substring(r.DYNAMIC.length)),n.startsWith(r.STATIC)&&(n=n.substring(r.STATIC.length)),!(n in this.rules)&&!(r.STATIC+n in this.rules))throw Error('Rule: "'+n+'" not found in grammar');return Object.entries(this.rules).forEach((([t,n],i)=>{for(;t.startsWith(r.DYNAMIC);)t=t.substring(1);t.startsWith(r.STATIC)||(t=r.DYNAMIC+t),this.scripting.ChoiceWrapRE.test(n)||(n=r.OPEN_CHOICE+n+r.CLOSE_CHOICE),e+=`${t}=${n}\n`})),t.trace&&console.log("Grammar:\n"+e.replace(/^\$/gm,"  $")),e+=`${r.DYNAMIC}${n}`,e}_validateRule(t,e){if("string"!=typeof t||0===t.length)throw Error("expected [string] name");if(void 0===e)throw Error("undefined rule def: "+t);let{Symbols:n}=this.scripting;if(t.startsWith(n.DYNAMIC))throw t=t.substring(n.DYNAMIC.length),Error("Grammar rules are dynamic by default; if you need a static rule, use '"+n.STATIC+t+"', otherwise just use '"+t+"'.")}},jc.Visitor=bc;var Bc=jc;exports.default=Bc,
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
module.exports=exports.default;//# sourceMappingURL=riscript.cjs.map